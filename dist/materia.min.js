var materia;(()=>{var t={746:(t,e)=>{"use strict";function i(t){var e=32;return(t&=-t)&&e--,65535&t&&(e-=16),16711935&t&&(e-=8),252645135&t&&(e-=4),858993459&t&&(e-=2),1431655765&t&&(e-=1),e}e.INT_BITS=32,e.INT_MAX=2147483647,e.INT_MIN=-1<<31,e.sign=function(t){return(t>0)-(t<0)},e.abs=function(t){var e=t>>31;return(t^e)-e},e.min=function(t,e){return e^(t^e)&-(t<e)},e.max=function(t,e){return t^(t^e)&-(t<e)},e.isPow2=function(t){return!(t&t-1||!t)},e.log2=function(t){var e,i;return e=(t>65535)<<4,e|=i=((t>>>=e)>255)<<3,e|=i=((t>>>=i)>15)<<2,(e|=i=((t>>>=i)>3)<<1)|(t>>>=i)>>1},e.log10=function(t){return t>=1e9?9:t>=1e8?8:t>=1e7?7:t>=1e6?6:t>=1e5?5:t>=1e4?4:t>=1e3?3:t>=100?2:t>=10?1:0},e.popCount=function(t){return 16843009*((t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)>>>24},e.countTrailingZeros=i,e.nextPow2=function(t){return t+=0===t,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,1+(t|=t>>>16)},e.prevPow2=function(t){return t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)-(t>>>1)},e.parity=function(t){return t^=t>>>16,t^=t>>>8,t^=t>>>4,27030>>>(t&=15)&1};var s=new Array(256);!function(t){for(var e=0;e<256;++e){var i=e,s=e,o=7;for(i>>>=1;i;i>>>=1)s<<=1,s|=1&i,--o;t[e]=s<<o&255}}(s),e.reverse=function(t){return s[255&t]<<24|s[t>>>8&255]<<16|s[t>>>16&255]<<8|s[t>>>24&255]},e.interleave2=function(t,e){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1))<<1},e.deinterleave2=function(t,e){return(t=65535&((t=16711935&((t=252645135&((t=858993459&((t=t>>>e&1431655765)|t>>>1))|t>>>2))|t>>>4))|t>>>16))<<16>>16},e.interleave3=function(t,e,i){return t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2),(t|=(e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2))<<1)|(i=1227133513&((i=3272356035&((i=251719695&((i=4278190335&((i&=1023)|i<<16))|i<<8))|i<<4))|i<<2))<<2},e.deinterleave3=function(t,e){return(t=1023&((t=4278190335&((t=251719695&((t=3272356035&((t=t>>>e&1227133513)|t>>>2))|t>>>4))|t>>>8))|t>>>16))<<22>>22},e.nextCombination=function(t){var e=t|t-1;return e+1|(~e&-~e)-1>>>i(t)+1}},645:(t,e,i)=>{"use strict";var s=i(841),o=i(489);function n(t,e){for(var i=0,s=t.length,o=0;o<s;++o)i+=t[o]*e[o];return i}function r(t){var e=t.length;if(0===e)return[];t[0].length;var i=s([t.length+1,t.length+1],1),r=s([t.length+1],1);i[e][e]=0;for(var a=0;a<e;++a){for(var h=0;h<=a;++h)i[h][a]=i[a][h]=2*n(t[a],t[h]);r[a]=n(t[a],t[a])}var l=o(i,r),c=0,u=l[e+1];for(a=0;a<u.length;++a)c+=u[a];var d=new Array(e);for(a=0;a<e;++a){u=l[a];var p=0;for(h=0;h<u.length;++h)p+=u[h];d[a]=p/c}return d}function a(t){if(0===t.length)return[];for(var e=t[0].length,i=s([e]),o=r(t),n=0;n<t.length;++n)for(var a=0;a<e;++a)i[a]+=t[n][a]*o[n];return i}a.barycenetric=r,t.exports=a},930:(t,e,i)=>{"use strict";var s=i(293),o=i(706);function n(t,e){this.point=t,this.index=e}function r(t,e){for(var i=t.point,s=e.point,o=i.length,n=0;n<o;++n){var r=s[n]-i[n];if(r)return r}return 0}t.exports=function(t,e){var i=t.length;if(0===i)return[];var a=t[0].length;if(a<1)return[];if(1===a)return function(t,e,i){if(1===t)return i?[[-1,0]]:[];var s=e.map((function(t,e){return[t[0],e]}));s.sort((function(t,e){return t[0]-e[0]}));for(var o=new Array(t-1),n=1;n<t;++n){var r=s[n-1],a=s[n];o[n-1]=[r[1],a[1]]}return i&&o.push([-1,o[0][1]],[o[t-1][1],-1]),o}(i,t,e);for(var h=new Array(i),l=1,c=0;c<i;++c){for(var u=t[c],d=new Array(a+1),p=0,f=0;f<a;++f){var v=u[f];d[f]=v,p+=v*v}d[a]=p,h[c]=new n(d,c),l=Math.max(p,l)}o(h,r),i=h.length;var m=new Array(i+a+1),b=new Array(i+a+1),g=(a+1)*(a+1)*l,w=new Array(a+1);for(c=0;c<=a;++c)w[c]=0;for(w[a]=g,m[0]=w.slice(),b[0]=-1,c=0;c<=a;++c)(d=w.slice())[c]=1,m[c+1]=d,b[c+1]=-1;for(c=0;c<i;++c){var y=h[c];m[c+a+1]=y.point,b[c+a+1]=y.index}var C=s(m,!1);if(C=e?C.filter((function(t){for(var e=0,i=0;i<=a;++i){var s=b[t[i]];if(s<0&&++e>=2)return!1;t[i]=s}return!0})):C.filter((function(t){for(var e=0;e<=a;++e){var i=b[t[e]];if(i<0)return!1;t[e]=i}return!0})),1&a)for(c=0;c<C.length;++c)d=(y=C[c])[0],y[0]=y[1],y[1]=d;return C}},841:t=>{"use strict";function e(t,i,s){var o=0|t[s];if(o<=0)return[];var n,r=new Array(o);if(s===t.length-1)for(n=0;n<o;++n)r[n]=i;else for(n=0;n<o;++n)r[n]=e(t,i,s+1);return r}t.exports=function(t,i){switch(void 0===i&&(i=0),typeof t){case"number":if(t>0)return function(t,e){var i,s;for(i=new Array(t),s=0;s<t;++s)i[s]=e;return i}(0|t,i);break;case"object":if("number"==typeof t.length)return e(t,i,0)}return[]}},293:(t,e,i)=>{"use strict";t.exports=function(t,e){var i=t.length;if(0===i)throw new Error("Must have at least d+1 points");var o=t[0].length;if(i<=o)throw new Error("Must input at least d+1 points");var r=t.slice(0,o+1),a=s.apply(void 0,r);if(0===a)throw new Error("Input not in general position");for(var h=new Array(o+1),c=0;c<=o;++c)h[c]=c;a<0&&(h[0]=1,h[1]=0);var u=new n(h,new Array(o+1),!1),d=u.adjacent,p=new Array(o+2);for(c=0;c<=o;++c){for(var f=h.slice(),v=0;v<=o;++v)v===c&&(f[v]=-1);var m=f[0];f[0]=f[1],f[1]=m;var b=new n(f,new Array(o+1),!0);d[c]=b,p[c]=b}for(p[o+1]=u,c=0;c<=o;++c){f=d[c].vertices;var g=d[c].adjacent;for(v=0;v<=o;++v){var w=f[v];if(w<0)g[v]=u;else for(var y=0;y<=o;++y)d[y].vertices.indexOf(w)<0&&(g[v]=d[y])}}var C=new l(o,r,p),x=!!e;for(c=o+1;c<i;++c)C.insert(t[c],x);return C.boundary()};var s=i(146),o=i(572).H;function n(t,e,i){this.vertices=t,this.adjacent=e,this.boundary=i,this.lastVisited=-1}function r(t,e,i){this.vertices=t,this.cell=e,this.index=i}function a(t,e){return o(t.vertices,e.vertices)}n.prototype.flip=function(){var t=this.vertices[0];this.vertices[0]=this.vertices[1],this.vertices[1]=t;var e=this.adjacent[0];this.adjacent[0]=this.adjacent[1],this.adjacent[1]=e};var h=[];function l(t,e,i){this.dimension=t,this.vertices=e,this.simplices=i,this.interior=i.filter((function(t){return!t.boundary})),this.tuple=new Array(t+1);for(var o=0;o<=t;++o)this.tuple[o]=this.vertices[o];var n=h[t];n||(n=h[t]=function(t){for(var e=["function orient(){var tuple=this.tuple;return test("],i=0;i<=t;++i)i>0&&e.push(","),e.push("tuple[",i,"]");e.push(")}return orient");var o=new Function("test",e.join("")),n=s[t+1];return n||(n=s),o(n)}(t)),this.orient=n}var c=l.prototype;c.handleBoundaryDegeneracy=function(t,e){var i=this.dimension,s=this.vertices.length-1,o=this.tuple,n=this.vertices,r=[t];for(t.lastVisited=-s;r.length>0;){(t=r.pop()).vertices;for(var a=t.adjacent,h=0;h<=i;++h){var l=a[h];if(l.boundary&&!(l.lastVisited<=-s)){for(var c=l.vertices,u=0;u<=i;++u){var d=c[u];o[u]=d<0?e:n[d]}var p=this.orient();if(p>0)return l;l.lastVisited=-s,0===p&&r.push(l)}}}return null},c.walk=function(t,e){var i=this.vertices.length-1,s=this.dimension,o=this.vertices,n=this.tuple,r=e?this.interior.length*Math.random()|0:this.interior.length-1,a=this.interior[r];t:for(;!a.boundary;){for(var h=a.vertices,l=a.adjacent,c=0;c<=s;++c)n[c]=o[h[c]];for(a.lastVisited=i,c=0;c<=s;++c){var u=l[c];if(!(u.lastVisited>=i)){var d=n[c];n[c]=t;var p=this.orient();if(n[c]=d,p<0){a=u;continue t}u.boundary?u.lastVisited=-i:u.lastVisited=i}}return}return a},c.addPeaks=function(t,e){var i=this.vertices.length-1,s=this.dimension,o=this.vertices,h=this.tuple,l=this.interior,c=this.simplices,u=[e];e.lastVisited=i,e.vertices[e.vertices.indexOf(-1)]=i,e.boundary=!1,l.push(e);for(var d=[];u.length>0;){var p=(e=u.pop()).vertices,f=e.adjacent,v=p.indexOf(i);if(!(v<0))for(var m=0;m<=s;++m)if(m!==v){var b=f[m];if(b.boundary&&!(b.lastVisited>=i)){var g=b.vertices;if(b.lastVisited!==-i){for(var w=0,y=0;y<=s;++y)g[y]<0?(w=y,h[y]=t):h[y]=o[g[y]];if(this.orient()>0){g[w]=i,b.boundary=!1,l.push(b),u.push(b),b.lastVisited=i;continue}b.lastVisited=-i}var C=b.adjacent,x=p.slice(),V=f.slice(),M=new n(x,V,!0);c.push(M);var A=C.indexOf(e);if(!(A<0))for(C[A]=M,V[v]=b,x[m]=-1,V[m]=e,f[m]=M,M.flip(),y=0;y<=s;++y){var S=x[y];if(!(S<0||S===i)){for(var _=new Array(s-1),z=0,E=0;E<=s;++E){var P=x[E];P<0||E===y||(_[z++]=P)}d.push(new r(_,M,y))}}}}}for(d.sort(a),m=0;m+1<d.length;m+=2){var k=d[m],j=d[m+1],L=k.index,F=j.index;L<0||F<0||(k.cell.adjacent[k.index]=j.cell,j.cell.adjacent[j.index]=k.cell)}},c.insert=function(t,e){var i=this.vertices;i.push(t);var s=this.walk(t,e);if(s){for(var o=this.dimension,n=this.tuple,r=0;r<=o;++r){var a=s.vertices[r];n[r]=a<0?t:i[a]}var h=this.orient(n);h<0||(0!==h||(s=this.handleBoundaryDegeneracy(s,t)))&&this.addPeaks(t,s)}},c.boundary=function(){for(var t=this.dimension,e=[],i=this.simplices,s=i.length,o=0;o<s;++o){var n=i[o];if(n.boundary){for(var r=new Array(t),a=n.vertices,h=0,l=0,c=0;c<=t;++c)a[c]>=0?r[h++]=a[c]:l=1&c;if(l===(1&t)){var u=r[0];r[0]=r[1],r[1]=u}e.push(r)}}return e}},154:t=>{"use strict";t.exports=function(t){for(var e=t.length,i=t[t.length-1],s=e,o=e-2;o>=0;--o){var n=i,r=t[o];(h=r-((i=n+r)-n))&&(t[--s]=i,i=h)}var a=0;for(o=s;o<e;++o){var h;(h=(r=i)-((i=(n=t[o])+r)-n))&&(t[a++]=h)}return t[a++]=i,t.length=a,t}},437:(t,e,i)=>{"use strict";var s=i(5),o=i(740),n=i(442),r=i(154);function a(t,e){for(var i=new Array(t.length-1),s=1;s<t.length;++s)for(var o=i[s-1]=new Array(t.length-1),n=0,r=0;n<t.length;++n)n!==e&&(o[r++]=t[s][n]);return i}function h(t){for(var e=new Array(t),i=0;i<t;++i){e[i]=new Array(t);for(var s=0;s<t;++s)e[i][s]=["m[",i,"][",s,"]"].join("")}return e}function l(t){if(1===t.length)return t[0];if(2===t.length)return["sum(",t[0],",",t[1],")"].join("");var e=t.length>>1;return["sum(",l(t.slice(0,e)),",",l(t.slice(e)),")"].join("")}function c(t){if(2===t.length)return["sum(prod(",t[0][0],",",t[1][1],"),prod(-",t[0][1],",",t[1][0],"))"].join("");for(var e=[],i=0;i<t.length;++i)e.push(["scale(",c(a(t,i)),",",(s=i,1&s?"-":""),t[0][i],")"].join(""));return l(e);var s}function u(t){return new Function("sum","scale","prod","compress",["function robustDeterminant",t,"(m){return compress(",c(h(t)),")};return robustDeterminant",t].join(""))(o,n,s,r)}var d=[function(){return[0]},function(t){return[t[0][0]]}];!function(){for(;d.length<6;)d.push(u(d.length));for(var e=[],i=["function robustDeterminant(m){switch(m.length){"],s=0;s<6;++s)e.push("det"+s),i.push("case ",s,":return det",s,"(m);");i.push("}var det=CACHE[m.length];if(!det)det=CACHE[m.length]=gen(m.length);return det(m);}return robustDeterminant"),e.push("CACHE","gen",i.join(""));var o=Function.apply(void 0,e);for(t.exports=o.apply(void 0,d.concat([d,u])),s=0;s<d.length;++s)t.exports[s]=d[s]}()},489:(t,e,i)=>{"use strict";var s=i(437);function o(t){for(var e="robustLinearSolve"+t+"d",i=["function ",e,"(A,b){return ["],o=0;o<t;++o){i.push("det([");for(var n=0;n<t;++n){n>0&&i.push(","),i.push("[");for(var r=0;r<t;++r)r>0&&i.push(","),r===o?i.push("+b[",n,"]"):i.push("+A[",n,"][",r,"]");i.push("]")}i.push("]),")}return i.push("det(A)]}return ",e),new Function("det",i.join(""))(t<6?s[t]:s)}var n=[function(){return[0]},function(t,e){return[[e[0]],[t[0][0]]]}];!function(){for(;n.length<6;)n.push(o(n.length));for(var e=[],i=["function dispatchLinearSolve(A,b){switch(A.length){"],s=0;s<6;++s)e.push("s"+s),i.push("case ",s,":return s",s,"(A,b);");i.push("}var s=CACHE[A.length];if(!s)s=CACHE[A.length]=g(A.length);return s(A,b)}return dispatchLinearSolve"),e.push("CACHE","g",i.join(""));var r=Function.apply(void 0,e);for(t.exports=r.apply(void 0,n.concat([n,o])),s=0;s<6;++s)t.exports[s]=n[s]}()},146:(t,e,i)=>{"use strict";var s=i(5),o=i(740),n=i(442),r=i(972);function a(t,e){for(var i=new Array(t.length-1),s=1;s<t.length;++s)for(var o=i[s-1]=new Array(t.length-1),n=0,r=0;n<t.length;++n)n!==e&&(o[r++]=t[s][n]);return i}function h(t){if(1===t.length)return t[0];if(2===t.length)return["sum(",t[0],",",t[1],")"].join("");var e=t.length>>1;return["sum(",h(t.slice(0,e)),",",h(t.slice(e)),")"].join("")}function l(t){if(2===t.length)return[["sum(prod(",t[0][0],",",t[1][1],"),prod(-",t[0][1],",",t[1][0],"))"].join("")];for(var e=[],i=0;i<t.length;++i)e.push(["scale(",h(l(a(t,i))),",",(s=i,1&s?"-":""),t[0][i],")"].join(""));return e;var s}function c(t){for(var e=[],i=[],c=function(t){for(var e=new Array(t),i=0;i<t;++i){e[i]=new Array(t);for(var s=0;s<t;++s)e[i][s]=["m",s,"[",t-i-1,"]"].join("")}return e}(t),u=[],d=0;d<t;++d)0==(1&d)?e.push.apply(e,l(a(c,d))):i.push.apply(i,l(a(c,d))),u.push("m"+d);var p=h(e),f=h(i),v="orientation"+t+"Exact",m=["function ",v,"(",u.join(),"){var p=",p,",n=",f,",d=sub(p,n);return d[d.length-1];};return ",v].join("");return new Function("sum","prod","scale","sub",m)(o,s,n,r)}var u=c(3),d=c(4),p=[function(){return 0},function(){return 0},function(t,e){return e[0]-t[0]},function(t,e,i){var s,o=(t[1]-i[1])*(e[0]-i[0]),n=(t[0]-i[0])*(e[1]-i[1]),r=o-n;if(o>0){if(n<=0)return r;s=o+n}else{if(!(o<0))return r;if(n>=0)return r;s=-(o+n)}var a=33306690738754716e-32*s;return r>=a||r<=-a?r:u(t,e,i)},function(t,e,i,s){var o=t[0]-s[0],n=e[0]-s[0],r=i[0]-s[0],a=t[1]-s[1],h=e[1]-s[1],l=i[1]-s[1],c=t[2]-s[2],u=e[2]-s[2],p=i[2]-s[2],f=n*l,v=r*h,m=r*a,b=o*l,g=o*h,w=n*a,y=c*(f-v)+u*(m-b)+p*(g-w),C=7771561172376103e-31*((Math.abs(f)+Math.abs(v))*Math.abs(c)+(Math.abs(m)+Math.abs(b))*Math.abs(u)+(Math.abs(g)+Math.abs(w))*Math.abs(p));return y>C||-y>C?y:d(t,e,i,s)}];function f(t){var e=p[t.length];return e||(e=p[t.length]=c(t.length)),e.apply(void 0,t)}!function(){for(;p.length<=5;)p.push(c(p.length));for(var e=[],i=["slow"],s=0;s<=5;++s)e.push("a"+s),i.push("o"+s);var o=["function getOrientation(",e.join(),"){switch(arguments.length){case 0:case 1:return 0;"];for(s=2;s<=5;++s)o.push("case ",s,":return o",s,"(",e.slice(0,s).join(),");");o.push("}var s=new Array(arguments.length);for(var i=0;i<arguments.length;++i){s[i]=arguments[i]};return slow(s);}return getOrientation"),i.push(o.join(""));var n=Function.apply(void 0,i);for(t.exports=n.apply(void 0,[f].concat(p)),s=0;s<=5;++s)t.exports[s]=p[s]}()},442:(t,e,i)=>{"use strict";var s=i(5),o=i(359);t.exports=function(t,e){var i=t.length;if(1===i){var n=s(t[0],e);return n[0]?n:[n[1]]}var r=new Array(2*i),a=[.1,.1],h=[.1,.1],l=0;s(t[0],e,a),a[0]&&(r[l++]=a[0]);for(var c=1;c<i;++c){s(t[c],e,h);var u=a[1];o(u,h[0],a),a[0]&&(r[l++]=a[0]);var d=h[1],p=a[1],f=d+p,v=p-(f-d);a[1]=f,v&&(r[l++]=v)}return a[1]&&(r[l++]=a[1]),0===l&&(r[l++]=0),r.length=l,r}},972:t=>{"use strict";t.exports=function(t,e){var i=0|t.length,s=0|e.length;if(1===i&&1===s)return function(t,e){var i=t+e,s=i-t,o=t-(i-s)+(e-s);return o?[o,i]:[i]}(t[0],-e[0]);var o,n,r=new Array(i+s),a=0,h=0,l=0,c=Math.abs,u=t[h],d=c(u),p=-e[l],f=c(p);d<f?(n=u,(h+=1)<i&&(d=c(u=t[h]))):(n=p,(l+=1)<s&&(f=c(p=-e[l]))),h<i&&d<f||l>=s?(o=u,(h+=1)<i&&(d=c(u=t[h]))):(o=p,(l+=1)<s&&(f=c(p=-e[l])));for(var v,m,b=o+n,g=b-o,w=n-g,y=w,C=b;h<i&&l<s;)d<f?(o=u,(h+=1)<i&&(d=c(u=t[h]))):(o=p,(l+=1)<s&&(f=c(p=-e[l]))),(w=(n=y)-(g=(b=o+n)-o))&&(r[a++]=w),y=C-((v=C+b)-(m=v-C))+(b-m),C=v;for(;h<i;)(w=(n=y)-(g=(b=(o=u)+n)-o))&&(r[a++]=w),y=C-((v=C+b)-(m=v-C))+(b-m),C=v,(h+=1)<i&&(u=t[h]);for(;l<s;)(w=(n=y)-(g=(b=(o=p)+n)-o))&&(r[a++]=w),y=C-((v=C+b)-(m=v-C))+(b-m),C=v,(l+=1)<s&&(p=-e[l]);return y&&(r[a++]=y),C&&(r[a++]=C),a||(r[a++]=0),r.length=a,r}},740:t=>{"use strict";t.exports=function(t,e){var i=0|t.length,s=0|e.length;if(1===i&&1===s)return function(t,e){var i=t+e,s=i-t,o=t-(i-s)+(e-s);return o?[o,i]:[i]}(t[0],e[0]);var o,n,r=new Array(i+s),a=0,h=0,l=0,c=Math.abs,u=t[h],d=c(u),p=e[l],f=c(p);d<f?(n=u,(h+=1)<i&&(d=c(u=t[h]))):(n=p,(l+=1)<s&&(f=c(p=e[l]))),h<i&&d<f||l>=s?(o=u,(h+=1)<i&&(d=c(u=t[h]))):(o=p,(l+=1)<s&&(f=c(p=e[l])));for(var v,m,b=o+n,g=b-o,w=n-g,y=w,C=b;h<i&&l<s;)d<f?(o=u,(h+=1)<i&&(d=c(u=t[h]))):(o=p,(l+=1)<s&&(f=c(p=e[l]))),(w=(n=y)-(g=(b=o+n)-o))&&(r[a++]=w),y=C-((v=C+b)-(m=v-C))+(b-m),C=v;for(;h<i;)(w=(n=y)-(g=(b=(o=u)+n)-o))&&(r[a++]=w),y=C-((v=C+b)-(m=v-C))+(b-m),C=v,(h+=1)<i&&(u=t[h]);for(;l<s;)(w=(n=y)-(g=(b=(o=p)+n)-o))&&(r[a++]=w),y=C-((v=C+b)-(m=v-C))+(b-m),C=v,(l+=1)<s&&(p=e[l]);return y&&(r[a++]=y),C&&(r[a++]=C),a||(r[a++]=0),r.length=a,r}},572:(t,e,i)=>{"use strict";i(746),i(102);function s(t,e){var i=t.length,s=t.length-e.length,o=Math.min;if(s)return s;switch(i){case 0:return 0;case 1:return t[0]-e[0];case 2:return(a=t[0]+t[1]-e[0]-e[1])||o(t[0],t[1])-o(e[0],e[1]);case 3:var n=t[0]+t[1],r=e[0]+e[1];if(a=n+t[2]-(r+e[2]))return a;var a,h=o(t[0],t[1]),l=o(e[0],e[1]);return(a=o(h,t[2])-o(l,e[2]))||o(h+t[2],n)-o(l+e[2],r);default:var c=t.slice(0);c.sort();var u=e.slice(0);u.sort();for(var d=0;d<i;++d)if(s=c[d]-u[d])return s;return 0}}e.H=s},591:function(t,e,i){(function(){"use strict";var s=this.THREE||i(396);if(!s)throw new Error("MeshLine requires three.js");class o extends s.BufferGeometry{constructor(){super(),this.isMeshLine=!0,this.type="MeshLine",this.positions=[],this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],this.counters=[],this._points=[],this._geom=null,this.widthCallback=null,this.matrixWorld=new s.Matrix4,Object.defineProperties(this,{geometry:{enumerable:!0,get:function(){return this}},geom:{enumerable:!0,get:function(){return this._geom},set:function(t){this.setGeometry(t,this.widthCallback)}},points:{enumerable:!0,get:function(){return this._points},set:function(t){this.setPoints(t,this.widthCallback)}}})}}function n(t,e){var i=new s.Matrix4,o=new s.Ray,n=new s.Sphere,r=new s.Vector3,a=this.geometry;if(a.boundingSphere||a.computeBoundingSphere(),n.copy(a.boundingSphere),n.applyMatrix4(this.matrixWorld),!1!==t.ray.intersectSphere(n,r)){i.copy(this.matrixWorld).invert(),o.copy(t.ray).applyMatrix4(i);var h=new s.Vector3,l=new s.Vector3,c=new s.Vector3,u=this instanceof s.LineSegments?2:1,d=a.index,p=a.attributes;if(null!==d)for(var f=d.array,v=p.position.array,m=p.width.array,b=0,g=f.length-1;b<g;b+=u){var w=f[b],y=f[b+1];h.fromArray(v,3*w),l.fromArray(v,3*y);var C=void 0!==m[Math.floor(b/3)]?m[Math.floor(b/3)]:1,x=t.params.Line.threshold+this.material.lineWidth*C/2,V=x*x;if(!(o.distanceSqToSegment(h,l,r,c)>V)){r.applyMatrix4(this.matrixWorld);var M=t.ray.origin.distanceTo(r);M<t.near||M>t.far||(e.push({distance:M,point:c.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:this}),b=g)}}}}function r(t,e,i,s,o){var n;if(t=t.subarray||t.slice?t:t.buffer,i=i.subarray||i.slice?i:i.buffer,t=e?t.subarray?t.subarray(e,o&&e+o):t.slice(e,o&&e+o):t,i.set)i.set(t,s);else for(n=0;n<t.length;n++)i[n+s]=t[n];return i}o.prototype.setMatrixWorld=function(t){this.matrixWorld=t},o.prototype.setGeometry=function(t,e){this._geometry=t,this.setPoints(t.getAttribute("position").array,e)},o.prototype.setPoints=function(t,e){if(t instanceof Float32Array||t instanceof Array){if(this._points=t,this.widthCallback=e,this.positions=[],this.counters=[],t.length&&t[0]instanceof s.Vector3)for(var i=0;i<t.length;i++){var o=t[i],n=i/t.length;this.positions.push(o.x,o.y,o.z),this.positions.push(o.x,o.y,o.z),this.counters.push(n),this.counters.push(n)}else for(i=0;i<t.length;i+=3)n=i/t.length,this.positions.push(t[i],t[i+1],t[i+2]),this.positions.push(t[i],t[i+1],t[i+2]),this.counters.push(n),this.counters.push(n);this.process()}else console.error("ERROR: The BufferArray of points is not instancied correctly.")},o.prototype.raycast=n,o.prototype.compareV3=function(t,e){var i=6*t,s=6*e;return this.positions[i]===this.positions[s]&&this.positions[i+1]===this.positions[s+1]&&this.positions[i+2]===this.positions[s+2]},o.prototype.copyV3=function(t){var e=6*t;return[this.positions[e],this.positions[e+1],this.positions[e+2]]},o.prototype.process=function(){var t,e,i=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],e=this.compareV3(0,i-1)?this.copyV3(i-2):this.copyV3(0),this.previous.push(e[0],e[1],e[2]),this.previous.push(e[0],e[1],e[2]);for(var o=0;o<i;o++){if(this.side.push(1),this.side.push(-1),t=this.widthCallback?this.widthCallback(o/(i-1)):1,this.width.push(t),this.width.push(t),this.uvs.push(o/(i-1),0),this.uvs.push(o/(i-1),1),o<i-1){e=this.copyV3(o),this.previous.push(e[0],e[1],e[2]),this.previous.push(e[0],e[1],e[2]);var n=2*o;this.indices_array.push(n,n+1,n+2),this.indices_array.push(n+2,n+1,n+3)}o>0&&(e=this.copyV3(o),this.next.push(e[0],e[1],e[2]),this.next.push(e[0],e[1],e[2]))}e=this.compareV3(i-1,0)?this.copyV3(1):this.copyV3(i-1),this.next.push(e[0],e[1],e[2]),this.next.push(e[0],e[1],e[2]),this._attributes&&this._attributes.position.count===this.positions.length?(this._attributes.position.copyArray(new Float32Array(this.positions)),this._attributes.position.needsUpdate=!0,this._attributes.previous.copyArray(new Float32Array(this.previous)),this._attributes.previous.needsUpdate=!0,this._attributes.next.copyArray(new Float32Array(this.next)),this._attributes.next.needsUpdate=!0,this._attributes.side.copyArray(new Float32Array(this.side)),this._attributes.side.needsUpdate=!0,this._attributes.width.copyArray(new Float32Array(this.width)),this._attributes.width.needsUpdate=!0,this._attributes.uv.copyArray(new Float32Array(this.uvs)),this._attributes.uv.needsUpdate=!0,this._attributes.index.copyArray(new Uint16Array(this.indices_array)),this._attributes.index.needsUpdate=!0):this._attributes={position:new s.BufferAttribute(new Float32Array(this.positions),3),previous:new s.BufferAttribute(new Float32Array(this.previous),3),next:new s.BufferAttribute(new Float32Array(this.next),3),side:new s.BufferAttribute(new Float32Array(this.side),1),width:new s.BufferAttribute(new Float32Array(this.width),1),uv:new s.BufferAttribute(new Float32Array(this.uvs),2),index:new s.BufferAttribute(new Uint16Array(this.indices_array),1),counters:new s.BufferAttribute(new Float32Array(this.counters),1)},this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setIndex(this._attributes.index),this.computeBoundingSphere(),this.computeBoundingBox()},o.prototype.advance=function(t){var e=this._attributes.position.array,i=this._attributes.previous.array,s=this._attributes.next.array,o=e.length;r(e,0,i,0,o),r(e,6,e,0,o-6),e[o-6]=t.x,e[o-5]=t.y,e[o-4]=t.z,e[o-3]=t.x,e[o-2]=t.y,e[o-1]=t.z,r(e,6,s,0,o-6),s[o-6]=t.x,s[o-5]=t.y,s[o-4]=t.z,s[o-3]=t.x,s[o-2]=t.y,s[o-1]=t.z,this._attributes.position.needsUpdate=!0,this._attributes.previous.needsUpdate=!0,this._attributes.next.needsUpdate=!0},s.ShaderChunk.meshline_vert=["",s.ShaderChunk.logdepthbuf_pars_vertex,s.ShaderChunk.fog_pars_vertex,"","attribute vec3 previous;","attribute vec3 next;","attribute float side;","attribute float width;","attribute float counters;","","uniform vec2 resolution;","uniform float lineWidth;","uniform vec3 color;","uniform float opacity;","uniform float sizeAttenuation;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","vec2 fix( vec4 i, float aspect ) {","","    vec2 res = i.xy / i.w;","    res.x *= aspect;","\t vCounters = counters;","    return res;","","}","","void main() {","","    float aspect = resolution.x / resolution.y;","","    vColor = vec4( color, opacity );","    vUV = uv;","","    mat4 m = projectionMatrix * modelViewMatrix;","    vec4 finalPosition = m * vec4( position, 1.0 );","    vec4 prevPos = m * vec4( previous, 1.0 );","    vec4 nextPos = m * vec4( next, 1.0 );","","    vec2 currentP = fix( finalPosition, aspect );","    vec2 prevP = fix( prevPos, aspect );","    vec2 nextP = fix( nextPos, aspect );","","    float w = lineWidth * width;","","    vec2 dir;","    if( nextP == currentP ) dir = normalize( currentP - prevP );","    else if( prevP == currentP ) dir = normalize( nextP - currentP );","    else {","        vec2 dir1 = normalize( currentP - prevP );","        vec2 dir2 = normalize( nextP - currentP );","        dir = normalize( dir1 + dir2 );","","        vec2 perp = vec2( -dir1.y, dir1.x );","        vec2 miter = vec2( -dir.y, dir.x );","        //w = clamp( w / dot( miter, perp ), 0., 4. * lineWidth * width );","","    }","","    //vec2 normal = ( cross( vec3( dir, 0. ), vec3( 0., 0., 1. ) ) ).xy;","    vec4 normal = vec4( -dir.y, dir.x, 0., 1. );","    normal.xy *= .5 * w;","    normal *= projectionMatrix;","    if( sizeAttenuation == 0. ) {","        normal.xy *= finalPosition.w;","        normal.xy /= ( vec4( resolution, 0., 1. ) * projectionMatrix ).xy;","    }","","    finalPosition.xy += normal.xy * side;","","    gl_Position = finalPosition;","",s.ShaderChunk.logdepthbuf_vertex,s.ShaderChunk.fog_vertex&&"    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",s.ShaderChunk.fog_vertex,"}"].join("\n"),s.ShaderChunk.meshline_frag=["",s.ShaderChunk.fog_pars_fragment,s.ShaderChunk.logdepthbuf_pars_fragment,"","uniform sampler2D map;","uniform sampler2D alphaMap;","uniform float useMap;","uniform float useAlphaMap;","uniform float useDash;","uniform float dashArray;","uniform float dashOffset;","uniform float dashRatio;","uniform float visibility;","uniform float alphaTest;","uniform vec2 repeat;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","void main() {","",s.ShaderChunk.logdepthbuf_fragment,"","    vec4 c = vColor;","    if( useMap == 1. ) c *= texture2D( map, vUV * repeat );","    if( useAlphaMap == 1. ) c.a *= texture2D( alphaMap, vUV * repeat ).a;","    if( c.a < alphaTest ) discard;","    if( useDash == 1. ){","        c.a *= ceil(mod(vCounters + dashOffset, dashArray) - (dashArray * dashRatio));","    }","    gl_FragColor = c;","    gl_FragColor.a *= step(vCounters, visibility);","",s.ShaderChunk.fog_fragment,"}"].join("\n");class a extends s.ShaderMaterial{constructor(t){super({uniforms:Object.assign({},s.UniformsLib.fog,{lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},color:{value:new s.Color(16777215)},opacity:{value:1},resolution:{value:new s.Vector2(1,1)},sizeAttenuation:{value:1},dashArray:{value:0},dashOffset:{value:0},dashRatio:{value:.5},useDash:{value:0},visibility:{value:1},alphaTest:{value:0},repeat:{value:new s.Vector2(1,1)}}),vertexShader:s.ShaderChunk.meshline_vert,fragmentShader:s.ShaderChunk.meshline_frag}),this.isMeshLineMaterial=!0,this.type="MeshLineMaterial",Object.defineProperties(this,{lineWidth:{enumerable:!0,get:function(){return this.uniforms.lineWidth.value},set:function(t){this.uniforms.lineWidth.value=t}},map:{enumerable:!0,get:function(){return this.uniforms.map.value},set:function(t){this.uniforms.map.value=t}},useMap:{enumerable:!0,get:function(){return this.uniforms.useMap.value},set:function(t){this.uniforms.useMap.value=t}},alphaMap:{enumerable:!0,get:function(){return this.uniforms.alphaMap.value},set:function(t){this.uniforms.alphaMap.value=t}},useAlphaMap:{enumerable:!0,get:function(){return this.uniforms.useAlphaMap.value},set:function(t){this.uniforms.useAlphaMap.value=t}},color:{enumerable:!0,get:function(){return this.uniforms.color.value},set:function(t){this.uniforms.color.value=t}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}},sizeAttenuation:{enumerable:!0,get:function(){return this.uniforms.sizeAttenuation.value},set:function(t){this.uniforms.sizeAttenuation.value=t}},dashArray:{enumerable:!0,get:function(){return this.uniforms.dashArray.value},set:function(t){this.uniforms.dashArray.value=t,this.useDash=0!==t?1:0}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(t){this.uniforms.dashOffset.value=t}},dashRatio:{enumerable:!0,get:function(){return this.uniforms.dashRatio.value},set:function(t){this.uniforms.dashRatio.value=t}},useDash:{enumerable:!0,get:function(){return this.uniforms.useDash.value},set:function(t){this.uniforms.useDash.value=t}},visibility:{enumerable:!0,get:function(){return this.uniforms.visibility.value},set:function(t){this.uniforms.visibility.value=t}},alphaTest:{enumerable:!0,get:function(){return this.uniforms.alphaTest.value},set:function(t){this.uniforms.alphaTest.value=t}},repeat:{enumerable:!0,get:function(){return this.uniforms.repeat.value},set:function(t){this.uniforms.repeat.value.copy(t)}}}),this.setValues(t)}}a.prototype.copy=function(t){return s.ShaderMaterial.prototype.copy.call(this,t),this.lineWidth=t.lineWidth,this.map=t.map,this.useMap=t.useMap,this.alphaMap=t.alphaMap,this.useAlphaMap=t.useAlphaMap,this.color.copy(t.color),this.opacity=t.opacity,this.resolution.copy(t.resolution),this.sizeAttenuation=t.sizeAttenuation,this.dashArray.copy(t.dashArray),this.dashOffset.copy(t.dashOffset),this.dashRatio.copy(t.dashRatio),this.useDash=t.useDash,this.visibility=t.visibility,this.alphaTest=t.alphaTest,this.repeat.copy(t.repeat),this},t.exports&&(e=t.exports={MeshLine:o,MeshLineMaterial:a,MeshLineRaycast:n}),e.MeshLine=o,e.MeshLineMaterial=a,e.MeshLineRaycast=n}).call(this)},5:t=>{"use strict";t.exports=function(t,i,s){var o=t*i,n=e*t,r=n-(n-t),a=t-r,h=e*i,l=h-(h-i),c=i-l,u=a*c-(o-r*l-a*l-r*c);return s?(s[0]=u,s[1]=o,s):[u,o]};var e=+(Math.pow(2,27)+1)},359:t=>{"use strict";t.exports=function(t,e,i){var s=t+e,o=s-t,n=e-o,r=t-(s-o);return i?(i[0]=r+n,i[1]=s,i):[r+n,s]}},102:t=>{"use strict";function e(t){this.roots=new Array(t),this.ranks=new Array(t);for(var e=0;e<t;++e)this.roots[e]=e,this.ranks[e]=0}t.exports=e;var i=e.prototype;Object.defineProperty(i,"length",{get:function(){return this.roots.length}}),i.makeSet=function(){var t=this.roots.length;return this.roots.push(t),this.ranks.push(0),t},i.find=function(t){for(var e=t,i=this.roots;i[t]!==t;)t=i[t];for(;i[e]!==t;){var s=i[e];i[e]=t,e=s}return t},i.link=function(t,e){var i=this.find(t),s=this.find(e);if(i!==s){var o=this.ranks,n=this.roots,r=o[i],a=o[s];r<a?n[i]=s:a<r?n[s]=i:(n[s]=i,++o[i])}}},706:t=>{"use strict";t.exports=function(t,e,i){return 0===t.length?t:e?(i||t.sort(e),function(t,e){for(var i=1,s=t.length,o=t[0],n=t[0],r=1;r<s;++r)if(n=o,e(o=t[r],n)){if(r===i){i++;continue}t[i++]=o}return t.length=i,t}(t,e)):(i||t.sort(),function(t){for(var e=1,i=t.length,s=t[0],o=t[0],n=1;n<i;++n,o=s)if(o=s,(s=t[n])!==o){if(n===e){e++;continue}t[e++]=s}return t.length=e,t}(t))}},301:(t,e,i)=>{"use strict";var s=i(930),o=i(645),n=i(706);function r(t,e){return t-e}t.exports=function(t){var e=t.length;if(0===e)return{cells:[],positions:[]};var i=t[0].length;if(i<1)return{cells:[],positions:[]};if(1===i)return function(t){if(1===t.length)return{cells:[[-1]],positions:[]};var e=t.map((function(t,e){return[t[0],e]}));e.sort((function(t,e){return t-e}));for(var i=new Array(t.length),s=0;s<i.length;++s)i[s]=[-1,-1];for(var o=[],n=1;n<e.length;++n){var r=e[n-1],a=e[n],h=.5*(r[0]+a[0]),l=o.length;o.push([h]),i[r[1]][1]=l,i[a[1]][0]=l}return i[e[0][1]][1]=0,i[e[e.length-1][1]][0]=o.length-1,{cells:i,positions:o}}(t);for(var a=s(t,!0),h=new Array(e),l=0;l<e;++l)h[l]=[];var c,u=a.length,d=new Array(i+1),p=new Array(u),f=[];for(l=0;l<u;++l){for(var v=a[l],m=!1,b=0;b<=i;++b){var g=v[b];g<0?(p[l]=-1,m=!0):(h[g].push(l),d[b]=t[g])}m||(p[l]=f.length,f.push(o(d)))}if(2===i)for(c=new Array(e),l=0;l<e;++l){var w=h[l],y=[p[w[0]]],C=a[w[0]][(a[w[0]].indexOf(l)+1)%3];for(b=1;b<w.length;++b)for(var x=1;x<w.length;++x){var V=(a[w[x]].indexOf(l)+2)%3;if(a[w[x]][V]===C){y.push(p[w[x]]),C=a[w[x]][(V+2)%3];break}}c[l]=y}else{for(l=0;l<e;++l){for(C=h[l],b=0;b<C.length;++b)C[b]=p[C[b]];n(C,r)}c=h}return{cells:c,positions:f}}},396:t=>{"use strict";t.exports=THREE}},e={};function i(s){var o=e[s];if(void 0!==o)return o.exports;var n=e[s]={exports:{}};return t[s].call(n.exports,n,n.exports,i),n.exports}i.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return i.d(e,{a:e}),e},i.d=(t,e)=>{for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})},i.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),i.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var s={};(()=>{"use strict";i.r(s),i.d(s,{BrillouinZoneViewer:()=>m,StructureViewer:()=>l});var t=i(396),e=new CustomEvent("change"),o=new CustomEvent("start"),n=new CustomEvent("end"),r=-1;class a{constructor(e,i){this._state=r,this.object=e,this.domElement=void 0!==i?i:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=.2,this.panSpeed=.3,this.enableRotate=!0,this.enableZoom=!0,this.enablePan=!0,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.rotationCenter=new t.Vector3,this.target=new t.Vector3,this._prevState=r,this._eye=new t.Vector3,this._movePrev=new t.Vector2,this._moveCurr=new t.Vector2,this._lastAxis=new t.Vector3,this._lastAngle=0,this._lastPosition=new t.Vector3,this._zoomStart=new t.Vector2,this._zoomEnd=new t.Vector2,this._touchZoomDistanceStart=0,this._touchZoomDistanceEnd=0,this._panStart=new t.Vector2,this._panEnd=new t.Vector2,this._zoomed=!1,this.rotationCenter0=this.rotationCenter.clone(),this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.zoom0=this.object.zoom,this.domElement.addEventListener("contextmenu",this.contextmenu.bind(this),!1),this.domElement.addEventListener("mousedown",this.mousedown.bind(this),!1),this.domElement.addEventListener("mousewheel",this.mousewheel.bind(this),!1),this.domElement.addEventListener("MozMousePixelScroll",this.mousewheel.bind(this),!1),this.domElement.addEventListener("touchstart",this.touchstart.bind(this),!1),this.domElement.addEventListener("touchend",this.touchend.bind(this),!1),this.domElement.addEventListener("touchmove",this.touchmove.bind(this),!1),this.domElement.addEventListener("mousemove",this.mousemove.bind(this),!1),this.domElement.addEventListener("mouseup",this.mouseup.bind(this),!1),this.handleResize(),this.update()}handleResize(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var t=this.domElement.getBoundingClientRect(),e=this.domElement.ownerDocument.documentElement;this.screen.left=t.left+window.pageXOffset-e.clientLeft,this.screen.top=t.top+window.pageYOffset-e.clientTop,this.screen.width=t.width,this.screen.height=t.height}}handleEvent(t){"function"==typeof this[t.type]&&this[t.type](t)}getMouseOnScreen(e,i){var s=new t.Vector2;return s.set((e-this.screen.left)/this.screen.width,(i-this.screen.top)/this.screen.width),s}getMouseOnCircle(e,i){var s=new t.Vector2;return s.set((e-.5*this.screen.width-this.screen.left)/(.5*this.screen.width),(this.screen.height+2*(this.screen.top-i))/this.screen.width),s}rotateCamera(){var e,i=new t.Vector3,s=new t.Quaternion,o=new t.Vector3,n=new t.Vector3,r=new t.Vector3,a=new t.Vector3;if(a.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0),e=a.length()){this._eye.copy(this.object.position).sub(this.rotationCenter),o.copy(this._eye).normalize(),n.copy(this.object.up).normalize(),r.crossVectors(n,o).normalize(),n.setLength(this._moveCurr.y-this._movePrev.y),r.setLength(this._moveCurr.x-this._movePrev.x),a.copy(n.add(r)),i.crossVectors(a,this._eye).normalize();var h=this.object.zoom;e*=this.rotateSpeed,e/=h,s.setFromAxisAngle(i,e),this._eye.applyQuaternion(s),this.object.up.applyQuaternion(s),this._lastAxis.copy(i),this._lastAngle=e}else!this.staticMoving&&this._lastAngle&&(this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor),this._eye.copy(this.object.position).sub(this.rotationCenter),s.setFromAxisAngle(this._lastAxis,this._lastAngle),this._eye.applyQuaternion(s),this.object.up.applyQuaternion(s));this._movePrev.copy(this._moveCurr)}zoomCamera(){var t;4===this._state?(t=this._touchZoomDistanceStart/this._touchZoomDistanceEnd,this._touchZoomDistanceStart=this._touchZoomDistanceEnd,this.object.zoom/=t,this.object.updateProjectionMatrix(),this._zoomed=!0):1!=(t=this._zoomEnd.y-this._zoomStart.y+1)&&t>0&&(this.object.zoom/=t,this.object.updateProjectionMatrix(),this._zoomed=!0,this.staticMoving?this._zoomStart.copy(this._zoomEnd):this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor)}panCamera(){var e=new t.Vector2,i=new t.Vector3,s=new t.Vector3;if(e.copy(this._panEnd).sub(this._panStart),e.lengthSq()){var o=this.object.zoom;e.multiplyScalar(this.panSpeed/o),s.copy(this._eye).cross(this.object.up).setLength(e.x),s.add(i.copy(this.object.up).setLength(e.y)),this.object.position.add(s),this.rotationCenter.add(s),this.staticMoving?this._panStart.copy(this._panEnd):this._panStart.add(e.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}}checkDistances(){(this.enableZoom||this.enablePan)&&(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&(this.object.position.addVectors(this.rotationCenter,this._eye.setLength(this.maxDistance)),this._zoomStart.copy(this._zoomEnd)),this._eye.lengthSq()<this.minDistance*this.minDistance&&(this.object.position.addVectors(this.rotationCenter,this._eye.setLength(this.minDistance)),this._zoomStart.copy(this._zoomEnd)))}update(){this._eye.subVectors(this.object.position,this.rotationCenter),this.enableRotate&&this.rotateCamera(),this.enableZoom&&this.zoomCamera(),this.enablePan&&this.panCamera(),this.object.position.addVectors(this.rotationCenter,this._eye),this.checkDistances(),this.object.lookAt(this.rotationCenter),(this._lastPosition.distanceToSquared(this.object.position)>1e-4||this._zoomed)&&(this.dispatchEvent(e),this._lastPosition.copy(this.object.position),this._zoomed=!1)}saveReset(){this.rotationCenter0.copy(this.rotationCenter),this.position0.copy(this.object.position),this.up0.copy(this.object.up),this.zoom0=this.object.zoom}reset(){this._state=r,this._prevState=r,this.rotationCenter.copy(this.rotationCenter0),this.object.position.copy(this.position0),this.object.up.copy(this.up0),this._eye.subVectors(this.object.position,this.rotationCenter),this.object.lookAt(this.rotationCenter),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(e),this._lastPosition.copy(this.object.position)}dispose(){this.domElement.removeEventListener("contextmenu",this.contextmenu.bind(this),!1),this.domElement.removeEventListener("mousedown",this.mousedown.bind(this),!1),this.domElement.removeEventListener("mousewheel",this.mousewheel.bind(this),!1),this.domElement.removeEventListener("MozMousePixelScroll",this.mousewheel.bind(this),!1),this.domElement.removeEventListener("touchstart",this.touchstart.bind(this),!1),this.domElement.removeEventListener("touchend",this.touchend.bind(this),!1),this.domElement.removeEventListener("touchmove",this.touchmove.bind(this),!1),this.domElement.removeEventListener("mousemove",this.mousemove.bind(this),!1),this.domElement.removeEventListener("mouseup",this.mouseup.bind(this),!1)}mousedown(t){!1!==this.enabled&&(t.preventDefault(),t.stopPropagation(),this._state===r&&(this._state=t.button),0===this._state&&this.enableRotate?(this._moveCurr.copy(this.getMouseOnCircle(t.pageX,t.pageY)),this._movePrev.copy(this._moveCurr)):1===this._state&&this.enableZoom?(this._zoomStart.copy(this.getMouseOnScreen(t.pageX,t.pageY)),this._zoomEnd.copy(this._zoomStart)):2===this._state&&this.enablePan&&(this._panStart.copy(this.getMouseOnScreen(t.pageX,t.pageY)),this._panEnd.copy(this._panStart)),this.dispatchEvent(o))}mousemove(t){!1!==this.enabled&&(this._state!==r&&(t.preventDefault(),t.stopPropagation()),0===this._state&&this.enableRotate?(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this.getMouseOnCircle(t.pageX,t.pageY))):1===this._state&&this.enableZoom?this._zoomEnd.copy(this.getMouseOnScreen(t.pageX,t.pageY)):2===this._state&&this.enablePan&&this._panEnd.copy(this.getMouseOnScreen(t.pageX,t.pageY)),this.update())}mouseup(t){!1!==this.enabled&&(t.preventDefault(),t.stopPropagation(),this._state=r,document.removeEventListener("mousemove",this.mousemove.bind(this)),document.removeEventListener("mouseup",this.mouseup.bind(this)),this.dispatchEvent(n))}mousewheel(t){if(!1===this.enabled)return;t.preventDefault(),t.stopPropagation();let e=0;t.wheelDelta?e=t.wheelDelta:t.detail&&(e=-t.detail),e/=Math.abs(e),this._zoomStart.y+=e*this.zoomSpeed,this.dispatchEvent(o),this.dispatchEvent(n),this.update()}touchstart(t){if(!1!==this.enabled){if(1===t.touches.length)this._state=3,this._moveCurr.copy(this.getMouseOnCircle(t.touches[0].pageX,t.touches[0].pageY)),this._movePrev.copy(this._moveCurr);else{this._state=4;var e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(e*e+i*i);var s=(t.touches[0].pageX+t.touches[1].pageX)/2,n=(t.touches[0].pageY+t.touches[1].pageY)/2;this._panStart.copy(this.getMouseOnScreen(s,n)),this._panEnd.copy(this._panStart)}this.dispatchEvent(o)}}touchmove(t){if(!1!==this.enabled){if(t.preventDefault(),t.stopPropagation(),1===t.touches.length)this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this.getMouseOnCircle(t.touches[0].pageX,t.touches[0].pageY));else{var e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY;this._touchZoomDistanceEnd=Math.sqrt(e*e+i*i);var s=(t.touches[0].pageX+t.touches[1].pageX)/2,o=(t.touches[0].pageY+t.touches[1].pageY)/2;this._panEnd.copy(this.getMouseOnScreen(s,o))}this.update()}}touchend(t){if(!1!==this.enabled){switch(t.touches.length){case 0:this._state=r;break;case 1:this._state=3,this._moveCurr.copy(this.getMouseOnCircle(t.touches[0].pageX,t.touches[0].pageY)),this._movePrev.copy(this._moveCurr)}this.dispatchEvent(n)}}contextmenu(t){t.preventDefault()}addEventListener(t,e){void 0===this._listeners&&(this._listeners={});var i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;var i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)}removeEventListener(t,e){if(void 0!==this._listeners){var i=this._listeners[t];if(void 0!==i){var s=i.indexOf(e);-1!==s&&i.splice(s,1)}}}dispatchEvent(t){if(void 0!==this._listeners){var e=this._listeners[t.type];if(void 0!==e)for(var i=e.slice(0),s=0,o=i.length;s<o;s++)i[s].call(this,t)}}}class h{constructor(t,e={}){if(this.hostElement=t,this.scenes=[],this.cameraWidth=10,this.options={},!this.webglAvailable())throw Error("WebGL is not supported on this browser, cannot display viewer.");this.setOptions(e),this.setupRootElement(),this.setupRenderer(),this.setupScenes(),this.setupCamera(),this.setupControls(),this.changeHostElement(t,!1,!1),this.options.view.autoResize&&window.addEventListener("resize",this.onWindowResize.bind(this),!1)}setOptions(t){const e={controls:{enableZoom:!0,enableRotate:!0,enablePan:!0,panSpeed:10,zoomSpeed:.2,rotateSpeed:2.5,zoomLevel:1},view:{autoFit:!0,autoResize:!0,fitMargin:.5},renderer:{background:{color:"#ffffff",opacity:0},shadows:{enabled:!1}}};this.fillOptions(t,e),this.options=e}fillOptions(t,e){!function t(e,i){for(const s in e)null!==e[s]&&"[object Object]"===Object.prototype.toString.call(e[s])?(void 0===i[s]&&(i[s]={}),t(e[s],i[s])):i[s]=e[s]}(t,e)}setup(){this.setupScenes(),this.setupLights(),this.setupCamera(),this.setupControls()}setupScenes(){this.scenes=[],this.scene=new t.Scene,this.scenes.push(this.scene)}clear(){this.clearScenes(),this.scenes=null,this.controls=null,this.camera=null}clearScenes(){for(let t=0;t<this.scenes.length;++t){let e=this.scenes[t];for(e.traverse((function(t){let e=t.geometry,i=t.material,s=t.texture;e&&e.dispose(),i&&i.dispose(),s&&s.dispose()}));e.children.length;){let t=e.children[0];e.remove(t)}}}takeScreenShot(t){let e;try{let i="image/png",s="image/octet-stream";this.render(),e=this.renderer.domElement.toDataURL(i);let o=e.replace(i,s);t+=".png";let n=document.createElement("a");n.style.display="none",document.body.appendChild(n),n.download=t,n.href=o,n.click(),document.body.removeChild(n)}catch(t){return void console.log(t)}}webglAvailable(){let t=window;try{let e=document.createElement("canvas");return!(!t.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(t){return!1}}setupRenderer(){this.renderer=new t.WebGLRenderer({alpha:!0,antialias:!0}),this.renderer.shadowMap.enabled=!1,this.renderer.shadowMap.type=t.PCFSoftShadowMap,this.renderer.setSize(this.rootElement.clientWidth,this.rootElement.clientHeight),this.renderer.setClearColor(this.options.renderer.background.color,this.options.renderer.background.opacity),this.rootElement.appendChild(this.renderer.domElement),this.renderer.autoClear=!1}setBackgroundColor(t,e){this.renderer.setClearColor(t,e)}setupCamera(){let e=this.rootElement.clientWidth/this.rootElement.clientHeight,i=this.cameraWidth,s=i/e;this.camera=new t.OrthographicCamera(i/-2,i/2,s/2,s/-2,-100,1e3),this.camera.name="camera",this.camera.position.z=20}setupRootElement(){this.rootElement=document.createElement("div"),this.rootElement.style.width="100%",this.rootElement.style.height="100%",this.rootElement.style.position="relative"}changeHostElement(t,e=!0,i=!0){if(void 0!==t){if(this.hostElement)for(;this.hostElement.firstChild;)this.hostElement.removeChild(this.hostElement.firstChild);t.appendChild(this.rootElement),this.resizeCanvasToHostElement(),e&&this.fitToCanvas(),i&&this.render()}}saveReset(){this.controls.saveReset()}reset(){this.controls.reset()}setupControls(){let e=new a(this.camera,this.rootElement);e.rotateSpeed=this.options.controls.rotateSpeed,e.rotationCenter=new t.Vector3,e.zoomSpeed=this.options.controls.zoomSpeed,e.panSpeed=this.options.controls.panSpeed,e.enableZoom=this.options.controls.enableZoom,e.enablePan=this.options.controls.enablePan,e.enableRotate=this.options.controls.enableRotate,e.staticMoving=!0,e.dynamicDampingFactor=.25,e.keys=[65,83,68],e.addEventListener("change",this.render.bind(this)),this.controls=e}createCornerPoints(e,i){const s=e.clone().add(i[0]).add(i[1]).add(i[2]),o=[e,s];for(let t=i.length,n=0;n<t;++n)o.push(e.clone().add(i[n].clone())),o.push(s.clone().sub(i[n].clone()));return(new t.BufferGeometry).setFromPoints(o)}fitToCanvas(){const{points:e,margin:i}=this.getCornerPoints();this.scenes.forEach((t=>t.updateMatrixWorld()));const s=this.rootElement,o=s.clientWidth,n=s.clientHeight,r=[],a=e.length;this.camera.zoom=this.options.controls.zoomLevel,this.camera.updateProjectionMatrix();const h=this.options.view.fitMargin+i,l=new t.Vector3(0,0,0);l.project(this.camera),l.x=Math.round((l.x+1)*o/2),l.y=Math.round((1-l.y)*n/2),l.z=0;const c=new t.Vector3(h,h,0);c.project(this.camera),c.x=Math.round((c.x+1)*o/2),c.y=Math.round((1-c.y)*n/2),c.sub(l),c.x=Math.abs(c.x),c.y=Math.abs(c.y),c.z=0;for(let t=0;t<a;++t){const i=e[t].clone();i.project(this.camera),i.x=Math.round((i.x+1)*o/2),i.y=Math.round((1-i.y)*n/2),i.z=0,r.push(i)}let u=r[0].x,d=r[0].x,p=r[0].y,f=r[0].y;for(let t=r.length,e=0;e<t;++e){const t=r[e],i=t.x,s=t.y;i>d?d=i:i<u&&(u=i),s>f?f=s:s<p&&(p=s)}u-=c.x,d+=c.x,p-=c.y,f+=c.y;const v=o/2,m=n/2,b=v/Math.abs(d-v),g=v/Math.abs(u-v),w=m/Math.abs(p-m),y=m/Math.abs(f-m),C=Math.min(b,g,w,y);this.camera.zoom=C,this.camera.updateProjectionMatrix()}getZoom(){return this.camera.zoom}setZoom(t){this.camera.zoom=t,this.camera.updateProjectionMatrix()}resizeCanvasToHostElement(){let t=this.rootElement.clientWidth/this.rootElement.clientHeight,e=this.cameraWidth,i=e/t;this.camera.left=-e/2,this.camera.right=e/2,this.camera.top=i/2,this.camera.bottom=-i/2,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.rootElement.clientWidth,this.rootElement.clientHeight),this.controls.handleResize(),this.render()}onWindowResize(){this.resizeCanvasToHostElement(),this.options.view.autoFit&&this.fitToCanvas(),this.render()}render(){this.renderer.clear();for(let t=0;t<this.scenes.length;++t){let e=this.scenes[t];this.renderer.render(e,this.camera),t!==this.scenes.length-1&&this.renderer.clearDepth()}}createCylinder(e,i,s,o,n){const r=(new t.Vector3).subVectors(i,e),a=r.length(),h=r.clone().divideScalar(a),l=new t.ArrowHelper(h,e),c=new t.CylinderGeometry(s,s,a,o),u=new t.Mesh(c,n);return u.rotation.copy(l.rotation.clone()),u.position.copy((new t.Vector3).addVectors(e,r.multiplyScalar(.5))),u}createLabel(e,i,s,o,n,r,a=0,h="#000"){const l=document.createElement("canvas");l.width=256,l.height=256;const c=l.getContext("2d");c.fillStyle=s,c.font=`230.4px ${o}`,c.textAlign="center",c.textBaseline="middle",a>0&&(c.lineWidth=256*a,c.strokeStyle=h,c.strokeText(i,128,128)),c.fillText(i,128,128);const u=new t.Texture(l);u.needsUpdate=!0;const d=new t.SpriteMaterial({map:u}),p=new t.Sprite(d);p.scale.set(n,n,1),void 0===r&&(r=new t.Vector2(0,0));const f=new t.Vector2;f.addVectors(r,new t.Vector2(.5,.5)),p.center.copy(f);const v=new t.Object3D;return v.position.copy(e),v.add(p),v}rotateAroundWorldAxis(e,i,s){const o=new t.Matrix4;o.makeRotationAxis(i.normalize(),s),o.multiply(e.matrix),e.matrix=o,e.rotation.setFromRotationMatrix(e.matrix)}coordinateTransform(t,e,i,s=!0){return(s?i.clone():i).applyMatrix3(t).applyMatrix3(e)}alignView(e,i,s,o=!0){if(void 0===e)return;if(e.length>2)throw"At most two alignments can be performed.";const n=[],r=e=>{const o=e[0],r=e[1];let a;switch(o){case"up":a=new t.Vector3(0,1,0);break;case"down":a=new t.Vector3(0,-1,0);break;case"right":a=new t.Vector3(1,0,0);break;case"left":a=new t.Vector3(-1,0,0);break;case"front":a=new t.Vector3(0,0,1);break;case"back":a=new t.Vector3(0,0,-1)}const h=i[r];for(const t of n)h[t]=0;if(h.length()>1e-8){const e=(new t.Quaternion).setFromUnitVectors(h.clone().normalize(),a);for(const t in i)i[t].applyQuaternion(e);for(const t of s)t.applyQuaternion(e),t.updateMatrixWorld();"right"==o||"left"==o?n.push("x"):"up"==o||"down"==o?n.push("y"):"front"!=o&&"back"!=o||n.push("z")}};for(const t of e)r(t);o&&this.render()}}class l extends h{constructor(){super(...arguments),this.updateBonds=!1,this.atomicRadii=[],this.elementColors=[],this.lights=[],this.bondFills=[],this.atomFills=[],this.atomOutlines=[],this.axisLabels=[],this.elementNames=["H","He","Li","Be","B","C","N","O","F","Ne","Na","Mg","Al","Si","P","S","Cl","Ar","K","Ca","Sc","Ti","V","Cr","Mn","Fe","Co","Ni","Cu","Zn","Ga","Ge","As","Se","Br","Kr","Rb","Sr","Y","Zr","Nb","Mo","Tc","Ru","Rh","Pd","Ag","Cd","In","Sn","Sb","Te","I","Xe","Cs","Ba","La","Ce","Pr","Nd","Pm","Sm","Eu","Gd","Tb","Dy","Ho","Er","Tm","Yb","Lu","Hf","Ta","W","Re","Os","Ir","Pt","Au","Hg","Tl","Pb","Bi","Po","At","Rn","Fr","Ra","Ac","Th","Pa","U","Np","Pu","Am","Cm","Bk","Cf","Es","Fm","Md","No","Lr","Rf","Ha","Sg","Ns","Hs","Mt","Ds","Rg","Cn","Nh","Fl","Mc","Lv","Ts","Og"],this.elementNumbers={H:1,He:2,Li:3,Be:4,B:5,C:6,N:7,O:8,F:9,Ne:10,Na:11,Mg:12,Al:13,Si:14,P:15,S:16,Cl:17,Ar:18,K:19,Ca:20,Sc:21,Ti:22,V:23,Cr:24,Mn:25,Fe:26,Co:27,Ni:28,Cu:29,Zn:30,Ga:31,Ge:32,As:33,Se:34,Br:35,Kr:36,Rb:37,Sr:38,Y:39,Zr:40,Nb:41,Mo:42,Tc:43,Ru:44,Rh:45,Pd:46,Ag:47,Cd:48,In:49,Sn:50,Sb:51,Te:52,I:53,Xe:54,Cs:55,Ba:56,La:57,Ce:58,Pr:59,Nd:60,Pm:61,Sm:62,Eu:63,Gd:64,Tb:65,Dy:66,Ho:67,Er:68,Tm:69,Yb:70,Lu:71,Hf:72,Ta:73,W:74,Re:75,Os:76,Ir:77,Pt:78,Au:79,Hg:80,Tl:81,Pb:82,Bi:83,Po:84,At:85,Rn:86,Fr:87,Ra:88,Ac:89,Th:90,Pa:91,U:92,Np:93,Pu:94,Am:95,Cm:96,Bk:97,Cf:98,Es:99,Fm:100,Md:101,No:102,Lr:103},this.missing=.2,this.covalentRadii=[this.missing,.31,.28,1.28,.96,.84,.76,.71,.66,.57,.58,1.66,1.41,1.21,1.11,1.07,1.05,1.02,1.06,2.03,1.76,1.7,1.6,1.53,1.39,1.39,1.32,1.26,1.24,1.32,1.22,1.22,1.2,1.19,1.2,1.2,1.16,2.2,1.95,1.9,1.75,1.64,1.54,1.47,1.46,1.42,1.39,1.45,1.44,1.42,1.39,1.39,1.38,1.39,1.4,2.44,2.15,2.07,2.04,2.03,2.01,1.99,1.98,1.98,1.96,1.94,1.92,1.92,1.89,1.9,1.87,1.87,1.75,1.7,1.62,1.51,1.44,1.41,1.36,1.36,1.32,1.45,1.46,1.48,1.4,1.5,1.5,2.6,2.21,2.15,2.06,2,1.96,1.9,1.87,1.8,1.69,this.missing,this.missing,this.missing,this.missing,this.missing,this.missing,this.missing],this.jmolColors=["#ff0000","#ffffff","#d9ffff","#cc80ff","#c2ff00","#ffb5b5","#909090","#3050f8","#ff0d0d","#90e050","#b3e3f5","#ab5cf2","#8aff00","#bfa6a6","#f0c8a0","#ff8000","#ffff30","#1ff01f","#80d1e3","#8f40d4","#3dff00","#e6e6e6","#bfc2c7","#a6a6ab","#8a99c7","#9c7ac7","#e06633","#f090a0","#50d050","#c88033","#7d80b0","#c28f8f","#668f8f","#bd80e3","#ffa100","#a62929","#5cb8d1","#702eb0","#00ff00","#94ffff","#94e0e0","#73c2c9","#54b5b5","#3b9e9e","#248f8f","#0a7d8c","#006985","#c0c0c0","#ffd98f","#a67573","#668080","#9e63b5","#d47a00","#940094","#429eb0","#57178f","#00c900","#70d4ff","#ffffc7","#d9ffc7","#c7ffc7","#a3ffc7","#8fffc7","#61ffc7","#45ffc7","#30ffc7","#1fffc7","#00ff9c","#00e675","#00d452","#00bf38","#00ab24","#4dc2ff","#4da6ff","#2194d6","#267dab","#266696","#175487","#d0d0e0","#ffd123","#b8b8d0","#a6544d","#575961","#9e4fb5","#ab5c00","#754f45","#428296","#420066","#007d00","#70abfa","#00baff","#00a1ff","#008fff","#0080ff","#006bff","#545cf2","#785ce3","#8a4fe3","#a136d4","#b31fd4","#b31fba","#b30da6","#bd0d87","#c70066","#cc0059","#d1004f","#d90045","#e00038","#e6002e","#eb0026"]}setupScenes(){this.scenes=[],this.sceneStructure=new t.Scene,this.scenes.push(this.sceneStructure),this.sceneInfo=new t.Scene,this.scenes.push(this.sceneInfo)}setOptions(t,e=!0,i=!0){var s,o,n,r,a,h,l,c;const u={view:{fitMargin:.5},layout:{periodicity:"none",translation:[0,0,0],viewCenter:"COP",wrapTolerance:.05},outline:{enabled:!0,color:"#000000",size:.025},cell:{enabled:!0,color:"#000000",linewidth:1.5,dashSize:0,gapSize:0},latticeConstants:{enabled:!0,font:"Arial",size:.7,stroke:{width:.06,color:"#000"},a:{enabled:!0,color:"#C52929",label:"a"},b:{enabled:!0,color:"#47A823",label:"b"},c:{enabled:!0,color:"#3B5796",label:"c"},alpha:{enabled:!0,color:"#ffffff",label:""},beta:{enabled:!0,color:"#ffffff",label:""},gamma:{enabled:!0,color:"#ffffff",label:""}},bonds:{enabled:!0,material:{phong:{shininess:30}},color:"#ffffff",radius:.08,threshold:1,smoothness:145},atoms:{material:{phong:{shininess:30}},colors:"Jmol",radii:"covalent",scale:1,smoothness:165}};0===Object.keys(this.options).length?(this.fillOptions(t,u),super.setOptions(u)):(this.fillOptions(t,this.options),super.setOptions(this.options),i&&(this.needFullReload(t)&&void 0!==this.structure?this.load(this.structure):(void 0!==(null===(s=null==t?void 0:t.latticeConstants)||void 0===s?void 0:s.enabled)&&this.toggleLatticeConstants(t.latticeConstants.enabled),void 0!==(null===(o=null==t?void 0:t.cell)||void 0===o?void 0:o.enabled)&&this.toggleCell(t.cell.enabled),void 0!==(null===(n=null==t?void 0:t.bonds)||void 0===n?void 0:n.enabled)&&this.toggleBonds(t.bonds.enabled),void 0!==(null===(a=null===(r=null==t?void 0:t.renderer)||void 0===r?void 0:r.shadows)||void 0===a?void 0:a.enabled)&&this.toggleShadows(t.renderer.shadows.enabled))),void 0!==(null===(h=null==t?void 0:t.renderer)||void 0===h?void 0:h.background)&&this.setBackgroundColor(null===(l=null==t?void 0:t.renderer)||void 0===l?void 0:l.background.color,null===(c=null==t?void 0:t.renderer)||void 0===c?void 0:c.background.opacity),e&&this.render())}needFullReload(t){return function t(e,i){for(const s in e)if(null!==e[s]&&"[object Object]"===Object.prototype.toString.call(e[s])){if(void 0===i[s])return!0;if(t(e[s],i[s]))return!0}else if(void 0===i[s])return!0;return!1}(t,{cell:{enabled:!0},latticeConstants:{enabled:!0},bonds:{enabled:!0},shadows:{enabled:!0}})}getOptions(){return this.options}getElementInfo(){return this.elements}toggleLatticeConstants(t){void 0!==this.latticeConstants&&(this.latticeConstants.visible=t,this.angleArcs.visible=t)}toggleCell(t){void 0!==this.convCell&&(this.convCell.visible=t),void 0!==this.primCell&&(this.primCell.visible=t)}toggleBonds(t){t&&this.createBonds(),void 0!==this.bonds&&(this.bonds.visible=t)}toggleShadows(t){var e,i,s;this.renderer.shadowMap.enabled=t;for(let e=0;e<this.lights.length;++e)this.lights[e].castShadow=t;for(let e=0;e<this.atomFills.length;++e){let i=this.atomFills[e];i.receiveShadow=t,i.castShadow=t,i.material.needsUpdate=!0}for(let o=0;o<this.bondFills.length;++o){let n=this.bondFills[o];n.receiveShadow=t,void 0!==(null===(s=null===(i=null===(e=this.options)||void 0===e?void 0:e.atoms)||void 0===i?void 0:i.material)||void 0===s?void 0:s.toon)?n.castShadow=!1:n.castShadow=t,n.material.needsUpdate=!0}this.render(),this.render()}clear(){super.clear(),this.structure=void 0,this.atoms=void 0,this.convCell=void 0,this.primCell=void 0,this.bonds=void 0,this.atomPos=void 0,this.atomNumbers=void 0,this.latticeConstants=void 0,this.B=void 0,this.Bi=void 0,this.basisVectors=void 0,this.elements=void 0,this.maxRadii=void 0,this.atomicRadii=void 0,this.elementColors=void 0}load(e){var i,s,o,n,r,a;this.clear(),this.setup(),this.structure=e,this.setupScenes(),this.setupLights(),this.setupCamera(),this.setupControls(),"covalent"===this.options.atoms.radii?this.atomicRadii=this.covalentRadii:Array.isArray(this.options.atoms.radii)&&(this.atomicRadii=this.options.atoms.radii),"Jmol"===this.options.atoms.colors?this.elementColors=this.jmolColors:Array.isArray(this.options.atoms.colors)&&(this.elementColors=this.options.atoms.colors);const h=void 0!==e.fractional&&e.fractional,l=e.positions,c=e.species,u=e.cell;let d=e.pbc,p=e.bonds;if(!l)return console.log("No atom positions given to the structure viewer"),!1;if(!c)return console.log("No species  given to the structure viewer."),!1;const f="number"==typeof c[0]?c:c.map((t=>this.elementNumbers[t]));if(this.maxRadii=Math.max(...f.map((t=>this.atomicRadii[t]))),p){if(!Array.isArray(p))return console.log("Invalid value for 'bonds'. Provide a list of index pairs."),!1}else p="auto";if(l.length!=f.length)return console.log("The number of positions does not match the number of labels."),!1;null!=d&&null!=d||(d=[!1,!1,!1]),this.root=new t.Object3D,this.container=new t.Object3D,this.infoContainer=new t.Object3D,this.atoms=new t.Object3D,this.bonds=new t.Object3D,this.container.add(this.atoms),this.container.add(this.bonds),this.angleArcs=new t.Object3D,this.root.add(this.container),this.sceneStructure.add(this.root),this.sceneInfo.add(this.infoContainer),this.latticeConstants=new t.Object3D,this.container.add(this.latticeConstants),this.createBasisVectors(u);let v=[],m=[];!0===h?(v=this.toVectors(l),m=this.toCartesian(v,!0)):!1===h&&(m=this.toVectors(l),void 0!==this.B&&(v=this.toScaled(m,!0)));let b=0;const g=[],w=d[0],y=d[1],C=d[2];if(w&&y&&C)b=3;else if(w||y||C)for(let t=0;t<3;++t){const e=d[t],i=d[(t+1)%3],s=d[(t+2)%3];if(e&&!i&&!s){b=1,g.push(t);break}if(e&&i&&!s){b=2,g.push(t),g.push((t+1)%3);break}}else b=0;void 0!==this.B?(this.createConventionalCell(d,this.options.cell.enabled),this.createLatticeConstants(this.basisVectors,d,g),this.createAtoms(v,f,d,!0)):void 0!==this.basisVectors?(this.createConventionalCell(d,this.options.cell.enabled),this.createLatticeConstants(this.basisVectors,d,g),this.createAtoms(m,f,d,!1)):this.createAtoms(m,f,d,!1);let x=this.getPositions();this.createBonds(p);let V,M=this.options.layout.viewCenter;return"COP"===M?V=this.calculateCOP(x):"COC"===M?V=(new t.Vector3).add(this.basisVectors[0]).add(this.basisVectors[1]).add(this.basisVectors[2]).multiplyScalar(.5):Array.isArray(M)&&(V=(new t.Vector3).fromArray(M)),this.setViewCenter(V),this.translate(this.options.layout.translation),this.setZoom(this.options.controls.zoomLevel),void 0!==this.basisVectors&&this.alignView(null===(o=null===(s=null===(i=this.options)||void 0===i?void 0:i.layout)||void 0===s?void 0:s.viewRotation)||void 0===o?void 0:o.alignments),this.rotateView(null===(a=null===(r=null===(n=this.options)||void 0===n?void 0:n.layout)||void 0===r?void 0:r.viewRotation)||void 0===a?void 0:a.rotations),this.options.view.autoFit&&this.fitToCanvas(),this.toggleShadows(this.options.renderer.shadows.enabled),this.render(),!0}calculateCOP(e){let i=e.length,s=new t.Vector3;for(let t=0;t<i;++t){let i=e[t];s.add(i)}return s.divideScalar(i),s}setViewCenter(t){this.container.position.sub(t),this.infoContainer.position.sub(t),this.render()}translate(e){const i=(new t.Vector3).fromArray(e);this.atoms.position.add(i),this.bonds.position.add(i),this.render()}setPositions(t,e=!1,i=!0){if("none"!==this.options.layout.periodicity&&"wrap"!==this.options.layout.periodicity)throw"Setting new positions is not allowed when options.layout.periodicity != 'none'/'wrap'.";const s=this.toVectors(t);"wrap"===this.options.layout.periodicity&&this.wrap(s,e),e&&this.toCartesian(s,!1);for(let t=0,e=s.length;t<e;++t){const e=s[t];this.getAtom(t).position.copy(e)}this.updateBonds=!0,this.createBonds(),i&&this.render()}getPositions(t=!1){let e=[],i=this.atoms.children,s=i.length;if(t){let t=[];for(let e=0;e<s;++e){let s=i[e].position.clone();t.push(s)}e=this.toScaled(t)}else for(let t=0;t<s;++t){let s=i[t].position.clone();e.push(s)}return e}toVectors(e,i=!0){const s=[];for(let i=0,o=e.length;i<o;++i)s.push((new t.Vector3).fromArray(e[i]));if(i)return s;e=s}toCartesian(t,e=!0){if(e){const e=[];for(let i=0,s=t.length;i<s;++i)e.push(t[i].clone().applyMatrix3(this.B));return e}for(let e=0,i=t.length;e<i;++e)t[e].applyMatrix3(this.B)}toScaled(t,e=!0){if(e){const e=[];for(let i=0,s=t.length;i<s;++i)e.push(t[i].clone().applyMatrix3(this.Bi));return e}for(let e=0,i=t.length;e<i;++e)t[e].applyMatrix3(this.Bi)}getAtom(t){return this.atoms.getObjectByName(`atom${t}`)}setZoom(t){this.camera.zoom=t,this.render()}setupLights(){var e,i,s,o,n,r;this.lights=[];let a=2048,h=-.001,l=new t.DirectionalLight(16777215,.45);l.shadow.mapSize.width=a,l.shadow.mapSize.height=a,l.shadow.bias=h,l.shadow.camera.left=-50,l.shadow.camera.right=50,l.shadow.camera.top=50,l.shadow.camera.bottom=-50,l.position.set(0,0,20),this.sceneStructure.add(l),this.lights.push(l);let c=new t.DirectionalLight(16777215,.3);c.shadow.mapSize.width=a,c.shadow.mapSize.height=a,c.shadow.bias=h,c.position.set(-20,0,-20),void 0===(null===(s=null===(i=null===(e=this.options)||void 0===e?void 0:e.atoms)||void 0===i?void 0:i.material)||void 0===s?void 0:s.toon)&&(this.sceneStructure.add(c),this.lights.push(c));let u=new t.DirectionalLight(16777215,.25);u.shadow.mapSize.width=a,u.shadow.mapSize.height=a,u.shadow.bias=h,u.position.set(20,0,-20),void 0===(null===(r=null===(n=null===(o=this.options)||void 0===o?void 0:o.atoms)||void 0===n?void 0:n.material)||void 0===r?void 0:r.toon)&&(this.sceneStructure.add(u),this.lights.push(u));let d=new t.AmbientLight(4210752,1.7);this.sceneStructure.add(d)}createLatticeConstants(e,i,s){var o,n,r,a,h,l,c,u,d,p,f,v,m,b,g,w,y,C,x,V,M,A,S,_;if(!this.options.latticeConstants.enabled)return;this.axisLabels=[],this.infoContainer.add(this.latticeConstants),this.infoContainer.add(this.angleArcs),new t.LineBasicMaterial({color:"#000000",linewidth:1.5});let z=-1,E=[];E.push(this.options.latticeConstants.a.color),E.push(this.options.latticeConstants.b.color),E.push(this.options.latticeConstants.c.color);const P=[];P.push(this.options.latticeConstants.alpha.color),P.push(this.options.latticeConstants.beta.color),P.push(this.options.latticeConstants.gamma.color);const k=[];k.push(void 0===(null===(n=null===(o=this.options.latticeConstants.alpha)||void 0===o?void 0:o.stroke)||void 0===n?void 0:n.color)?this.options.latticeConstants.stroke.color:this.options.latticeConstants.alpha.stroke.color),k.push(void 0===(null===(a=null===(r=this.options.latticeConstants.beta)||void 0===r?void 0:r.stroke)||void 0===a?void 0:a.color)?this.options.latticeConstants.stroke.color:this.options.latticeConstants.beta.stroke.color),k.push(void 0===(null===(l=null===(h=this.options.latticeConstants.gamma)||void 0===h?void 0:h.stroke)||void 0===l?void 0:l.color)?this.options.latticeConstants.stroke.color:this.options.latticeConstants.gamma.stroke.color);const j=[];j.push(void 0===(null===(u=null===(c=this.options.latticeConstants.alpha)||void 0===c?void 0:c.stroke)||void 0===u?void 0:u.width)?this.options.latticeConstants.stroke.width:this.options.latticeConstants.alpha.stroke.width),j.push(void 0===(null===(p=null===(d=this.options.latticeConstants.beta)||void 0===d?void 0:d.stroke)||void 0===p?void 0:p.width)?this.options.latticeConstants.stroke.width:this.options.latticeConstants.beta.stroke.width),j.push(void 0===(null===(v=null===(f=this.options.latticeConstants.gamma)||void 0===f?void 0:f.stroke)||void 0===v?void 0:v.width)?this.options.latticeConstants.stroke.width:this.options.latticeConstants.gamma.stroke.width);let L=[this.options.latticeConstants.gamma.label,this.options.latticeConstants.alpha.label,this.options.latticeConstants.beta.label],F=[this.options.latticeConstants.a.label,this.options.latticeConstants.b.label,this.options.latticeConstants.c.label],T=[this.options.latticeConstants.gamma.enabled,this.options.latticeConstants.alpha.enabled,this.options.latticeConstants.beta.enabled],B=[this.options.latticeConstants.a.enabled,this.options.latticeConstants.b.enabled,this.options.latticeConstants.c.enabled],O=[];O.push(void 0===this.options.latticeConstants.a.font?this.options.latticeConstants.font:this.options.latticeConstants.a.font),O.push(void 0===this.options.latticeConstants.b.font?this.options.latticeConstants.font:this.options.latticeConstants.b.font),O.push(void 0===this.options.latticeConstants.c.font?this.options.latticeConstants.font:this.options.latticeConstants.c.font);const D=[];D.push(void 0===this.options.latticeConstants.a.size?this.options.latticeConstants.size:this.options.latticeConstants.a.size),D.push(void 0===this.options.latticeConstants.b.size?this.options.latticeConstants.size:this.options.latticeConstants.b.size),D.push(void 0===this.options.latticeConstants.c.size?this.options.latticeConstants.size:this.options.latticeConstants.c.size);const R=[];R.push(void 0===(null===(b=null===(m=this.options.latticeConstants.a)||void 0===m?void 0:m.stroke)||void 0===b?void 0:b.color)?this.options.latticeConstants.stroke.color:this.options.latticeConstants.a.stroke.color),R.push(void 0===(null===(w=null===(g=this.options.latticeConstants.b)||void 0===g?void 0:g.stroke)||void 0===w?void 0:w.color)?this.options.latticeConstants.stroke.color:this.options.latticeConstants.b.stroke.color),R.push(void 0===(null===(C=null===(y=this.options.latticeConstants.c)||void 0===y?void 0:y.stroke)||void 0===C?void 0:C.color)?this.options.latticeConstants.stroke.color:this.options.latticeConstants.c.stroke.color);const W=[];W.push(void 0===(null===(V=null===(x=this.options.latticeConstants.a)||void 0===x?void 0:x.stroke)||void 0===V?void 0:V.width)?this.options.latticeConstants.stroke.width:this.options.latticeConstants.a.stroke.width),W.push(void 0===(null===(A=null===(M=this.options.latticeConstants.b)||void 0===M?void 0:M.stroke)||void 0===A?void 0:A.width)?this.options.latticeConstants.stroke.width:this.options.latticeConstants.b.stroke.width),W.push(void 0===(null===(_=null===(S=this.options.latticeConstants.c)||void 0===S?void 0:S.stroke)||void 0===_?void 0:_.width)?this.options.latticeConstants.stroke.width:this.options.latticeConstants.c.stroke.width);const N=[];N.push(void 0===this.options.latticeConstants.alpha.font?this.options.latticeConstants.font:this.options.latticeConstants.alpha.font),N.push(void 0===this.options.latticeConstants.beta.font?this.options.latticeConstants.font:this.options.latticeConstants.beta.font),N.push(void 0===this.options.latticeConstants.gamma.font?this.options.latticeConstants.font:this.options.latticeConstants.gamma.font);const H=[];H.push(void 0===this.options.latticeConstants.alpha.size?this.options.latticeConstants.size:this.options.latticeConstants.alpha.size),H.push(void 0===this.options.latticeConstants.beta.size?this.options.latticeConstants.size:this.options.latticeConstants.beta.size),H.push(void 0===this.options.latticeConstants.gamma.size?this.options.latticeConstants.size:this.options.latticeConstants.gamma.size);for(let i=0;i<3;++i){z+=1;let s=F[z],o=E[z],n=O[z],r=D[z],a=H[z],h=W[z],l=R[z],c=N[z],u=P[z],d=L[z],p=k[z],f=j[z],v=B[z],m=T[z];const b=this.basisVectorCollapsed[i],g=this.basisVectorCollapsed[(i+1)%3],w=this.basisVectorCollapsed[(i+2)%3];let y=e[i],C=e[(i+1)%3].clone(),x=e[(i+2)%3].clone();if(v&&!b){const e=new t.Vector3(0,0,0),a=y.clone(),c=a.clone().multiplyScalar(.5);let u,d;if(g&&w)d=new t.Vector3(0,0,1),u=(new t.Vector3).crossVectors(y,d);else if(g)d=(new t.Vector3).crossVectors(y,x),u=(new t.Vector3).crossVectors(y,d);else if(w)d=(new t.Vector3).crossVectors(y,C),u=(new t.Vector3).crossVectors(y,d);else{const e=(new t.Vector3).crossVectors(y,C),i=(new t.Vector3).crossVectors(y,x);u=(new t.Vector3).sub(e).add(i)}u.normalize(),u.multiplyScalar(.8),c.add(u);const p=this.createLabel(c,s,o,n,r,new t.Vector2(0,0),h,l);this.latticeConstants.add(p),this.axisLabels.push(p);const f=new t.MeshBasicMaterial({color:o,transparent:!0,opacity:.75}),v=y.clone(),m=this.createCylinder(e.clone(),v.clone().add(e),.09,10,f);this.latticeConstants.add(m);const b=new t.MeshBasicMaterial({color:"#000000"}),V=this.basisVectors[i].clone(),M=V.clone().multiplyScalar(1+1.3/V.length()),A=this.createCylinder(e.clone(),M,.02,10,b);this.latticeConstants.add(A);const S=new t.CylinderGeometry(0,.1,.5,12),_=new t.MeshBasicMaterial({color:0}),z=new t.Mesh(S,_);z.position.copy(a).multiplyScalar(1+1.3/a.length()),z.lookAt(new t.Vector3),z.rotateX(-Math.PI/2),this.latticeConstants.add(z)}if(m&&!b&&!g){const e=new t.LineDashedMaterial({color:0,linewidth:2,dashSize:.2,gapSize:.1}),i=(new t.Vector3).crossVectors(y,C),s=y.angleTo(C),o=Math.max(Math.min(1/4*y.length(),1/4*C.length()),1),n=20,r=new t.EllipseCurve(0,0,o,o,0,s,!1,0).getSpacedPoints(n),h=(new t.BufferGeometry).setFromPoints(r),l=new t.Line(h,e);l.computeLineDistances();const v=new t.Vector3(1,0,0),m=(new t.Quaternion).setFromUnitVectors(v,y.clone().normalize());l.quaternion.copy(m);const b=h.attributes.position.array,g=b.length/3,w=(new t.Vector3).fromArray(b,3*(g-1));l.updateMatrixWorld();const x=l.localToWorld(w.clone()),V=y,M=(new t.Vector3).crossVectors(V,x);let A=i.angleTo(M);(new t.Vector3).crossVectors(C,x).dot(V)>0&&(A=-A),l.rotateX(A),l.updateMatrixWorld(),l.updateMatrix();const S=l.localToWorld((new t.Vector3).fromArray(b,3*(n/2-1))),_=S.length();S.multiplyScalar(1+.3/_);const z=this.createLabel(S,d.toString(),u,c,a,new t.Vector2(0,0),f,p);this.latticeConstants.add(z),this.axisLabels.push(z),this.angleArcs.add(l)}}}createBasisVectors(e){if(void 0===e)return this.basisVectors=void 0,this.B=void 0,void(this.Bi=void 0);const i=(new t.Vector3).fromArray(e[0]),s=(new t.Vector3).fromArray(e[1]),o=(new t.Vector3).fromArray(e[2]);this.basisVectors=[i,s,o];const n=new t.Matrix3;n.set(i.x,s.x,o.x,i.y,s.y,o.y,i.z,s.z,o.z),this.basisVectorCollapsed=[];for(let t=0;t<3;++t){const e=this.basisVectors[t].length();this.basisVectorCollapsed.push(e<1e-6)}this.basisVectorCollapsed.some((t=>t))?(this.B=void 0,this.Bi=void 0):(this.B=n,this.Bi=(new t.Matrix3).copy(n).invert())}getCornerPoints(){this.atoms.updateMatrixWorld();const e=this.atoms.children,i=e.length,s=[];for(let o=0;o<i;++o){const i=e[o],n=new t.Vector3;i.getWorldPosition(n),s.push(n)}return{points:s,margin:this.maxRadii}}createConventionalCell(e,i){const s=this.createCell(new t.Vector3,this.basisVectors,this.basisVectorCollapsed,e,this.options.cell.color,this.options.cell.linewidth,this.options.cell.dashSize,this.options.cell.gapSize);s.visible=i,this.convCell=s,this.container.add(this.convCell)}createCell(e,i,s,o,n,r,a,h){let l,c=new t.Object3D;l=0!==a||0!==h?new t.LineDashedMaterial({color:n,linewidth:r,dashSize:a,gapSize:h}):new t.LineBasicMaterial({color:n,linewidth:r});for(let n=i.length,r=0;r<n;++r){let a=i[r].clone(),h=s[r],u=l.clone();if(o[r]||!h){const i=[];i.push(e.clone()),i.push(a.clone().add(e));const s=(new t.BufferGeometry).setFromPoints(i);let o=new t.Line(s,u);c.add(o),o.computeLineDistances()}let d=i[(r+1)%n].clone();if(o[r]&&o[(r+1)%3]||!h){let i=l.clone();const s=[];s.push(d.clone().add(e)),s.push(a.clone().add(d).add(e));let o=(new t.BufferGeometry).setFromPoints(s),n=new t.Line(o,i);c.add(n),n.computeLineDistances()}let p=i[(r+2)%n].clone();if(o[r]&&o[(r+2)%3]||!h){const i=l.clone(),s=[];s.push(p.clone().add(e)),s.push(a.clone().add(p).add(e));const o=(new t.BufferGeometry).setFromPoints(s),n=new t.Line(o,i);c.add(n),n.computeLineDistances()}if(o[r]&&o[(r+2)%3]&&o[(r+1)%3]||!h){const i=l.clone(),s=[];s.push(d.clone().add(p).add(e)),s.push(a.clone().add(d).add(p).add(e));const o=(new t.BufferGeometry).setFromPoints(s),n=new t.Line(o,i);c.add(n),n.computeLineDistances()}}return c}rotateView(e,i=!0){if(void 0!==e){for(const i of e){const e=new t.Vector3(i[0],i[1],i[2]);e.normalize();const s=i[3]/180*Math.PI;this.rotateAroundWorldAxis(this.root,e,s),this.rotateAroundWorldAxis(this.sceneInfo,e,s)}i&&this.render()}}alignView(t,e=!0){const i={a:this.basisVectors[0].clone(),"-a":this.basisVectors[0].clone().negate(),b:this.basisVectors[1].clone(),"-b":this.basisVectors[1].clone().negate(),c:this.basisVectors[2].clone(),"-c":this.basisVectors[2].clone().negate()},s=[this.root,this.sceneInfo];super.alignView(t,i,s,e)}repeat(e,i,s){let o=new t.Vector3(1,0,0),n=new t.Vector3(0,1,0),r=new t.Vector3(0,0,1),a=[],h=[];for(let l=0;l<e[0];++l)for(let c=0;c<e[1];++c)for(let u=0;u<e[2];++u)if(0!=l||0!=c||0!=u){let e=o.clone().multiplyScalar(l),d=n.clone().multiplyScalar(c),p=r.clone().multiplyScalar(u);for(let o=0,n=i.length;o<n;++o){let n=(new t.Vector3).copy(i[o]);n.add(e),n.add(d),n.add(p);let r=s[o];a.push(n),h.push(r)}}for(let t=0;t<a.length;++t)i.push(a[t]),s.push(h[t])}wrap(t,e=!0){e||this.toScaled(t,!1);for(let e=t.length,i=0;i<e;++i){const e=t[i];this.structure.pbc[0]&&(e.x=e.x<0?1+e.x%1:e.x%1),this.structure.pbc[1]&&(e.y=e.y<0?1+e.y%1:e.y%1),this.structure.pbc[2]&&(e.z=e.z<0?1+e.z%1:e.z%1)}e||this.toCartesian(t,!1)}addBoundaryAtoms(e,i){for(let s=e.length,o=0;o<s;++o){let s=e[o],n=i[o],r=s.x,a=s.y,h=s.z,l=this.almostEqual(0,r,this.basisVectors[0],this.options.layout.wrapTolerance),c=this.almostEqual(0,a,this.basisVectors[1],this.options.layout.wrapTolerance),u=this.almostEqual(0,h,this.basisVectors[2],this.options.layout.wrapTolerance);l&&c&&u?(e.push(new t.Vector3(1,0,0).add(s)),i.push(n),e.push(new t.Vector3(0,1,0).add(s)),i.push(n),e.push(new t.Vector3(0,0,1).add(s)),i.push(n),e.push(new t.Vector3(1,1,0).add(s)),i.push(n),e.push(new t.Vector3(0,1,1).add(s)),i.push(n),e.push(new t.Vector3(1,0,1).add(s)),i.push(n),e.push(new t.Vector3(1,1,1).add(s)),i.push(n)):l&&c&&!u?(e.push(new t.Vector3(1,0,0).add(s)),i.push(n),e.push(new t.Vector3(0,1,0).add(s)),i.push(n),e.push(new t.Vector3(1,1,0).add(s)),i.push(n)):!l&&c&&u?(e.push(new t.Vector3(0,1,0).add(s)),i.push(n),e.push(new t.Vector3(0,0,1).add(s)),i.push(n),e.push(new t.Vector3(0,1,1).add(s)),i.push(n)):l&&!c&&u?(e.push(new t.Vector3(1,0,0).add(s)),i.push(n),e.push(new t.Vector3(0,0,1).add(s)),i.push(n),e.push(new t.Vector3(1,0,1).add(s)),i.push(n)):!l||c||u?l||!c||u?l||c||!u||(e.push(new t.Vector3(0,0,1).add(s)),i.push(n)):(e.push(new t.Vector3(0,1,0).add(s)),i.push(n)):(e.push(new t.Vector3(1,0,0).add(s)),i.push(n))}}createAtoms(t,e,i,s=!0){if(this.atoms.remove(...this.atoms.children),this.elements={},this.atomNumbers=[],this.atomFills=[],this.atomOutlines=[],i.some((t=>!0===t))){let i=this.options.layout.periodicity;"wrap"===i?this.wrap(t,s):s&&"boundary"===i?this.addBoundaryAtoms(t,e):s&&Array.isArray(i)&&this.repeat(i,t,e)}let o={};for(let i=t.length,n=0;n<i;++n){let i=t[n],r=e[n];this.addAtom(n,i,r,o,s);let a=this.elementNames[r-1];this.elements[a]=[this.elementColors[r],this.atomicRadii[r]]}}createBonds(e="auto"){var i,s,o,n,r,a,h;if(!this.options.bonds.enabled)return;if(!this.updateBonds)return;this.bondFills=[],this.bonds.remove(...this.bonds.children);let l,c=this.getPositions();if(null===(o=null===(s=null===(i=this.options)||void 0===i?void 0:i.bonds)||void 0===s?void 0:s.material)||void 0===o?void 0:o.toon){const e=null===(h=null===(a=null===(r=null===(n=this.options)||void 0===n?void 0:n.bonds)||void 0===r?void 0:r.material)||void 0===a?void 0:a.toon)||void 0===h?void 0:h.tones,i=new Uint8Array(e);for(let t=0;t<=e;t++)i[t]=t/e*256;let s=new t.DataTexture(i,i.length,1,t.LuminanceFormat);s.minFilter=t.NearestFilter,s.magFilter=t.NearestFilter,s.generateMipmaps=!1,l=new t.MeshToonMaterial({color:this.options.bonds.color,gradientMap:s})}else l=new t.MeshPhongMaterial({color:this.options.bonds.color,shininess:this.options.bonds.material.phong.shininess});if(Array.isArray(e))for(let t of e){let e=t[0],i=t[1],s=c[e],o=c[i];this.addBond(e,i,s,o,l)}else if("auto"===e){let t=c.length;for(let e=0;e<t;++e)for(let i=0;i<t;++i)if(i>e){let t=c[e],s=c[i],o=this.atomNumbers[e],n=this.atomNumbers[i],r=s.clone().sub(t).length(),a=this.options.atoms.scale*this.atomicRadii[o],h=this.options.atoms.scale*this.atomicRadii[n];r<=1.1*this.options.bonds.threshold*(a+h)&&this.addBond(e,i,t,s,l)}}this.updateBonds=!1}almostEqual(t,e,i,s){let o=e-t;return Math.abs(i.clone().multiplyScalar(o).length())<s}addBond(e,i,s,o,n){let r=this.options.bonds.radius,a=this.options.bonds.smoothness,h=Math.ceil(360/(180-a)),l=this.createCylinder(s,o,r,h,n);l.name="fill",this.bondFills.push(l);let c=new t.Group;if(c.name="bond"+e+"-"+i,c.add(l),this.options.outline.enabled){let e=this.options.outline.size/r+1,i=new t.MeshBasicMaterial({color:this.options.outline.color,side:t.BackSide}),n=this.createCylinder(s,o,e*r,10,i);n.name="outline",c.add(n)}this.bonds.add(c)}addAtom(e,i,s,o,n=!0){var r,a,h,l,c,u,d;if(!(s in o)){o[s]={};let e,i=this.options.atoms.scale*this.atomicRadii[s],n=this.options.atoms.smoothness,m=Math.ceil(360/(180-n)),b=this.elementColors[s],g=new t.SphereGeometry(i,m,m);if(void 0!==(null===(h=null===(a=null===(r=this.options)||void 0===r?void 0:r.atoms)||void 0===a?void 0:a.material)||void 0===h?void 0:h.toon)){let i=null===(d=null===(u=null===(c=null===(l=this.options)||void 0===l?void 0:l.atoms)||void 0===c?void 0:c.material)||void 0===u?void 0:u.toon)||void 0===d?void 0:d.tones;for(var p=new Uint8Array(i),f=0;f<=i;f++)p[f]=f/i*256;var v=new t.DataTexture(p,p.length,1,t.LuminanceFormat);v.minFilter=t.NearestFilter,v.magFilter=t.NearestFilter,v.generateMipmaps=!1,e=new t.MeshToonMaterial({color:b,gradientMap:v})}else e=new t.MeshPhongMaterial({color:b,shininess:this.options.atoms.material.phong.shininess});let w=new t.Mesh(g,e);if(o[s].atom=w,this.options.outline.enabled){let e=this.options.outline.size/i+1,n=new t.SphereGeometry(i*e,m,m),r=new t.MeshBasicMaterial({color:this.options.outline.color,side:t.BackSide}),a=new t.Mesh(n,r);o[s].outline=a}}let m=o[s],b=new t.Vector3;n?(b.add(this.basisVectors[0].clone().multiplyScalar(i.x)),b.add(this.basisVectors[1].clone().multiplyScalar(i.y)),b.add(this.basisVectors[2].clone().multiplyScalar(i.z))):b.copy(i);let g=new t.Group;g.name="atom"+e;let w=m.atom.clone();if(w.name="fill",g.add(w),this.options.outline.enabled){let t=m.outline.clone();this.atomOutlines.push(t),t.name="outline",g.add(t)}g.position.copy(b),this.atoms.add(g),this.atomFills.push(w),this.atomNumbers.push(s),this.updateBonds=!0}render(){let e=this.rootElement,i=e.clientWidth,s=e.clientHeight,o=new t.Vector3(1,0,0),n=new t.Vector3(0,0,0),r=[o,n];for(let t=0;t<r.length;++t){let e=r[t];this.camera.localToWorld(e),e.project(this.camera),e.x=Math.round((e.x+1)*i/2),e.y=Math.round((1-e.y)*s/2)}let a=(new t.Vector3).subVectors(n,o).length(),h=8/Math.pow(a,.5);if(void 0!==this.axisLabels)for(let t=0;t<this.axisLabels.length;++t)this.axisLabels[t].scale.set(h,h,1);super.render()}getRepetitions(t,e){let i=t.length();return Math.max(Math.floor(e/i)-1,1)}}class c{constructor(t,e){this.vertex=null,this.prev=null,this.next=null,this.twin=null,this.face=null,this.vertex=t,this.face=e}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){const t=this.head(),e=this.tail();return null!==e?e.point.distanceTo(t.point):-1}lengthSquared(){const t=this.head(),e=this.tail();return null!==e?e.point.distanceToSquared(t.point):-1}setTwin(t){return this.twin=t,t.twin=this,this}}class u{constructor(e,i,s){this.normal=new t.Vector3,this.midpoint=new t.Vector3,this.area=0,this.constant=0,this.outside=null,this.mark=0,this.edge=null;var o=new c(e,this),n=new c(i,this),r=new c(s,this);o.next=r.prev=n,n.next=o.prev=r,r.next=n.prev=o,this.edge=o,this.compute()}getEdge(t){for(var e=this.edge;t>0;)e=e.next,t--;for(;t<0;)e=e.prev,t++;return e}compute(){var e;void 0===e&&(e=new t.Triangle);var i=this.edge.tail(),s=this.edge.head(),o=this.edge.next.head();return e.set(i.point,s.point,o.point),e.getNormal(this.normal),e.getMidpoint(this.midpoint),this.area=e.getArea(),this.constant=this.normal.dot(this.midpoint),this}distanceToPoint(t){return this.normal.dot(t)-this.constant}}const d=function(){var e,i,s,o=new t.Vector3;function n(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new a,this.unassigned=new a,this.vertices=[]}function r(t){this.point=t,this.prev=null,this.next=null,this.face=null}function a(){this.head=null,this.tail=null}return Object.assign(n.prototype,{setFromPoints:function(t){!0!==Array.isArray(t)&&console.error("THREE.ConvexHull: Points parameter is not an array."),t.length<4&&console.error("THREE.ConvexHull: The algorithm needs at least four points."),this.makeEmpty();for(var e=0,i=t.length;e<i;e++)this.vertices.push(new r(t[e]));return this.compute(),this},setFromObject:function(e){var i=[];return e.updateMatrixWorld(!0),e.traverse((function(e){var s,o,n,r=e.geometry;if(void 0!==r)if(r.isGeometry){var a=r.vertices;for(s=0,o=a.length;s<o;s++)(n=a[s].clone()).applyMatrix4(e.matrixWorld),i.push(n)}else if(r.isBufferGeometry){var h=r.attributes.position;if(void 0!==h)for(s=0,o=h.count;s<o;s++)(n=new t.Vector3).fromBufferAttribute(h,s).applyMatrix4(e.matrixWorld),i.push(n)}})),this.setFromPoints(i)},containsPoint:function(t){for(var e=this.faces,i=0,s=e.length;i<s;i++)if(e[i].distanceToPoint(t)>this.tolerance)return!1;return!0},intersectRay:function(t,e){for(var i=this.faces,s=-1/0,o=1/0,n=0,r=i.length;n<r;n++){var a=i[n],h=a.distanceToPoint(t.origin),l=a.normal.dot(t.direction);if(h>0&&l>=0)return null;var c=0!==l?-h/l:0;if(!(c<=0)&&(l>0?o=Math.min(c,o):s=Math.max(c,s),s>o))return null}return s!==-1/0?t.at(s,e):t.at(o,e),e},intersectsRay:function(t){return null!==this.intersectRay(t,o)},makeEmpty:function(){return this.faces=[],this.vertices=[],this},addVertexToFace:function(t,e){return t.face=e,null===e.outside?this.assigned.append(t):this.assigned.insertBefore(e.outside,t),e.outside=t,this},removeVertexFromFace:function(t,e){return t===e.outside&&(null!==t.next&&t.next.face===e?e.outside=t.next:e.outside=null),this.assigned.remove(t),this},removeAllVerticesFromFace:function(t){if(null!==t.outside){for(var e=t.outside,i=t.outside;null!==i.next&&i.next.face===t;)i=i.next;return this.assigned.removeSubList(e,i),e.prev=i.next=null,t.outside=null,e}},deleteFaceVertices:function(t,e){var i=this.removeAllVerticesFromFace(t);if(void 0!==i)if(void 0===e)this.unassigned.appendChain(i);else{var s=i;do{var o=s.next;e.distanceToPoint(s.point)>this.tolerance?this.addVertexToFace(s,e):this.unassigned.append(s),s=o}while(null!==s)}return this},resolveUnassignedPoints:function(t){if(!1===this.unassigned.isEmpty()){var e=this.unassigned.first();do{for(var i=e.next,s=this.tolerance,o=null,n=0;n<t.length;n++){var r=t[n];if(0===r.mark){var a=r.distanceToPoint(e.point);if(a>s&&(s=a,o=r),s>1e3*this.tolerance)break}}null!==o&&this.addVertexToFace(e,o),e=i}while(null!==e)}return this},computeExtremes:function(){var e,i,s,o=new t.Vector3,n=new t.Vector3,r=[],a=[];for(e=0;e<3;e++)r[e]=a[e]=this.vertices[0];for(o.copy(this.vertices[0].point),n.copy(this.vertices[0].point),e=0,i=this.vertices.length;e<i;e++){var h=this.vertices[e],l=h.point;for(s=0;s<3;s++)l.getComponent(s)<o.getComponent(s)&&(o.setComponent(s,l.getComponent(s)),r[s]=h);for(s=0;s<3;s++)l.getComponent(s)>n.getComponent(s)&&(n.setComponent(s,l.getComponent(s)),a[s]=h)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(o.x),Math.abs(n.x))+Math.max(Math.abs(o.y),Math.abs(n.y))+Math.max(Math.abs(o.z),Math.abs(n.z))),{min:r,max:a}},computeInitialHull:function(){void 0===e&&(e=new t.Line3,i=new t.Plane,s=new t.Vector3);var o,n,r,a,h,l,c,d,p,f=this.vertices,v=this.computeExtremes(),m=v.min,b=v.max,g=0,w=0;for(l=0;l<3;l++)(p=b[l].point.getComponent(l)-m[l].point.getComponent(l))>g&&(g=p,w=l);for(n=m[w],r=b[w],g=0,e.set(n.point,r.point),l=0,c=this.vertices.length;l<c;l++)(o=f[l])!==n&&o!==r&&(e.closestPointToPoint(o.point,!0,s),(p=s.distanceToSquared(o.point))>g&&(g=p,a=o));for(g=-1,i.setFromCoplanarPoints(n.point,r.point,a.point),l=0,c=this.vertices.length;l<c;l++)(o=f[l])!==n&&o!==r&&o!==a&&(p=Math.abs(i.distanceToPoint(o.point)))>g&&(g=p,h=o);var y=[];if(i.distanceToPoint(h.point)<0)for(y.push(new u(n,r,a),new u(h,r,n),new u(h,a,r),new u(h,n,a)),l=0;l<3;l++)d=(l+1)%3,y[l+1].getEdge(2).setTwin(y[0].getEdge(d)),y[l+1].getEdge(1).setTwin(y[d+1].getEdge(0));else for(y.push(new u(n,a,r),new u(h,n,r),new u(h,r,a),new u(h,a,n)),l=0;l<3;l++)d=(l+1)%3,y[l+1].getEdge(2).setTwin(y[0].getEdge((3-l)%3)),y[l+1].getEdge(0).setTwin(y[d+1].getEdge(1));for(l=0;l<4;l++)this.faces.push(y[l]);for(l=0,c=f.length;l<c;l++)if((o=f[l])!==n&&o!==r&&o!==a&&o!==h){g=this.tolerance;var C=null;for(d=0;d<4;d++)(p=this.faces[d].distanceToPoint(o.point))>g&&(g=p,C=this.faces[d]);null!==C&&this.addVertexToFace(o,C)}return this},reindexFaces:function(){for(var t=[],e=0;e<this.faces.length;e++){var i=this.faces[e];0===i.mark&&t.push(i)}return this.faces=t,this},nextVertexToAdd:function(){if(!1===this.assigned.isEmpty()){var t,e=0,i=this.assigned.first().face,s=i.outside;do{var o=i.distanceToPoint(s.point);o>e&&(e=o,t=s),s=s.next}while(null!==s&&s.face===i);return t}},computeHorizon:function(t,e,i,s){var o;this.deleteFaceVertices(i),i.mark=1,o=null===e?e=i.getEdge(0):e.next;do{var n=o.twin,r=n.face;0===r.mark&&(r.distanceToPoint(t)>this.tolerance?this.computeHorizon(t,n,r,s):s.push(o)),o=o.next}while(o!==e);return this},addAdjoiningFace:function(t,e){var i=new u(t,e.tail(),e.head());return this.faces.push(i),i.getEdge(-1).setTwin(e.twin),i.getEdge(0)},addNewFaces:function(t,e){this.newFaces=[];for(var i=null,s=null,o=0;o<e.length;o++){var n=e[o],r=this.addAdjoiningFace(t,n);null===i?i=r:r.next.setTwin(s),this.newFaces.push(r.face),s=r}return i.next.setTwin(s),this},addVertexToHull:function(t){var e=[];return this.unassigned.clear(),this.removeVertexFromFace(t,t.face),this.computeHorizon(t.point,null,t.face,e),this.addNewFaces(t,e),this.resolveUnassignedPoints(this.newFaces),this},cleanup:function(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this},compute:function(){var t;for(this.computeInitialHull();void 0!==(t=this.nextVertexToAdd());)this.addVertexToHull(t);return this.reindexFaces(),this.cleanup(),this}}),Object.assign(a.prototype,{first:function(){return this.head},last:function(){return this.tail},clear:function(){return this.head=this.tail=null,this},insertBefore:function(t,e){return e.prev=t.prev,e.next=t,null===e.prev?this.head=e:e.prev.next=e,t.prev=e,this},insertAfter:function(t,e){return e.prev=t,e.next=t.next,null===e.next?this.tail=e:e.next.prev=e,t.next=e,this},append:function(t){return null===this.head?this.head=t:this.tail.next=t,t.prev=this.tail,t.next=null,this.tail=t,this},appendChain:function(t){for(null===this.head?this.head=t:this.tail.next=t,t.prev=this.tail;null!==t.next;)t=t.next;return this.tail=t,this},remove:function(t){return null===t.prev?this.head=t.next:t.prev.next=t.next,null===t.next?this.tail=t.prev:t.next.prev=t.prev,this},removeSubList:function(t,e){return null===t.prev?this.head=e.next:t.prev.next=e.next,null===e.next?this.tail=t.prev:e.next.prev=t.prev,this},isEmpty:function(){return null===this.head}}),n}();var p=i(591),f=i(301),v=i.n(f);class m extends h{setupScenes(){this.scenes=[],this.sceneZone=new t.Scene,this.scenes.push(this.sceneZone),this.sceneInfo=new t.Scene,this.scenes.push(this.sceneInfo)}setupLights(){const e=new t.DirectionalLight(16777215,.45);e.position.set(0,0,20),this.sceneZone.add(e);const i=new t.DirectionalLight(16777215,.3);i.position.set(-20,0,-20),this.sceneZone.add(i);const s=new t.DirectionalLight(16777215,.25);s.position.set(20,0,-20),this.sceneZone.add(s);const o=new t.AmbientLight(4210752,3.7);this.sceneZone.add(o)}load(t){var e,i,s,o,n,r;this.data=t,this.clear(),this.setup(),this.setupScenes(),this.setupLights(),this.setupCamera(),this.setupControls();const a=t.basis,h=t.segments,l=t.kpoints;return this.basis=t.basis,a&&h?(this.createBrillouinZone(a,h,l),void 0!==this.B&&this.alignView(null===(s=null===(i=null===(e=this.options)||void 0===e?void 0:e.layout)||void 0===i?void 0:i.viewRotation)||void 0===s?void 0:s.alignments),this.rotateView(null===(r=null===(n=null===(o=this.options)||void 0===o?void 0:o.layout)||void 0===n?void 0:n.viewRotation)||void 0===r?void 0:r.rotations),this.options.view.autoFit&&super.fitToCanvas(),this.render(),!0):(console.log("The data given for the Brillouin zone viewer is incomplete."),!1)}setOptions(t,e=!0,i=!0){var s,o,n;const r={controls:{rotateSpeed:40,enablePan:!1},view:{fitMargin:.075},basis:{offset:.02,font:"Arial",size:.03,stroke:{width:.06,color:"#000"},a:{label:"a"},b:{label:"b"},c:{label:"c"}},segments:{color:"#E56400",linewidth:.0025},kpoints:{point:{enabled:!0,size:.01,color:"#E56400"},label:{enabled:!0,font:"Arial",size:.025,color:"#E56400",offset2D:[0,-.75],stroke:{width:.06,color:"#000"}}},faces:{color:"#ddd",opacity:.7,outline:{width:.002,color:"#999"}}};0===Object.keys(this.options).length?(this.fillOptions(t,r),super.setOptions(r)):(this.fillOptions(t,this.options),super.setOptions(this.options),i&&void 0!==this.data&&this.load(this.data),void 0!==(null===(s=null==t?void 0:t.renderer)||void 0===s?void 0:s.background)&&this.setBackgroundColor(null===(o=null==t?void 0:t.renderer)||void 0===o?void 0:o.background.color,null===(n=null==t?void 0:t.renderer)||void 0===n?void 0:n.background.opacity),e&&this.render())}createBrillouinZone(e,i,s){var o,n,r,a,h,l,c,u,f,m,b,g,w,y,C,x,V,M,A,S,_;const z=new t.Matrix3,E=(new t.Vector3).fromArray(e[0]),P=(new t.Vector3).fromArray(e[1]),k=(new t.Vector3).fromArray(e[2]);z.set(E.x,P.x,k.x,E.y,P.y,k.y,E.z,P.z,k.z),this.basisVectors=[E,P,k],this.B=z;const j=(new t.Matrix3).identity(),L=[];for(let e=-1;e<=1;++e)for(let i=-1;i<=1;++i)for(let s=-1;s<=1;++s){const o=new t.Vector3(e,i,s),n=this.coordinateTransform(this.B,j,o,!1);L.push(n.toArray())}const F=v()(L);let T;for(const e of F.cells){const i=[];let s=!0,o=!0;for(const t of e){if(-1===t){s=!1;break}const e=F.positions[t];for(let t=0;t<3;++t)if(Number.isNaN(e[t])){o=!1;break}i.push(e)}if(!s||!o)continue;const n=new t.Vector3(0,0,0),r=[];for(let e=0;e<i.length;++e){const s=(new t.Vector3).fromArray(i[e]);r.push(s),n.add(s)}if(n.divideScalar(r.length),n.length()<1e-7){T=r;break}}this.zone=new t.Object3D,this.zone.name="zone",this.sceneZone.add(this.zone),this.info=new t.Object3D,this.info.name="info",this.sceneInfo.add(this.info);const{geometry:B,faces:O}=function(e){const i=new t.BufferGeometry,s=[],o=[],n=(new d).setFromPoints(e).faces;for(let t=0;t<n.length;t++){const e=n[t];let i=e.edge;do{const t=i.head().point;s.push(t.x,t.y,t.z),o.push(e.normal.x,e.normal.y,e.normal.z),i=i.next}while(i!==e.edge)}i.setAttribute("position",new t.Float32BufferAttribute(s,3)),i.setAttribute("normal",new t.Float32BufferAttribute(o,3));const r=[],a=new Set(n);for(let t of a){const e=[],i=t.edge;let s=t.edge;e.push(i.tail().point);do{const i=t.normal,o=s.twin.face,n=o.normal;Math.abs(i.dot(n)-1)<=1e-8?(t=o,s=s.twin.next):(e.push(s.head().point),s=s.next),a.delete(t)}while(s!==i);r.push(e)}return{geometry:i,faces:r}}(T),D=new t.Group;D.name="group";const R=new t.MeshPhongMaterial({color:this.options.faces.color,opacity:this.options.faces.opacity,transparent:!0}),W=new t.Mesh(B,R);W.name="innermesh",W.material.side=t.BackSide,W.renderOrder=0,D.add(W);const N=new t.Mesh(B,R.clone());N.name="outermesh",N.material.side=t.FrontSide,N.renderOrder=1,D.add(N),this.zone.add(D);const H=this.options.faces.outline.width,Z=new p.MeshLineMaterial({color:this.options.faces.outline.color,lineWidth:H,sizeAttenuation:!0});for(const e of O){const i=[];for(const t of e){let e=t.clone();const s=e.length();e=e.multiplyScalar(1+.5*H/s),i.push(e)}const s=new p.MeshLine;s.setPoints(i);const o=new t.Mesh(s,Z);this.zone.add(o)}const I=[this.options.basis.a.label,this.options.basis.b.label,this.options.basis.c.label],U=[];U.push(void 0===(null===(o=this.options.basis.a)||void 0===o?void 0:o.font)?this.options.basis.font:this.options.basis.a.font),U.push(void 0===(null===(n=this.options.basis.b)||void 0===n?void 0:n.font)?this.options.basis.font:this.options.basis.b.font),U.push(void 0===(null===(r=this.options.basis.c)||void 0===r?void 0:r.font)?this.options.basis.font:this.options.basis.c.font);const G=[];G.push(void 0===(null===(a=this.options.basis.a)||void 0===a?void 0:a.size)?this.options.basis.size:this.options.basis.a.size),G.push(void 0===(null===(h=this.options.basis.b)||void 0===h?void 0:h.size)?this.options.basis.size:this.options.basis.b.size),G.push(void 0===(null===(l=this.options.basis.c)||void 0===l?void 0:l.size)?this.options.basis.size:this.options.basis.c.size);const X=[];X.push(void 0===(null===(c=this.options.basis.a)||void 0===c?void 0:c.color)?this.options.basis.color:this.options.basis.a.color),X.push(void 0===(null===(u=this.options.basis.b)||void 0===u?void 0:u.color)?this.options.basis.color:this.options.basis.b.color),X.push(void 0===(null===(f=this.options.basis.c)||void 0===f?void 0:f.color)?this.options.basis.color:this.options.basis.c.color);const Y=[];Y.push(void 0===(null===(b=null===(m=this.options.basis.a)||void 0===m?void 0:m.stroke)||void 0===b?void 0:b.color)?this.options.basis.stroke.color:this.options.basis.a.stroke.color),Y.push(void 0===(null===(w=null===(g=this.options.basis.b)||void 0===g?void 0:g.stroke)||void 0===w?void 0:w.color)?this.options.basis.stroke.color:this.options.basis.b.stroke.color),Y.push(void 0===(null===(C=null===(y=this.options.basis.c)||void 0===y?void 0:y.stroke)||void 0===C?void 0:C.color)?this.options.basis.stroke.color:this.options.basis.c.stroke.color);const q=[];q.push(void 0===(null===(V=null===(x=this.options.basis.a)||void 0===x?void 0:x.stroke)||void 0===V?void 0:V.width)?this.options.basis.stroke.width:this.options.basis.a.stroke.width),q.push(void 0===(null===(A=null===(M=this.options.basis.b)||void 0===M?void 0:M.stroke)||void 0===A?void 0:A.width)?this.options.basis.stroke.width:this.options.basis.b.stroke.width),q.push(void 0===(null===(_=null===(S=this.options.basis.c)||void 0===S?void 0:S.stroke)||void 0===_?void 0:_.width)?this.options.basis.stroke.width:this.options.basis.c.stroke.width);for(let i=0;i<3;++i){const s=.7,o=e[i],n=new t.Vector3(0,0,0),r=(new t.Vector3).fromArray(o).multiplyScalar(s),a=[n,r],h=new p.MeshLineMaterial({color:"#000",lineWidth:75e-5,sizeAttenuation:!0,dashArray:.05,transparent:!0,depthTest:!1}),l=new p.MeshLine;l.setPoints(a);const c=new t.Mesh(l,h);this.info.add(c);const u=(new t.Vector3).copy(r).multiplyScalar(1+this.options.basis.offset/r.length()),d=I[i],f=X[i],v=U[i],m=G[i],b=q[i],g=Y[i],w=this.createLabel(u,d,f,v,m,new t.Vector2(0,0),b,g);this.info.add(w);const y=new t.CylinderGeometry(0,.003,.012,12),C=new t.MeshBasicMaterial({color:0}),x=new t.Mesh(y,C);x.position.copy(r),x.lookAt(new t.Vector3),x.rotateX(-Math.PI/2),this.info.add(x)}const Q=new p.MeshLineMaterial({color:this.options.segments.color,lineWidth:this.options.segments.linewidth,sizeAttenuation:!0}),K=[];for(let e=0;e<i.length;++e){const s=[],o=i[e];for(const e of o){const i=(new t.Vector3).fromArray(e),o=this.coordinateTransform(this.B,j,i,!1);s.push(o),s.push(o),K.push(o)}const n=new p.MeshLine;n.setPoints(s);const r=new t.Mesh(n,Q);this.info.add(r)}this.labelPoints=new t.Object3D;for(const e of K){const i=new t.Object3D;i.position.copy(e),this.labelPoints.add(i)}if(this.info.add(this.labelPoints),s)for(const e of s){const i=e[0],s=(new t.Vector3).fromArray(e[1]),o=this.coordinateTransform(this.B,j,s,!1);if(this.options.kpoints.point.enabled){const t=this.createCircle(o,this.options.kpoints.point.size,this.options.kpoints.point.color);this.info.add(t)}if(this.options.kpoints.label.enabled){const e=this.createLabel(o,i,this.options.kpoints.label.color,this.options.kpoints.label.font,this.options.kpoints.label.size,(new t.Vector2).fromArray(this.options.kpoints.label.offset2D),this.options.kpoints.label.stroke.width,this.options.kpoints.label.stroke.width);this.info.add(e)}}}getCornerPoints(){const e=this.zone.getObjectByName("group").getObjectByName("outermesh");e.updateMatrixWorld();const i=[],s=e.geometry.attributes.position.array,o=s.length/3;for(let e=0;e<o;++e)i.push((new t.Vector3).fromArray(s,3*e));const n=[];for(let t=0;t<o;++t){const s=i[t];n.push(e.localToWorld(s))}return{points:n,margin:0}}rotateView(e,i=!0){if(void 0!==e){for(const i of e){const e=new t.Vector3(i[0],i[1],i[2]);e.normalize();const s=i[3]/180*Math.PI;this.rotateAroundWorldAxis(this.zone,e,s),this.rotateAroundWorldAxis(this.info,e,s)}i&&this.render()}}alignView(e,i=!0){const s=new t.Vector3,o=this.labelPoints.children.length;for(let e=0;e<o;++e){const i=this.labelPoints.children[e];s.add(i.getWorldPosition(new t.Vector3))}const n={a:this.basisVectors[0].clone(),"-a":this.basisVectors[0].clone().negate(),b:this.basisVectors[1].clone(),"-b":this.basisVectors[1].clone().negate(),c:this.basisVectors[2].clone(),"-c":this.basisVectors[2].clone().negate(),segments:s},r=[this.zone,this.info];super.alignView(e,n,r,i)}createCircle(e,i,s){const o=document.createElement("canvas");o.width=256,o.height=256;const n=o.getContext("2d");n.beginPath(),n.arc(128,128,128,0,2*Math.PI),n.fillStyle=s,n.fill();const r=new t.Texture(o);r.needsUpdate=!0;const a=new t.SpriteMaterial({map:r}),h=new t.Sprite(a);h.scale.set(i,i,1);const l=new t.Object3D;return l.position.copy(e),l.add(h),l}}})(),materia=s})();