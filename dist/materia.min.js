var materia=function(t){var e={};function i(s){if(e[s])return e[s].exports;var o=e[s]={i:s,l:!1,exports:{}};return t[s].call(o.exports,o,o.exports,i),o.l=!0,o.exports}return i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var o in t)i.d(s,o,function(e){return t[e]}.bind(null,o));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=7)}([function(t,e){t.exports=THREE},function(t,e,i){(function(){"use strict";var s=this.THREE||i(0);if(!s)throw new Error("MeshLine requires three.js");function o(){s.BufferGeometry.call(this),this.type="MeshLine",this.positions=[],this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],this.counters=[],this._vertices=[],this._bufferArray=[],this.widthCallback=null,this.matrixWorld=new s.Matrix4,Object.defineProperties(this,{geometry:{enumerable:!0,get:function(){return this},set:function(t){this.setFromGeometry(t)}},vertices:{enumerable:!0,get:function(){return this._vertices},set:function(t){this.setVertices(t)}},bufferArray:{enumerable:!0,get:function(){return this._bufferArray},set:function(t){this.setBufferArray(t)}}})}function n(t,e){var i=new s.Matrix4,o=new s.Ray,n=new s.Sphere,r=new s.Vector3,a=this.geometry;if(n.copy(a.boundingSphere),n.applyMatrix4(this.matrixWorld),!1!==t.ray.intersectSphere(n,r)){i.getInverse(this.matrixWorld),o.copy(t.ray).applyMatrix4(i);var h=new s.Vector3,l=new s.Vector3,c=new s.Vector3,u=this instanceof s.LineSegments?2:1,d=a.index,p=a.attributes;if(null!==d)for(var f=d.array,v=p.position.array,m=p.width.array,b=0,g=f.length-1;b<g;b+=u){var w=f[b],y=f[b+1];h.fromArray(v,3*w),l.fromArray(v,3*y);var C=null!=m[Math.floor(b/3)]?m[Math.floor(b/3)]:1,x=t.params.Line.threshold+this.material.lineWidth*C/2,V=x*x;if(!(o.distanceSqToSegment(h,l,r,c)>V)){r.applyMatrix4(this.matrixWorld);var A=t.ray.origin.distanceTo(r);A<t.near||A>t.far||(e.push({distance:A,point:c.clone().applyMatrix4(this.matrixWorld),index:b,face:null,faceIndex:null,object:this}),b=g)}}}}function r(t,e,i,s,o){var n;if(t=t.subarray||t.slice?t:t.buffer,i=i.subarray||i.slice?i:i.buffer,t=e?t.subarray?t.subarray(e,o&&e+o):t.slice(e,o&&e+o):t,i.set)i.set(t,s);else for(n=0;n<t.length;n++)i[n+s]=t[n];return i}function a(t){s.ShaderMaterial.call(this,{uniforms:Object.assign({},s.UniformsLib.fog,{lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},color:{value:new s.Color(16777215)},opacity:{value:1},resolution:{value:new s.Vector2(1,1)},sizeAttenuation:{value:1},dashArray:{value:0},dashOffset:{value:0},dashRatio:{value:.5},useDash:{value:0},visibility:{value:1},alphaTest:{value:0},repeat:{value:new s.Vector2(1,1)}}),vertexShader:s.ShaderChunk.meshline_vert,fragmentShader:s.ShaderChunk.meshline_frag}),this.type="MeshLineMaterial",Object.defineProperties(this,{lineWidth:{enumerable:!0,get:function(){return this.uniforms.lineWidth.value},set:function(t){this.uniforms.lineWidth.value=t}},map:{enumerable:!0,get:function(){return this.uniforms.map.value},set:function(t){this.uniforms.map.value=t}},useMap:{enumerable:!0,get:function(){return this.uniforms.useMap.value},set:function(t){this.uniforms.useMap.value=t}},alphaMap:{enumerable:!0,get:function(){return this.uniforms.alphaMap.value},set:function(t){this.uniforms.alphaMap.value=t}},useAlphaMap:{enumerable:!0,get:function(){return this.uniforms.useAlphaMap.value},set:function(t){this.uniforms.useAlphaMap.value=t}},color:{enumerable:!0,get:function(){return this.uniforms.color.value},set:function(t){this.uniforms.color.value=t}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(t){this.uniforms.opacity.value=t}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(t){this.uniforms.resolution.value.copy(t)}},sizeAttenuation:{enumerable:!0,get:function(){return this.uniforms.sizeAttenuation.value},set:function(t){this.uniforms.sizeAttenuation.value=t}},dashArray:{enumerable:!0,get:function(){return this.uniforms.dashArray.value},set:function(t){this.uniforms.dashArray.value=t,this.useDash=0!==t?1:0}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(t){this.uniforms.dashOffset.value=t}},dashRatio:{enumerable:!0,get:function(){return this.uniforms.dashRatio.value},set:function(t){this.uniforms.dashRatio.value=t}},useDash:{enumerable:!0,get:function(){return this.uniforms.useDash.value},set:function(t){this.uniforms.useDash.value=t}},visibility:{enumerable:!0,get:function(){return this.uniforms.visibility.value},set:function(t){this.uniforms.visibility.value=t}},alphaTest:{enumerable:!0,get:function(){return this.uniforms.alphaTest.value},set:function(t){this.uniforms.alphaTest.value=t}},repeat:{enumerable:!0,get:function(){return this.uniforms.repeat.value},set:function(t){this.uniforms.repeat.value.copy(t)}}}),this.setValues(t)}o.prototype=Object.create(s.BufferGeometry.prototype),o.prototype.constructor=o,o.prototype.isMeshLine=!0,o.prototype.setMatrixWorld=function(t){this.matrixWorld=t},o.prototype.setFromGeometry=function(t,e){t instanceof s.Geometry&&this.setVertices(t.vertices,e),t instanceof s.BufferGeometry&&this.setBufferArray(t.getAttribute("position").array,e),(t instanceof Float32Array||t instanceof Array)&&this.setBufferArray(t,e)},o.prototype.setGeometry=function(t,e){this.setFromGeometry(t,e)},o.prototype.setVertices=function(t,e){this._vertices=t,this.widthCallback=e||this.widthCallback,this.positions=[],this.counters=[];for(var i=0;i<t.length;i++){var s=t[i],o=i/t.length;this.positions.push(s.x,s.y,s.z),this.positions.push(s.x,s.y,s.z),this.counters.push(o),this.counters.push(o)}this.process()},o.prototype.setBufferArray=function(t,e){this._bufferArray=t,this.widthCallback=e||this.widthCallback,this.positions=[],this.counters=[];for(var i=0;i<t.length;i+=3){var s=i/t.length;this.positions.push(t[i],t[i+1],t[i+2]),this.positions.push(t[i],t[i+1],t[i+2]),this.counters.push(s),this.counters.push(s)}this.process()},o.prototype.raycast=n,o.prototype.compareV3=function(t,e){var i=6*t,s=6*e;return this.positions[i]===this.positions[s]&&this.positions[i+1]===this.positions[s+1]&&this.positions[i+2]===this.positions[s+2]},o.prototype.copyV3=function(t){var e=6*t;return[this.positions[e],this.positions[e+1],this.positions[e+2]]},o.prototype.process=function(){var t,e,i=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],e=this.compareV3(0,i-1)?this.copyV3(i-2):this.copyV3(0),this.previous.push(e[0],e[1],e[2]),this.previous.push(e[0],e[1],e[2]);for(var o=0;o<i;o++){if(this.side.push(1),this.side.push(-1),t=this.widthCallback?this.widthCallback(o/(i-1)):1,this.width.push(t),this.width.push(t),this.uvs.push(o/(i-1),0),this.uvs.push(o/(i-1),1),o<i-1){e=this.copyV3(o),this.previous.push(e[0],e[1],e[2]),this.previous.push(e[0],e[1],e[2]);var n=2*o;this.indices_array.push(n,n+1,n+2),this.indices_array.push(n+2,n+1,n+3)}o>0&&(e=this.copyV3(o),this.next.push(e[0],e[1],e[2]),this.next.push(e[0],e[1],e[2]))}e=this.compareV3(i-1,0)?this.copyV3(1):this.copyV3(i-1),this.next.push(e[0],e[1],e[2]),this.next.push(e[0],e[1],e[2]),this._attributes&&this._attributes.position.count===this.positions.length?(this._attributes.position.copyArray(new Float32Array(this.positions)),this._attributes.position.needsUpdate=!0,this._attributes.previous.copyArray(new Float32Array(this.previous)),this._attributes.previous.needsUpdate=!0,this._attributes.next.copyArray(new Float32Array(this.next)),this._attributes.next.needsUpdate=!0,this._attributes.side.copyArray(new Float32Array(this.side)),this._attributes.side.needsUpdate=!0,this._attributes.width.copyArray(new Float32Array(this.width)),this._attributes.width.needsUpdate=!0,this._attributes.uv.copyArray(new Float32Array(this.uvs)),this._attributes.uv.needsUpdate=!0,this._attributes.index.copyArray(new Uint16Array(this.indices_array)),this._attributes.index.needsUpdate=!0):this._attributes={position:new s.BufferAttribute(new Float32Array(this.positions),3),previous:new s.BufferAttribute(new Float32Array(this.previous),3),next:new s.BufferAttribute(new Float32Array(this.next),3),side:new s.BufferAttribute(new Float32Array(this.side),1),width:new s.BufferAttribute(new Float32Array(this.width),1),uv:new s.BufferAttribute(new Float32Array(this.uvs),2),index:new s.BufferAttribute(new Uint16Array(this.indices_array),1),counters:new s.BufferAttribute(new Float32Array(this.counters),1)},this.setAttribute("position",this._attributes.position),this.setAttribute("previous",this._attributes.previous),this.setAttribute("next",this._attributes.next),this.setAttribute("side",this._attributes.side),this.setAttribute("width",this._attributes.width),this.setAttribute("uv",this._attributes.uv),this.setAttribute("counters",this._attributes.counters),this.setIndex(this._attributes.index),this.computeBoundingSphere(),this.computeBoundingBox()},o.prototype.advance=function(t){var e=this._attributes.position.array,i=this._attributes.previous.array,s=this._attributes.next.array,o=e.length;r(e,0,i,0,o),r(e,6,e,0,o-6),e[o-6]=t.x,e[o-5]=t.y,e[o-4]=t.z,e[o-3]=t.x,e[o-2]=t.y,e[o-1]=t.z,r(e,6,s,0,o-6),s[o-6]=t.x,s[o-5]=t.y,s[o-4]=t.z,s[o-3]=t.x,s[o-2]=t.y,s[o-1]=t.z,this._attributes.position.needsUpdate=!0,this._attributes.previous.needsUpdate=!0,this._attributes.next.needsUpdate=!0},s.ShaderChunk.meshline_vert=["",s.ShaderChunk.logdepthbuf_pars_vertex,s.ShaderChunk.fog_pars_vertex,"","attribute vec3 previous;","attribute vec3 next;","attribute float side;","attribute float width;","attribute float counters;","","uniform vec2 resolution;","uniform float lineWidth;","uniform vec3 color;","uniform float opacity;","uniform float sizeAttenuation;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","vec2 fix( vec4 i, float aspect ) {","","    vec2 res = i.xy / i.w;","    res.x *= aspect;","\t vCounters = counters;","    return res;","","}","","void main() {","","    float aspect = resolution.x / resolution.y;","","    vColor = vec4( color, opacity );","    vUV = uv;","","    mat4 m = projectionMatrix * modelViewMatrix;","    vec4 finalPosition = m * vec4( position, 1.0 );","    vec4 prevPos = m * vec4( previous, 1.0 );","    vec4 nextPos = m * vec4( next, 1.0 );","","    vec2 currentP = fix( finalPosition, aspect );","    vec2 prevP = fix( prevPos, aspect );","    vec2 nextP = fix( nextPos, aspect );","","    float w = lineWidth * width;","","    vec2 dir;","    if( nextP == currentP ) dir = normalize( currentP - prevP );","    else if( prevP == currentP ) dir = normalize( nextP - currentP );","    else {","        vec2 dir1 = normalize( currentP - prevP );","        vec2 dir2 = normalize( nextP - currentP );","        dir = normalize( dir1 + dir2 );","","        vec2 perp = vec2( -dir1.y, dir1.x );","        vec2 miter = vec2( -dir.y, dir.x );","        //w = clamp( w / dot( miter, perp ), 0., 4. * lineWidth * width );","","    }","","    //vec2 normal = ( cross( vec3( dir, 0. ), vec3( 0., 0., 1. ) ) ).xy;","    vec4 normal = vec4( -dir.y, dir.x, 0., 1. );","    normal.xy *= .5 * w;","    normal *= projectionMatrix;","    if( sizeAttenuation == 0. ) {","        normal.xy *= finalPosition.w;","        normal.xy /= ( vec4( resolution, 0., 1. ) * projectionMatrix ).xy;","    }","","    finalPosition.xy += normal.xy * side;","","    gl_Position = finalPosition;","",s.ShaderChunk.logdepthbuf_vertex,s.ShaderChunk.fog_vertex&&"    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",s.ShaderChunk.fog_vertex,"}"].join("\n"),s.ShaderChunk.meshline_frag=["",s.ShaderChunk.fog_pars_fragment,s.ShaderChunk.logdepthbuf_pars_fragment,"","uniform sampler2D map;","uniform sampler2D alphaMap;","uniform float useMap;","uniform float useAlphaMap;","uniform float useDash;","uniform float dashArray;","uniform float dashOffset;","uniform float dashRatio;","uniform float visibility;","uniform float alphaTest;","uniform vec2 repeat;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","void main() {","",s.ShaderChunk.logdepthbuf_fragment,"","    vec4 c = vColor;","    if( useMap == 1. ) c *= texture2D( map, vUV * repeat );","    if( useAlphaMap == 1. ) c.a *= texture2D( alphaMap, vUV * repeat ).a;","    if( c.a < alphaTest ) discard;","    if( useDash == 1. ){","        c.a *= ceil(mod(vCounters + dashOffset, dashArray) - (dashArray * dashRatio));","    }","    gl_FragColor = c;","    gl_FragColor.a *= step(vCounters, visibility);","",s.ShaderChunk.fog_fragment,"}"].join("\n"),a.prototype=Object.create(s.ShaderMaterial.prototype),a.prototype.constructor=a,a.prototype.isMeshLineMaterial=!0,a.prototype.copy=function(t){return s.ShaderMaterial.prototype.copy.call(this,t),this.lineWidth=t.lineWidth,this.map=t.map,this.useMap=t.useMap,this.alphaMap=t.alphaMap,this.useAlphaMap=t.useAlphaMap,this.color.copy(t.color),this.opacity=t.opacity,this.resolution.copy(t.resolution),this.sizeAttenuation=t.sizeAttenuation,this.dashArray.copy(t.dashArray),this.dashOffset.copy(t.dashOffset),this.dashRatio.copy(t.dashRatio),this.useDash=t.useDash,this.visibility=t.visibility,this.alphaTest=t.alphaTest,this.repeat.copy(t.repeat),this},t.exports&&(e=t.exports={MeshLine:o,MeshLineMaterial:a,MeshLineRaycast:n}),e.MeshLine=o,e.MeshLineMaterial=a,e.MeshLineRaycast=n}).call(this)},function(t,e,i){"use strict";t.exports=function(t,e,i){var o=t*e,n=s*t,r=n-(n-t),a=t-r,h=s*e,l=h-(h-e),c=e-l,u=a*c-(o-r*l-a*l-r*c);if(i)return i[0]=u,i[1]=o,i;return[u,o]};var s=+(Math.pow(2,27)+1)},function(t,e,i){"use strict";t.exports=function(t,e){var i=0|t.length,s=0|e.length;if(1===i&&1===s)return function(t,e){var i=t+e,s=i-t,o=t-(i-s)+(e-s);if(o)return[o,i];return[i]}(t[0],e[0]);var o,n,r=new Array(i+s),a=0,h=0,l=0,c=Math.abs,u=t[h],d=c(u),p=e[l],f=c(p);d<f?(n=u,(h+=1)<i&&(u=t[h],d=c(u))):(n=p,(l+=1)<s&&(p=e[l],f=c(p)));h<i&&d<f||l>=s?(o=u,(h+=1)<i&&(u=t[h],d=c(u))):(o=p,(l+=1)<s&&(p=e[l],f=c(p)));var v,m,b=o+n,g=b-o,w=n-g,y=w,C=b;for(;h<i&&l<s;)d<f?(o=u,(h+=1)<i&&(u=t[h],d=c(u))):(o=p,(l+=1)<s&&(p=e[l],f=c(p))),(w=(n=y)-(g=(b=o+n)-o))&&(r[a++]=w),y=C-((v=C+b)-(m=v-C))+(b-m),C=v;for(;h<i;)(w=(n=y)-(g=(b=(o=u)+n)-o))&&(r[a++]=w),y=C-((v=C+b)-(m=v-C))+(b-m),C=v,(h+=1)<i&&(u=t[h]);for(;l<s;)(w=(n=y)-(g=(b=(o=p)+n)-o))&&(r[a++]=w),y=C-((v=C+b)-(m=v-C))+(b-m),C=v,(l+=1)<s&&(p=e[l]);y&&(r[a++]=y);C&&(r[a++]=C);a||(r[a++]=0);return r.length=a,r}},function(t,e,i){"use strict";var s=i(2),o=i(11);t.exports=function(t,e){var i=t.length;if(1===i){var n=s(t[0],e);return n[0]?n:[n[1]]}var r=new Array(2*i),a=[.1,.1],h=[.1,.1],l=0;s(t[0],e,a),a[0]&&(r[l++]=a[0]);for(var c=1;c<i;++c){s(t[c],e,h);var u=a[1];o(u,h[0],a),a[0]&&(r[l++]=a[0]);var d=h[1],p=a[1],f=d+p,v=p-(f-d);a[1]=f,v&&(r[l++]=v)}a[1]&&(r[l++]=a[1]);0===l&&(r[l++]=0);return r.length=l,r}},function(t,e,i){"use strict";t.exports=function(t,e,i){return 0===t.length?t:e?(i||t.sort(e),function(t,e){for(var i=1,s=t.length,o=t[0],n=t[0],r=1;r<s;++r)if(n=o,e(o=t[r],n)){if(r===i){i++;continue}t[i++]=o}return t.length=i,t}(t,e)):(i||t.sort(),function(t){for(var e=1,i=t.length,s=t[0],o=t[0],n=1;n<i;++n,o=s)if(o=s,(s=t[n])!==o){if(n===e){e++;continue}t[e++]=s}return t.length=e,t}(t))}},function(t,e,i){"use strict";var s=i(8),o=i(16),n=i(5);function r(t,e){return t-e}t.exports=function(t){var e=t.length;if(0===e)return{cells:[],positions:[]};var i=t[0].length;if(i<1)return{cells:[],positions:[]};if(1===i)return function(t){if(1===t.length)return{cells:[[-1]],positions:[]};var e=t.map((function(t,e){return[t[0],e]}));e.sort((function(t,e){return t-e}));for(var i=new Array(t.length),s=0;s<i.length;++s)i[s]=[-1,-1];for(var o=[],n=1;n<e.length;++n){var r=e[n-1],a=e[n],h=.5*(r[0]+a[0]),l=o.length;o.push([h]),i[r[1]][1]=l,i[a[1]][0]=l}return i[e[0][1]][1]=0,i[e[e.length-1][1]][0]=o.length-1,{cells:i,positions:o}}(t);for(var a=s(t,!0),h=new Array(e),l=0;l<e;++l)h[l]=[];var c,u=a.length,d=new Array(i+1),p=new Array(u),f=[];for(l=0;l<u;++l){for(var v=a[l],m=!1,b=0;b<=i;++b){var g=v[b];g<0?(p[l]=-1,m=!0):(h[g].push(l),d[b]=t[g])}m||(p[l]=f.length,f.push(o(d)))}if(2===i){c=new Array(e);for(l=0;l<e;++l){var w=h[l],y=[p[w[0]]],C=a[w[0]][(a[w[0]].indexOf(l)+1)%3];for(b=1;b<w.length;++b)for(var x=1;x<w.length;++x){var V=(a[w[x]].indexOf(l)+2)%3;if(a[w[x]][V]===C){y.push(p[w[x]]),C=a[w[x]][(V+2)%3];break}}c[l]=y}}else{for(l=0;l<e;++l){for(C=h[l],b=0;b<C.length;++b)C[b]=p[C[b]];n(C,r)}c=h}return{cells:c,positions:f}}},function(t,e,i){t.exports=i(21)},function(t,e,i){"use strict";var s=i(9),o=i(5);function n(t,e){this.point=t,this.index=e}function r(t,e){for(var i=t.point,s=e.point,o=i.length,n=0;n<o;++n){var r=s[n]-i[n];if(r)return r}return 0}t.exports=function(t,e){var i=t.length;if(0===i)return[];var a=t[0].length;if(a<1)return[];if(1===a)return function(t,e,i){if(1===t)return i?[[-1,0]]:[];var s=e.map((function(t,e){return[t[0],e]}));s.sort((function(t,e){return t[0]-e[0]}));for(var o=new Array(t-1),n=1;n<t;++n){var r=s[n-1],a=s[n];o[n-1]=[r[1],a[1]]}i&&o.push([-1,o[0][1]],[o[t-1][1],-1]);return o}(i,t,e);for(var h=new Array(i),l=1,c=0;c<i;++c){for(var u=t[c],d=new Array(a+1),p=0,f=0;f<a;++f){var v=u[f];d[f]=v,p+=v*v}d[a]=p,h[c]=new n(d,c),l=Math.max(p,l)}o(h,r),i=h.length;var m=new Array(i+a+1),b=new Array(i+a+1),g=(a+1)*(a+1)*l,w=new Array(a+1);for(c=0;c<=a;++c)w[c]=0;w[a]=g,m[0]=w.slice(),b[0]=-1;for(c=0;c<=a;++c){(d=w.slice())[c]=1,m[c+1]=d,b[c+1]=-1}for(c=0;c<i;++c){var y=h[c];m[c+a+1]=y.point,b[c+a+1]=y.index}var C=s(m,!1);C=e?C.filter((function(t){for(var e=0,i=0;i<=a;++i){var s=b[t[i]];if(s<0&&++e>=2)return!1;t[i]=s}return!0})):C.filter((function(t){for(var e=0;e<=a;++e){var i=b[t[e]];if(i<0)return!1;t[e]=i}return!0}));if(1&a)for(c=0;c<C.length;++c){d=(y=C[c])[0];y[0]=y[1],y[1]=d}return C}},function(t,e,i){"use strict";t.exports=function(t,e){var i=t.length;if(0===i)throw new Error("Must have at least d+1 points");var o=t[0].length;if(i<=o)throw new Error("Must input at least d+1 points");var r=t.slice(0,o+1),a=s.apply(void 0,r);if(0===a)throw new Error("Input not in general position");for(var h=new Array(o+1),c=0;c<=o;++c)h[c]=c;a<0&&(h[0]=1,h[1]=0);var u=new n(h,new Array(o+1),!1),d=u.adjacent,p=new Array(o+2);for(c=0;c<=o;++c){for(var f=h.slice(),v=0;v<=o;++v)v===c&&(f[v]=-1);var m=f[0];f[0]=f[1],f[1]=m;var b=new n(f,new Array(o+1),!0);d[c]=b,p[c]=b}p[o+1]=u;for(c=0;c<=o;++c){f=d[c].vertices;var g=d[c].adjacent;for(v=0;v<=o;++v){var w=f[v];if(w<0)g[v]=u;else for(var y=0;y<=o;++y)d[y].vertices.indexOf(w)<0&&(g[v]=d[y])}}var C=new l(o,r,p),x=!!e;for(c=o+1;c<i;++c)C.insert(t[c],x);return C.boundary()};var s=i(10),o=i(13).compareCells;function n(t,e,i){this.vertices=t,this.adjacent=e,this.boundary=i,this.lastVisited=-1}function r(t,e,i){this.vertices=t,this.cell=e,this.index=i}function a(t,e){return o(t.vertices,e.vertices)}n.prototype.flip=function(){var t=this.vertices[0];this.vertices[0]=this.vertices[1],this.vertices[1]=t;var e=this.adjacent[0];this.adjacent[0]=this.adjacent[1],this.adjacent[1]=e};var h=[];function l(t,e,i){this.dimension=t,this.vertices=e,this.simplices=i,this.interior=i.filter((function(t){return!t.boundary})),this.tuple=new Array(t+1);for(var o=0;o<=t;++o)this.tuple[o]=this.vertices[o];var n=h[t];n||(n=h[t]=function(t){for(var e=["function orient(){var tuple=this.tuple;return test("],i=0;i<=t;++i)i>0&&e.push(","),e.push("tuple[",i,"]");e.push(")}return orient");var o=new Function("test",e.join("")),n=s[t+1];return n||(n=s),o(n)}(t)),this.orient=n}var c=l.prototype;c.handleBoundaryDegeneracy=function(t,e){var i=this.dimension,s=this.vertices.length-1,o=this.tuple,n=this.vertices,r=[t];for(t.lastVisited=-s;r.length>0;){(t=r.pop()).vertices;for(var a=t.adjacent,h=0;h<=i;++h){var l=a[h];if(l.boundary&&!(l.lastVisited<=-s)){for(var c=l.vertices,u=0;u<=i;++u){var d=c[u];o[u]=d<0?e:n[d]}var p=this.orient();if(p>0)return l;l.lastVisited=-s,0===p&&r.push(l)}}}return null},c.walk=function(t,e){var i=this.vertices.length-1,s=this.dimension,o=this.vertices,n=this.tuple,r=e?this.interior.length*Math.random()|0:this.interior.length-1,a=this.interior[r];t:for(;!a.boundary;){for(var h=a.vertices,l=a.adjacent,c=0;c<=s;++c)n[c]=o[h[c]];a.lastVisited=i;for(c=0;c<=s;++c){var u=l[c];if(!(u.lastVisited>=i)){var d=n[c];n[c]=t;var p=this.orient();if(n[c]=d,p<0){a=u;continue t}u.boundary?u.lastVisited=-i:u.lastVisited=i}}return}return a},c.addPeaks=function(t,e){var i=this.vertices.length-1,s=this.dimension,o=this.vertices,h=this.tuple,l=this.interior,c=this.simplices,u=[e];e.lastVisited=i,e.vertices[e.vertices.indexOf(-1)]=i,e.boundary=!1,l.push(e);for(var d=[];u.length>0;){var p=(e=u.pop()).vertices,f=e.adjacent,v=p.indexOf(i);if(!(v<0))for(var m=0;m<=s;++m)if(m!==v){var b=f[m];if(b.boundary&&!(b.lastVisited>=i)){var g=b.vertices;if(b.lastVisited!==-i){for(var w=0,y=0;y<=s;++y)g[y]<0?(w=y,h[y]=t):h[y]=o[g[y]];if(this.orient()>0){g[w]=i,b.boundary=!1,l.push(b),u.push(b),b.lastVisited=i;continue}b.lastVisited=-i}var C=b.adjacent,x=p.slice(),V=f.slice(),A=new n(x,V,!0);c.push(A);var M=C.indexOf(e);if(!(M<0)){C[M]=A,V[v]=b,x[m]=-1,V[m]=e,f[m]=A,A.flip();for(y=0;y<=s;++y){var _=x[y];if(!(_<0||_===i)){for(var S=new Array(s-1),k=0,z=0;z<=s;++z){var E=x[z];E<0||z===y||(S[k++]=E)}d.push(new r(S,A,y))}}}}}}d.sort(a);for(m=0;m+1<d.length;m+=2){var P=d[m],j=d[m+1],L=P.index,O=j.index;L<0||O<0||(P.cell.adjacent[P.index]=j.cell,j.cell.adjacent[j.index]=P.cell)}},c.insert=function(t,e){var i=this.vertices;i.push(t);var s=this.walk(t,e);if(s){for(var o=this.dimension,n=this.tuple,r=0;r<=o;++r){var a=s.vertices[r];n[r]=a<0?t:i[a]}var h=this.orient(n);h<0||(0!==h||(s=this.handleBoundaryDegeneracy(s,t)))&&this.addPeaks(t,s)}},c.boundary=function(){for(var t=this.dimension,e=[],i=this.simplices,s=i.length,o=0;o<s;++o){var n=i[o];if(n.boundary){for(var r=new Array(t),a=n.vertices,h=0,l=0,c=0;c<=t;++c)a[c]>=0?r[h++]=a[c]:l=1&c;if(l===(1&t)){var u=r[0];r[0]=r[1],r[1]=u}e.push(r)}}return e}},function(t,e,i){"use strict";var s=i(2),o=i(3),n=i(4),r=i(12);function a(t,e){for(var i=new Array(t.length-1),s=1;s<t.length;++s)for(var o=i[s-1]=new Array(t.length-1),n=0,r=0;n<t.length;++n)n!==e&&(o[r++]=t[s][n]);return i}function h(t){if(1===t.length)return t[0];if(2===t.length)return["sum(",t[0],",",t[1],")"].join("");var e=t.length>>1;return["sum(",h(t.slice(0,e)),",",h(t.slice(e)),")"].join("")}function l(t){if(2===t.length)return[["sum(prod(",t[0][0],",",t[1][1],"),prod(-",t[0][1],",",t[1][0],"))"].join("")];for(var e=[],i=0;i<t.length;++i)e.push(["scale(",h(l(a(t,i))),",",(s=i,1&s?"-":""),t[0][i],")"].join(""));return e;var s}function c(t){for(var e=[],i=[],c=function(t){for(var e=new Array(t),i=0;i<t;++i){e[i]=new Array(t);for(var s=0;s<t;++s)e[i][s]=["m",s,"[",t-i-1,"]"].join("")}return e}(t),u=[],d=0;d<t;++d)0==(1&d)?e.push.apply(e,l(a(c,d))):i.push.apply(i,l(a(c,d))),u.push("m"+d);var p=h(e),f=h(i),v="orientation"+t+"Exact",m=["function ",v,"(",u.join(),"){var p=",p,",n=",f,",d=sub(p,n);return d[d.length-1];};return ",v].join("");return new Function("sum","prod","scale","sub",m)(o,s,n,r)}var u=c(3),d=c(4),p=[function(){return 0},function(){return 0},function(t,e){return e[0]-t[0]},function(t,e,i){var s,o=(t[1]-i[1])*(e[0]-i[0]),n=(t[0]-i[0])*(e[1]-i[1]),r=o-n;if(o>0){if(n<=0)return r;s=o+n}else{if(!(o<0))return r;if(n>=0)return r;s=-(o+n)}var a=33306690738754716e-32*s;return r>=a||r<=-a?r:u(t,e,i)},function(t,e,i,s){var o=t[0]-s[0],n=e[0]-s[0],r=i[0]-s[0],a=t[1]-s[1],h=e[1]-s[1],l=i[1]-s[1],c=t[2]-s[2],u=e[2]-s[2],p=i[2]-s[2],f=n*l,v=r*h,m=r*a,b=o*l,g=o*h,w=n*a,y=c*(f-v)+u*(m-b)+p*(g-w),C=7771561172376103e-31*((Math.abs(f)+Math.abs(v))*Math.abs(c)+(Math.abs(m)+Math.abs(b))*Math.abs(u)+(Math.abs(g)+Math.abs(w))*Math.abs(p));return y>C||-y>C?y:d(t,e,i,s)}];function f(t){var e=p[t.length];return e||(e=p[t.length]=c(t.length)),e.apply(void 0,t)}!function(){for(;p.length<=5;)p.push(c(p.length));for(var e=[],i=["slow"],s=0;s<=5;++s)e.push("a"+s),i.push("o"+s);var o=["function getOrientation(",e.join(),"){switch(arguments.length){case 0:case 1:return 0;"];for(s=2;s<=5;++s)o.push("case ",s,":return o",s,"(",e.slice(0,s).join(),");");o.push("}var s=new Array(arguments.length);for(var i=0;i<arguments.length;++i){s[i]=arguments[i]};return slow(s);}return getOrientation"),i.push(o.join(""));var n=Function.apply(void 0,i);for(t.exports=n.apply(void 0,[f].concat(p)),s=0;s<=5;++s)t.exports[s]=p[s]}()},function(t,e,i){"use strict";t.exports=function(t,e,i){var s=t+e,o=s-t,n=e-o,r=t-(s-o);if(i)return i[0]=r+n,i[1]=s,i;return[r+n,s]}},function(t,e,i){"use strict";t.exports=function(t,e){var i=0|t.length,s=0|e.length;if(1===i&&1===s)return function(t,e){var i=t+e,s=i-t,o=t-(i-s)+(e-s);if(o)return[o,i];return[i]}(t[0],-e[0]);var o,n,r=new Array(i+s),a=0,h=0,l=0,c=Math.abs,u=t[h],d=c(u),p=-e[l],f=c(p);d<f?(n=u,(h+=1)<i&&(u=t[h],d=c(u))):(n=p,(l+=1)<s&&(p=-e[l],f=c(p)));h<i&&d<f||l>=s?(o=u,(h+=1)<i&&(u=t[h],d=c(u))):(o=p,(l+=1)<s&&(p=-e[l],f=c(p)));var v,m,b=o+n,g=b-o,w=n-g,y=w,C=b;for(;h<i&&l<s;)d<f?(o=u,(h+=1)<i&&(u=t[h],d=c(u))):(o=p,(l+=1)<s&&(p=-e[l],f=c(p))),(w=(n=y)-(g=(b=o+n)-o))&&(r[a++]=w),y=C-((v=C+b)-(m=v-C))+(b-m),C=v;for(;h<i;)(w=(n=y)-(g=(b=(o=u)+n)-o))&&(r[a++]=w),y=C-((v=C+b)-(m=v-C))+(b-m),C=v,(h+=1)<i&&(u=t[h]);for(;l<s;)(w=(n=y)-(g=(b=(o=p)+n)-o))&&(r[a++]=w),y=C-((v=C+b)-(m=v-C))+(b-m),C=v,(l+=1)<s&&(p=-e[l]);y&&(r[a++]=y);C&&(r[a++]=C);a||(r[a++]=0);return r.length=a,r}},function(t,e,i){"use strict";var s=i(14),o=i(15);function n(t,e){var i=t.length,s=t.length-e.length,o=Math.min;if(s)return s;switch(i){case 0:return 0;case 1:return t[0]-e[0];case 2:return(a=t[0]+t[1]-e[0]-e[1])||o(t[0],t[1])-o(e[0],e[1]);case 3:var n=t[0]+t[1],r=e[0]+e[1];if(a=n+t[2]-(r+e[2]))return a;var a,h=o(t[0],t[1]),l=o(e[0],e[1]);return(a=o(h,t[2])-o(l,e[2]))||o(h+t[2],n)-o(l+e[2],r);default:var c=t.slice(0);c.sort();var u=e.slice(0);u.sort();for(var d=0;d<i;++d)if(s=c[d]-u[d])return s;return 0}}function r(t,e){return n(t[0],e[0])}function a(t,e){if(e){for(var i=t.length,s=new Array(i),o=0;o<i;++o)s[o]=[t[o],e[o]];s.sort(r);for(o=0;o<i;++o)t[o]=s[o][0],e[o]=s[o][1];return t}return t.sort(n),t}function h(t){if(0===t.length)return[];for(var e=1,i=t.length,s=1;s<i;++s){var o=t[s];if(n(o,t[s-1])){if(s===e){e++;continue}t[e++]=o}}return t.length=e,t}function l(t,e){for(var i=0,s=t.length-1,o=-1;i<=s;){var r=i+s>>1,a=n(t[r],e);a<=0?(0===a&&(o=r),i=r+1):a>0&&(s=r-1)}return o}function c(t,e){for(var i=new Array(t.length),o=0,r=i.length;o<r;++o)i[o]=[];for(var a=[],h=(o=0,e.length);o<h;++o)for(var c=e[o],u=c.length,d=1,p=1<<u;d<p;++d){a.length=s.popCount(d);for(var f=0,v=0;v<u;++v)d&1<<v&&(a[f++]=c[v]);var m=l(t,a);if(!(m<0))for(;i[m++].push(o),!(m>=t.length||0!==n(t[m],a)););}return i}function u(t,e){if(e<0)return[];for(var i=[],o=(1<<e+1)-1,n=0;n<t.length;++n)for(var r=t[n],h=o;h<1<<r.length;h=s.nextCombination(h)){for(var l=new Array(e+1),c=0,u=0;u<r.length;++u)h&1<<u&&(l[c++]=r[u]);i.push(l)}return a(i)}e.dimension=function(t){for(var e=0,i=Math.max,s=0,o=t.length;s<o;++s)e=i(e,t[s].length);return e-1},e.countVertices=function(t){for(var e=-1,i=Math.max,s=0,o=t.length;s<o;++s)for(var n=t[s],r=0,a=n.length;r<a;++r)e=i(e,n[r]);return e+1},e.cloneCells=function(t){for(var e=new Array(t.length),i=0,s=t.length;i<s;++i)e[i]=t[i].slice(0);return e},e.compareCells=n,e.normalize=a,e.unique=h,e.findCell=l,e.incidence=c,e.dual=function(t,e){if(!e)return c(h(u(t,0)),t);for(var i=new Array(e),s=0;s<e;++s)i[s]=[];s=0;for(var o=t.length;s<o;++s)for(var n=t[s],r=0,a=n.length;r<a;++r)i[n[r]].push(s);return i},e.explode=function(t){for(var e=[],i=0,s=t.length;i<s;++i)for(var o=t[i],n=0|o.length,r=1,h=1<<n;r<h;++r){for(var l=[],c=0;c<n;++c)r>>>c&1&&l.push(o[c]);e.push(l)}return a(e)},e.skeleton=u,e.boundary=function(t){for(var e=[],i=0,s=t.length;i<s;++i)for(var o=t[i],n=0,r=o.length;n<r;++n){for(var h=new Array(o.length-1),l=0,c=0;l<r;++l)l!==n&&(h[c++]=o[l]);e.push(h)}return a(e)},e.connectedComponents=function(t,e){return e?function(t,e){for(var i=new o(e),s=0;s<t.length;++s)for(var n=t[s],r=0;r<n.length;++r)for(var a=r+1;a<n.length;++a)i.link(n[r],n[a]);var h=[],l=i.ranks;for(s=0;s<l.length;++s)l[s]=-1;for(s=0;s<t.length;++s){var c=i.find(t[s][0]);l[c]<0?(l[c]=h.length,h.push([t[s].slice(0)])):h[l[c]].push(t[s].slice(0))}return h}(t,e):function(t){for(var e=h(a(u(t,0))),i=new o(e.length),s=0;s<t.length;++s)for(var n=t[s],r=0;r<n.length;++r)for(var c=l(e,[n[r]]),d=r+1;d<n.length;++d)i.link(c,l(e,[n[d]]));var p=[],f=i.ranks;for(s=0;s<f.length;++s)f[s]=-1;for(s=0;s<t.length;++s){var v=i.find(l(e,[t[s][0]]));f[v]<0?(f[v]=p.length,p.push([t[s].slice(0)])):p[f[v]].push(t[s].slice(0))}return p}(t)}},function(t,e,i){"use strict";function s(t){var e=32;return(t&=-t)&&e--,65535&t&&(e-=16),16711935&t&&(e-=8),252645135&t&&(e-=4),858993459&t&&(e-=2),1431655765&t&&(e-=1),e}e.INT_BITS=32,e.INT_MAX=2147483647,e.INT_MIN=-1<<31,e.sign=function(t){return(t>0)-(t<0)},e.abs=function(t){var e=t>>31;return(t^e)-e},e.min=function(t,e){return e^(t^e)&-(t<e)},e.max=function(t,e){return t^(t^e)&-(t<e)},e.isPow2=function(t){return!(t&t-1||!t)},e.log2=function(t){var e,i;return e=(t>65535)<<4,e|=i=((t>>>=e)>255)<<3,e|=i=((t>>>=i)>15)<<2,(e|=i=((t>>>=i)>3)<<1)|(t>>>=i)>>1},e.log10=function(t){return t>=1e9?9:t>=1e8?8:t>=1e7?7:t>=1e6?6:t>=1e5?5:t>=1e4?4:t>=1e3?3:t>=100?2:t>=10?1:0},e.popCount=function(t){return 16843009*((t=(858993459&(t-=t>>>1&1431655765))+(t>>>2&858993459))+(t>>>4)&252645135)>>>24},e.countTrailingZeros=s,e.nextPow2=function(t){return t+=0===t,--t,t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)+1},e.prevPow2=function(t){return t|=t>>>1,t|=t>>>2,t|=t>>>4,t|=t>>>8,(t|=t>>>16)-(t>>>1)},e.parity=function(t){return t^=t>>>16,t^=t>>>8,t^=t>>>4,27030>>>(t&=15)&1};var o=new Array(256);!function(t){for(var e=0;e<256;++e){var i=e,s=e,o=7;for(i>>>=1;i;i>>>=1)s<<=1,s|=1&i,--o;t[e]=s<<o&255}}(o),e.reverse=function(t){return o[255&t]<<24|o[t>>>8&255]<<16|o[t>>>16&255]<<8|o[t>>>24&255]},e.interleave2=function(t,e){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t&=65535)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e&=65535)|e<<8))|e<<4))|e<<2))|e<<1))<<1},e.deinterleave2=function(t,e){return(t=65535&((t=16711935&((t=252645135&((t=858993459&((t=t>>>e&1431655765)|t>>>1))|t>>>2))|t>>>4))|t>>>16))<<16>>16},e.interleave3=function(t,e,i){return t=1227133513&((t=3272356035&((t=251719695&((t=4278190335&((t&=1023)|t<<16))|t<<8))|t<<4))|t<<2),(t|=(e=1227133513&((e=3272356035&((e=251719695&((e=4278190335&((e&=1023)|e<<16))|e<<8))|e<<4))|e<<2))<<1)|(i=1227133513&((i=3272356035&((i=251719695&((i=4278190335&((i&=1023)|i<<16))|i<<8))|i<<4))|i<<2))<<2},e.deinterleave3=function(t,e){return(t=1023&((t=4278190335&((t=251719695&((t=3272356035&((t=t>>>e&1227133513)|t>>>2))|t>>>4))|t>>>8))|t>>>16))<<22>>22},e.nextCombination=function(t){var e=t|t-1;return e+1|(~e&-~e)-1>>>s(t)+1}},function(t,e,i){"use strict";function s(t){this.roots=new Array(t),this.ranks=new Array(t);for(var e=0;e<t;++e)this.roots[e]=e,this.ranks[e]=0}t.exports=s;var o=s.prototype;Object.defineProperty(o,"length",{get:function(){return this.roots.length}}),o.makeSet=function(){var t=this.roots.length;return this.roots.push(t),this.ranks.push(0),t},o.find=function(t){for(var e=t,i=this.roots;i[t]!==t;)t=i[t];for(;i[e]!==t;){var s=i[e];i[e]=t,e=s}return t},o.link=function(t,e){var i=this.find(t),s=this.find(e);if(i!==s){var o=this.ranks,n=this.roots,r=o[i],a=o[s];r<a?n[i]=s:a<r?n[s]=i:(n[s]=i,++o[i])}}},function(t,e,i){"use strict";var s=i(17),o=i(18);function n(t,e){for(var i=0,s=t.length,o=0;o<s;++o)i+=t[o]*e[o];return i}function r(t){var e=t.length;if(0===e)return[];t[0].length;var i=s([t.length+1,t.length+1],1),r=s([t.length+1],1);i[e][e]=0;for(var a=0;a<e;++a){for(var h=0;h<=a;++h)i[h][a]=i[a][h]=2*n(t[a],t[h]);r[a]=n(t[a],t[a])}var l=o(i,r),c=0,u=l[e+1];for(a=0;a<u.length;++a)c+=u[a];var d=new Array(e);for(a=0;a<e;++a){u=l[a];var p=0;for(h=0;h<u.length;++h)p+=u[h];d[a]=p/c}return d}function a(t){if(0===t.length)return[];for(var e=t[0].length,i=s([e]),o=r(t),n=0;n<t.length;++n)for(var a=0;a<e;++a)i[a]+=t[n][a]*o[n];return i}a.barycenetric=r,t.exports=a},function(t,e,i){"use strict";t.exports=function(t,e){switch(void 0===e&&(e=0),typeof t){case"number":if(t>0)return function(t,e){var i,s;for(i=new Array(t),s=0;s<t;++s)i[s]=e;return i}(0|t,e);break;case"object":if("number"==typeof t.length)return function t(e,i,s){var o=0|e[s];if(o<=0)return[];var n,r=new Array(o);if(s===e.length-1)for(n=0;n<o;++n)r[n]=i;else for(n=0;n<o;++n)r[n]=t(e,i,s+1);return r}(t,e,0)}return[]}},function(t,e,i){"use strict";var s=i(19);function o(t){for(var e="robustLinearSolve"+t+"d",i=["function ",e,"(A,b){return ["],o=0;o<t;++o){i.push("det([");for(var n=0;n<t;++n){n>0&&i.push(","),i.push("[");for(var r=0;r<t;++r)r>0&&i.push(","),r===o?i.push("+b[",n,"]"):i.push("+A[",n,"][",r,"]");i.push("]")}i.push("]),")}i.push("det(A)]}return ",e);var a=new Function("det",i.join(""));return a(t<6?s[t]:s)}var n=[function(){return[0]},function(t,e){return[[e[0]],[t[0][0]]]}];!function(){for(;n.length<6;)n.push(o(n.length));for(var e=[],i=["function dispatchLinearSolve(A,b){switch(A.length){"],s=0;s<6;++s)e.push("s"+s),i.push("case ",s,":return s",s,"(A,b);");i.push("}var s=CACHE[A.length];if(!s)s=CACHE[A.length]=g(A.length);return s(A,b)}return dispatchLinearSolve"),e.push("CACHE","g",i.join(""));var r=Function.apply(void 0,e);for(t.exports=r.apply(void 0,n.concat([n,o])),s=0;s<6;++s)t.exports[s]=n[s]}()},function(t,e,i){"use strict";var s=i(2),o=i(3),n=i(4),r=i(20);function a(t,e){for(var i=new Array(t.length-1),s=1;s<t.length;++s)for(var o=i[s-1]=new Array(t.length-1),n=0,r=0;n<t.length;++n)n!==e&&(o[r++]=t[s][n]);return i}function h(t){for(var e=new Array(t),i=0;i<t;++i){e[i]=new Array(t);for(var s=0;s<t;++s)e[i][s]=["m[",i,"][",s,"]"].join("")}return e}function l(t){if(2===t.length)return["sum(prod(",t[0][0],",",t[1][1],"),prod(-",t[0][1],",",t[1][0],"))"].join("");for(var e=[],i=0;i<t.length;++i)e.push(["scale(",l(a(t,i)),",",(s=i,1&s?"-":""),t[0][i],")"].join(""));return function t(e){if(1===e.length)return e[0];if(2===e.length)return["sum(",e[0],",",e[1],")"].join("");var i=e.length>>1;return["sum(",t(e.slice(0,i)),",",t(e.slice(i)),")"].join("")}(e);var s}function c(t){return new Function("sum","scale","prod","compress",["function robustDeterminant",t,"(m){return compress(",l(h(t)),")};return robustDeterminant",t].join(""))(o,n,s,r)}var u=[function(){return[0]},function(t){return[t[0][0]]}];!function(){for(;u.length<6;)u.push(c(u.length));for(var e=[],i=["function robustDeterminant(m){switch(m.length){"],s=0;s<6;++s)e.push("det"+s),i.push("case ",s,":return det",s,"(m);");i.push("}var det=CACHE[m.length];if(!det)det=CACHE[m.length]=gen(m.length);return det(m);}return robustDeterminant"),e.push("CACHE","gen",i.join(""));var o=Function.apply(void 0,e);for(t.exports=o.apply(void 0,u.concat([u,c])),s=0;s<u.length;++s)t.exports[s]=u[s]}()},function(t,e,i){"use strict";t.exports=function(t){for(var e=t.length,i=t[t.length-1],s=e,o=e-2;o>=0;--o){var n=i,r=t[o];(h=r-((i=n+r)-n))&&(t[--s]=i,i=h)}var a=0;for(o=s;o<e;++o){var h;n=t[o];(h=(r=i)-((i=n+r)-n))&&(t[a++]=h)}return t[a++]=i,t.length=a,t}},function(t,e,i){"use strict";i.r(e),i.d(e,"StructureViewer",(function(){return v})),i.d(e,"BrillouinZoneViewer",(function(){return A}));var s=i(0),o=new CustomEvent("change"),n=new CustomEvent("start"),r=new CustomEvent("end"),a=-1,h=0,l=1,c=2,u=3,d=4;class p{constructor(t,e){this._state=a,this.object=t,this.domElement=void 0!==e?e:document,this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=.2,this.panSpeed=.3,this.enableRotate=!0,this.enableZoom=!0,this.enablePan=!0,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.keys=[65,83,68],this.rotationCenter=new s.Vector3,this.target=new s.Vector3,this._prevState=a,this._eye=new s.Vector3,this._movePrev=new s.Vector2,this._moveCurr=new s.Vector2,this._lastAxis=new s.Vector3,this._lastAngle=0,this._lastPosition=new s.Vector3,this._zoomStart=new s.Vector2,this._zoomEnd=new s.Vector2,this._touchZoomDistanceStart=0,this._touchZoomDistanceEnd=0,this._panStart=new s.Vector2,this._panEnd=new s.Vector2,this._zoomed=!1,this.rotationCenter0=this.rotationCenter.clone(),this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.zoom0=this.object.zoom,this.domElement.addEventListener("contextmenu",this.contextmenu.bind(this),!1),this.domElement.addEventListener("mousedown",this.mousedown.bind(this),!1),this.domElement.addEventListener("mousewheel",this.mousewheel.bind(this),!1),this.domElement.addEventListener("MozMousePixelScroll",this.mousewheel.bind(this),!1),this.domElement.addEventListener("touchstart",this.touchstart.bind(this),!1),this.domElement.addEventListener("touchend",this.touchend.bind(this),!1),this.domElement.addEventListener("touchmove",this.touchmove.bind(this),!1),window.addEventListener("keydown",this.keydown.bind(this),!1),window.addEventListener("keyup",this.keyup.bind(this),!1),window.addEventListener("keydown",this.keydown.bind(this),!1),document.addEventListener("mousemove",this.mousemove.bind(this),!1),document.addEventListener("mouseup",this.mouseup.bind(this),!1),this.handleResize(),this.update()}handleResize(){if(this.domElement===document)this.screen.left=0,this.screen.top=0,this.screen.width=window.innerWidth,this.screen.height=window.innerHeight;else{var t=this.domElement.getBoundingClientRect(),e=this.domElement.ownerDocument.documentElement;this.screen.left=t.left+window.pageXOffset-e.clientLeft,this.screen.top=t.top+window.pageYOffset-e.clientTop,this.screen.width=t.width,this.screen.height=t.height}}handleEvent(t){"function"==typeof this[t.type]&&this[t.type](t)}getMouseOnScreen(t,e){var i=new s.Vector2;return i.set((t-this.screen.left)/this.screen.width,(e-this.screen.top)/this.screen.width),i}getMouseOnCircle(t,e){var i=new s.Vector2;return i.set((t-.5*this.screen.width-this.screen.left)/(.5*this.screen.width),(this.screen.height+2*(this.screen.top-e))/this.screen.width),i}rotateCamera(){var t,e=new s.Vector3,i=new s.Quaternion,o=new s.Vector3,n=new s.Vector3,r=new s.Vector3,a=new s.Vector3;if(a.set(this._moveCurr.x-this._movePrev.x,this._moveCurr.y-this._movePrev.y,0),t=a.length()){this._eye.copy(this.object.position).sub(this.rotationCenter),o.copy(this._eye).normalize(),n.copy(this.object.up).normalize(),r.crossVectors(n,o).normalize(),n.setLength(this._moveCurr.y-this._movePrev.y),r.setLength(this._moveCurr.x-this._movePrev.x),a.copy(n.add(r)),e.crossVectors(a,this._eye).normalize();var h=this.object.zoom;t*=this.rotateSpeed,t/=h,i.setFromAxisAngle(e,t),this._eye.applyQuaternion(i),this.object.up.applyQuaternion(i),this._lastAxis.copy(e),this._lastAngle=t}else!this.staticMoving&&this._lastAngle&&(this._lastAngle*=Math.sqrt(1-this.dynamicDampingFactor),this._eye.copy(this.object.position).sub(this.rotationCenter),i.setFromAxisAngle(this._lastAxis,this._lastAngle),this._eye.applyQuaternion(i),this.object.up.applyQuaternion(i));this._movePrev.copy(this._moveCurr)}zoomCamera(){var t;this._state===d?(t=this._touchZoomDistanceStart/this._touchZoomDistanceEnd,this._touchZoomDistanceStart=this._touchZoomDistanceEnd,this.object.zoom/=t,this.object.updateProjectionMatrix(),this._zoomed=!0):1!==(t=this._zoomEnd.y-this._zoomStart.y+1)&&t>0&&(this.object.zoom/=t,this.object.updateProjectionMatrix(),this._zoomed=!0,this.staticMoving?this._zoomStart.copy(this._zoomEnd):this._zoomStart.y+=(this._zoomEnd.y-this._zoomStart.y)*this.dynamicDampingFactor)}panCamera(){var t=new s.Vector2,e=new s.Vector3,i=new s.Vector3;if(t.copy(this._panEnd).sub(this._panStart),t.lengthSq()){var o=this.object.zoom;t.multiplyScalar(this.panSpeed/o),i.copy(this._eye).cross(this.object.up).setLength(t.x),i.add(e.copy(this.object.up).setLength(t.y)),this.object.position.add(i),this.rotationCenter.add(i),this.staticMoving?this._panStart.copy(this._panEnd):this._panStart.add(t.subVectors(this._panEnd,this._panStart).multiplyScalar(this.dynamicDampingFactor))}}checkDistances(){(this.enableZoom||this.enablePan)&&(this._eye.lengthSq()>this.maxDistance*this.maxDistance&&(this.object.position.addVectors(this.rotationCenter,this._eye.setLength(this.maxDistance)),this._zoomStart.copy(this._zoomEnd)),this._eye.lengthSq()<this.minDistance*this.minDistance&&(this.object.position.addVectors(this.rotationCenter,this._eye.setLength(this.minDistance)),this._zoomStart.copy(this._zoomEnd)))}update(){this._eye.subVectors(this.object.position,this.rotationCenter),this.enableRotate&&this.rotateCamera(),this.enableZoom&&this.zoomCamera(),this.enablePan&&this.panCamera(),this.object.position.addVectors(this.rotationCenter,this._eye),this.checkDistances(),this.object.lookAt(this.rotationCenter),(this._lastPosition.distanceToSquared(this.object.position)>1e-4||this._zoomed)&&(this.dispatchEvent(o),this._lastPosition.copy(this.object.position),this._zoomed=!1)}saveReset(){this.rotationCenter0.copy(this.rotationCenter),this.position0.copy(this.object.position),this.up0.copy(this.object.up),this.zoom0=this.object.zoom}reset(){this._state=a,this._prevState=a,this.rotationCenter.copy(this.rotationCenter0),this.object.position.copy(this.position0),this.object.up.copy(this.up0),this._eye.subVectors(this.object.position,this.rotationCenter),this.object.lookAt(this.rotationCenter),this.object.zoom=this.zoom0,this.object.updateProjectionMatrix(),this.dispatchEvent(o),this._lastPosition.copy(this.object.position)}dispose(){this.domElement.removeEventListener("contextmenu",this.contextmenu.bind(this),!1),this.domElement.removeEventListener("mousedown",this.mousedown.bind(this),!1),this.domElement.removeEventListener("mousewheel",this.mousewheel.bind(this),!1),this.domElement.removeEventListener("MozMousePixelScroll",this.mousewheel.bind(this),!1),this.domElement.removeEventListener("touchstart",this.touchstart.bind(this),!1),this.domElement.removeEventListener("touchend",this.touchend.bind(this),!1),this.domElement.removeEventListener("touchmove",this.touchmove.bind(this),!1),document.removeEventListener("mousemove",this.mousemove.bind(this),!1),document.removeEventListener("mouseup",this.mouseup.bind(this),!1),window.removeEventListener("keydown",this.keydown.bind(this),!1),window.removeEventListener("keyup",this.keyup.bind(this),!1)}keydown(t){!1!==this.enabled&&(window.removeEventListener("keydown",this.keydown.bind(this)),this._prevState=this._state,this._state===a&&(t.keyCode===this.keys[h]&&this.enableRotate?this._state=h:t.keyCode===this.keys[l]&&this.enableZoom?this._state=l:t.keyCode===this.keys[c]&&this.enablePan&&(this._state=c)))}keyup(t){!1!==this.enabled&&(this._state=this._prevState)}mousedown(t){!1!==this.enabled&&(t.preventDefault(),t.stopPropagation(),this._state===a&&(this._state=t.button),this._state===h&&this.enableRotate?(this._moveCurr.copy(this.getMouseOnCircle(t.pageX,t.pageY)),this._movePrev.copy(this._moveCurr)):this._state===l&&this.enableZoom?(this._zoomStart.copy(this.getMouseOnScreen(t.pageX,t.pageY)),this._zoomEnd.copy(this._zoomStart)):this._state===c&&this.enablePan&&(this._panStart.copy(this.getMouseOnScreen(t.pageX,t.pageY)),this._panEnd.copy(this._panStart)),this.dispatchEvent(n))}mousemove(t){!1!==this.enabled&&(this._state!==a&&(t.preventDefault(),t.stopPropagation()),this._state===h&&this.enableRotate?(this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this.getMouseOnCircle(t.pageX,t.pageY))):this._state===l&&this.enableZoom?this._zoomEnd.copy(this.getMouseOnScreen(t.pageX,t.pageY)):this._state===c&&this.enablePan&&this._panEnd.copy(this.getMouseOnScreen(t.pageX,t.pageY)),this.update())}mouseup(t){!1!==this.enabled&&(t.preventDefault(),t.stopPropagation(),this._state=a,document.removeEventListener("mousemove",this.mousemove.bind(this)),document.removeEventListener("mouseup",this.mouseup.bind(this)),this.dispatchEvent(r))}mousewheel(t){if(!1===this.enabled)return;t.preventDefault(),t.stopPropagation();let e=0;t.wheelDelta?e=t.wheelDelta:t.detail&&(e=-t.detail),e/=Math.abs(e),this._zoomStart.y+=e*this.zoomSpeed,this.dispatchEvent(n),this.dispatchEvent(r),this.update()}touchstart(t){if(!1!==this.enabled){switch(t.touches.length){case 1:this._state=u,this._moveCurr.copy(this.getMouseOnCircle(t.touches[0].pageX,t.touches[0].pageY)),this._movePrev.copy(this._moveCurr);break;default:this._state=d;var e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY;this._touchZoomDistanceEnd=this._touchZoomDistanceStart=Math.sqrt(e*e+i*i);var s=(t.touches[0].pageX+t.touches[1].pageX)/2,o=(t.touches[0].pageY+t.touches[1].pageY)/2;this._panStart.copy(this.getMouseOnScreen(s,o)),this._panEnd.copy(this._panStart)}this.dispatchEvent(n)}}touchmove(t){if(!1!==this.enabled){switch(t.preventDefault(),t.stopPropagation(),t.touches.length){case 1:this._movePrev.copy(this._moveCurr),this._moveCurr.copy(this.getMouseOnCircle(t.touches[0].pageX,t.touches[0].pageY));break;default:var e=t.touches[0].pageX-t.touches[1].pageX,i=t.touches[0].pageY-t.touches[1].pageY;this._touchZoomDistanceEnd=Math.sqrt(e*e+i*i);var s=(t.touches[0].pageX+t.touches[1].pageX)/2,o=(t.touches[0].pageY+t.touches[1].pageY)/2;this._panEnd.copy(this.getMouseOnScreen(s,o))}this.update()}}touchend(t){if(!1!==this.enabled){switch(t.touches.length){case 0:this._state=a;break;case 1:this._state=u,this._moveCurr.copy(this.getMouseOnCircle(t.touches[0].pageX,t.touches[0].pageY)),this._movePrev.copy(this._moveCurr)}this.dispatchEvent(r)}}contextmenu(t){t.preventDefault()}addEventListener(t,e){void 0===this._listeners&&(this._listeners={});var i=this._listeners;void 0===i[t]&&(i[t]=[]),-1===i[t].indexOf(e)&&i[t].push(e)}hasEventListener(t,e){if(void 0===this._listeners)return!1;var i=this._listeners;return void 0!==i[t]&&-1!==i[t].indexOf(e)}removeEventListener(t,e){if(void 0!==this._listeners){var i=this._listeners[t];if(void 0!==i){var s=i.indexOf(e);-1!==s&&i.splice(s,1)}}}dispatchEvent(t){if(void 0!==this._listeners){var e=this._listeners[t.type];if(void 0!==e)for(var i=e.slice(0),s=0,o=i.length;s<o;s++)i[s].call(this,t)}}}class f{constructor(t,e={}){if(this.hostElement=t,this.scenes=[],this.cameraWidth=10,this.options={},!this.webglAvailable())throw Error("WebGL is not supported on this browser, cannot display viewer.");this.setOptions(e),this.setupRootElement(),this.setupRenderer(),this.setupScenes(),this.setupCamera(),this.setupControls(),this.changeHostElement(t,!1,!1),this.options.view.autoResize&&window.addEventListener("resize",this.onWindowResize.bind(this),!1)}setOptions(t){const e={controls:{enableZoom:!0,enableRotate:!0,enablePan:!0,panSpeed:10,zoomSpeed:.2,rotateSpeed:2.5,zoomLevel:1},view:{autoFit:!0,autoResize:!0,fitMargin:.5},renderer:{background:{color:"#ffffff",opacity:0},shadows:{enabled:!1}}};this.fillOptions(t,e),this.options=e}fillOptions(t,e){!function t(e,i){for(const s in e)null!==e[s]&&"[object Object]"===Object.prototype.toString.call(e[s])?(void 0===i[s]&&(i[s]={}),t(e[s],i[s])):i[s]=e[s]}(t,e)}setup(){this.setupScenes(),this.setupLights(),this.setupCamera(),this.setupControls()}setupScenes(){this.scenes=[],this.scene=new s.Scene,this.scenes.push(this.scene)}clear(){this.clearScenes(),this.scenes=null,this.controls=null,this.camera=null}clearScenes(){for(let t=0;t<this.scenes.length;++t){let e=this.scenes[t];for(e.traverse((function(t){let e=t.geometry,i=t.material,s=t.texture;e&&e.dispose(),i&&i.dispose(),s&&s.dispose()}));e.children.length;){let t=e.children[0];e.remove(t)}}}takeScreenShot(t){let e;try{let i="image/png",s="image/octet-stream";this.render(),e=this.renderer.domElement.toDataURL(i);let o=e.replace(i,s);t+=".png";let n=document.createElement("a");n.style.display="none",document.body.appendChild(n),n.download=t,n.href=o,n.click(),document.body.removeChild(n)}catch(t){return void console.log(t)}}webglAvailable(){let t=window;try{let e=document.createElement("canvas");return!(!t.WebGLRenderingContext||!e.getContext("webgl")&&!e.getContext("experimental-webgl"))}catch(t){return!1}}setupRenderer(){this.renderer=new s.WebGLRenderer({alpha:!0,antialias:!0}),this.renderer.shadowMap.enabled=!1,this.renderer.shadowMap.type=s.PCFSoftShadowMap,this.renderer.setSize(this.rootElement.clientWidth,this.rootElement.clientHeight),this.renderer.setClearColor(this.options.renderer.background.color,this.options.renderer.background.opacity),this.rootElement.appendChild(this.renderer.domElement),this.renderer.autoClear=!1}setBackgroundColor(t,e){this.renderer.setClearColor(t,e)}setupCamera(){let t=this.rootElement.clientWidth/this.rootElement.clientHeight,e=this.cameraWidth,i=e/t;this.camera=new s.OrthographicCamera(e/-2,e/2,i/2,i/-2,-100,1e3),this.camera.name="camera",this.camera.position.z=20}setupRootElement(){this.rootElement=document.createElement("div"),this.rootElement.style.width="100%",this.rootElement.style.height="100%",this.rootElement.style.position="relative"}changeHostElement(t,e=!0,i=!0){if(void 0!==t){if(this.hostElement)for(;this.hostElement.firstChild;)this.hostElement.removeChild(this.hostElement.firstChild);t.appendChild(this.rootElement),this.resizeCanvasToHostElement(),e&&this.fitToCanvas(),i&&this.render()}}saveReset(){this.controls.saveReset()}reset(){this.controls.reset()}setupControls(){let t=new p(this.camera,this.rootElement);t.rotateSpeed=this.options.controls.rotateSpeed,t.rotationCenter=new s.Vector3,t.zoomSpeed=this.options.controls.zoomSpeed,t.panSpeed=this.options.controls.panSpeed,t.enableZoom=this.options.controls.enableZoom,t.enablePan=this.options.controls.enablePan,t.enableRotate=this.options.controls.enableRotate,t.staticMoving=!0,t.dynamicDampingFactor=.25,t.keys=[65,83,68],t.addEventListener("change",this.render.bind(this)),this.controls=t}createCornerPoints(t,e){const i=new s.Geometry;i.vertices.push(t);const o=t.clone().add(e[0]).add(e[1]).add(e[2]);i.vertices.push(o);for(let s=e.length,n=0;n<s;++n){const s=t.clone().add(e[n].clone());i.vertices.push(s);const r=o.clone().sub(e[n].clone());i.vertices.push(r)}return i}fitToCanvas(){const{points:t,margin:e}=this.getCornerPoints();this.scenes.forEach(t=>t.updateMatrixWorld());const i=this.rootElement,o=i.clientWidth,n=i.clientHeight,r=[],a=t.length;this.camera.zoom=this.options.controls.zoomLevel,this.camera.updateProjectionMatrix();const h=this.options.view.fitMargin+e,l=new s.Vector3(0,0,0);l.project(this.camera),l.x=Math.round((l.x+1)*o/2),l.y=Math.round((1-l.y)*n/2),l.z=0;const c=new s.Vector3(h,h,0);c.project(this.camera),c.x=Math.round((c.x+1)*o/2),c.y=Math.round((1-c.y)*n/2),c.sub(l),c.x=Math.abs(c.x),c.y=Math.abs(c.y),c.z=0;for(let e=0;e<a;++e){const i=t[e].clone();i.project(this.camera),i.x=Math.round((i.x+1)*o/2),i.y=Math.round((1-i.y)*n/2),i.z=0,r.push(i)}let u=r[0].x,d=r[0].x,p=r[0].y,f=r[0].y;for(let t=r.length,e=0;e<t;++e){const t=r[e],i=t.x,s=t.y;i>d?d=i:i<u&&(u=i),s>f?f=s:s<p&&(p=s)}u-=c.x,d+=c.x,p-=c.y,f+=c.y;const v=o/2,m=n/2,b=v/Math.abs(d-v),g=v/Math.abs(u-v),w=m/Math.abs(p-m),y=m/Math.abs(f-m),C=Math.min(b,g,w,y);this.camera.zoom=C,this.camera.updateProjectionMatrix()}getZoom(){return this.camera.zoom}setZoom(t){this.camera.zoom=t,this.camera.updateProjectionMatrix()}resizeCanvasToHostElement(){let t=this.rootElement.clientWidth/this.rootElement.clientHeight,e=this.cameraWidth,i=e/t;this.camera.left=-e/2,this.camera.right=e/2,this.camera.top=i/2,this.camera.bottom=-i/2,this.camera.updateProjectionMatrix(),this.renderer.setSize(this.rootElement.clientWidth,this.rootElement.clientHeight),this.controls.handleResize(),this.render()}onWindowResize(){this.resizeCanvasToHostElement(),this.options.view.autoFit&&this.fitToCanvas(),this.render()}render(){this.renderer.clear();for(let t=0;t<this.scenes.length;++t){let e=this.scenes[t];this.renderer.render(e,this.camera),t!==this.scenes.length-1&&this.renderer.clearDepth()}}createCylinder(t,e,i,o,n){var r=(new s.Vector3).subVectors(e,t);let a=r.length(),h=r.clone().divideScalar(a);var l=new s.ArrowHelper(h,t),c=new s.CylinderGeometry(i,i,a,o,0),u=new s.Mesh(c,n);return u.rotation.copy(l.rotation.clone()),u.position.copy((new s.Vector3).addVectors(t,r.multiplyScalar(.5))),u}createLabel(t,e,i,o,n,r,a=0,h="#000"){const l=document.createElement("canvas");l.width=256,l.height=256;const c=l.getContext("2d");c.fillStyle=i,c.font="230.4px "+o,c.textAlign="center",c.textBaseline="middle",a>0&&(c.lineWidth=256*a,c.strokeStyle=h,c.strokeText(e,128,128)),c.fillText(e,128,128);const u=new s.Texture(l);u.needsUpdate=!0;const d=new s.SpriteMaterial({map:u}),p=new s.Sprite(d);p.scale.set(n,n,1),void 0===r&&(r=new s.Vector2(0,0));const f=new s.Vector2;f.addVectors(r,new s.Vector2(.5,.5)),p.center.copy(f);const v=new s.Object3D;return v.position.copy(t),v.add(p),v}rotateAroundWorldAxis(t,e,i){const o=new s.Matrix4;o.makeRotationAxis(e.normalize(),i),o.multiply(t.matrix),t.matrix=o,t.rotation.setFromRotationMatrix(t.matrix)}coordinateTransform(t,e,i,s=!0){return(s?i.clone():i).applyMatrix3(t).applyMatrix3(e)}alignView(t,e,i,o=!0){if(void 0===t)return;if(t.length>2)throw"At most two alignments can be performed.";const n=[],r=t=>{const o=t[0],r=t[1];let a;switch(o){case"up":a=new s.Vector3(0,1,0);break;case"down":a=new s.Vector3(0,-1,0);break;case"right":a=new s.Vector3(1,0,0);break;case"left":a=new s.Vector3(-1,0,0);break;case"front":a=new s.Vector3(0,0,1);break;case"back":a=new s.Vector3(0,0,-1)}const h=e[r];for(const t of n)h[t]=0;if(h.length()>1e-8){const t=(new s.Quaternion).setFromUnitVectors(h.clone().normalize(),a);for(const i in e)e[i].applyQuaternion(t);for(const e of i)e.applyQuaternion(t),e.updateMatrixWorld();"right"==o||"left"==o?n.push("x"):"up"==o||"down"==o?n.push("y"):"front"!=o&&"back"!=o||n.push("z")}};for(const e of t)r(e);o&&this.render()}}class v extends f{constructor(){super(...arguments),this.updateBonds=!1,this.atomicRadii=[],this.elementColors=[],this.lights=[],this.bondFills=[],this.atomFills=[],this.atomOutlines=[],this.axisLabels=[],this.elementNames=["H","He","Li","Be","B","C","N","O","F","Ne","Na","Mg","Al","Si","P","S","Cl","Ar","K","Ca","Sc","Ti","V","Cr","Mn","Fe","Co","Ni","Cu","Zn","Ga","Ge","As","Se","Br","Kr","Rb","Sr","Y","Zr","Nb","Mo","Tc","Ru","Rh","Pd","Ag","Cd","In","Sn","Sb","Te","I","Xe","Cs","Ba","La","Ce","Pr","Nd","Pm","Sm","Eu","Gd","Tb","Dy","Ho","Er","Tm","Yb","Lu","Hf","Ta","W","Re","Os","Ir","Pt","Au","Hg","Tl","Pb","Bi","Po","At","Rn","Fr","Ra","Ac","Th","Pa","U","Np","Pu","Am","Cm","Bk","Cf","Es","Fm","Md","No","Lr","Rf","Ha","Sg","Ns","Hs","Mt","Ds","Rg","Cn","Nh","Fl","Mc","Lv","Ts","Og"],this.elementNumbers={H:1,He:2,Li:3,Be:4,B:5,C:6,N:7,O:8,F:9,Ne:10,Na:11,Mg:12,Al:13,Si:14,P:15,S:16,Cl:17,Ar:18,K:19,Ca:20,Sc:21,Ti:22,V:23,Cr:24,Mn:25,Fe:26,Co:27,Ni:28,Cu:29,Zn:30,Ga:31,Ge:32,As:33,Se:34,Br:35,Kr:36,Rb:37,Sr:38,Y:39,Zr:40,Nb:41,Mo:42,Tc:43,Ru:44,Rh:45,Pd:46,Ag:47,Cd:48,In:49,Sn:50,Sb:51,Te:52,I:53,Xe:54,Cs:55,Ba:56,La:57,Ce:58,Pr:59,Nd:60,Pm:61,Sm:62,Eu:63,Gd:64,Tb:65,Dy:66,Ho:67,Er:68,Tm:69,Yb:70,Lu:71,Hf:72,Ta:73,W:74,Re:75,Os:76,Ir:77,Pt:78,Au:79,Hg:80,Tl:81,Pb:82,Bi:83,Po:84,At:85,Rn:86,Fr:87,Ra:88,Ac:89,Th:90,Pa:91,U:92,Np:93,Pu:94,Am:95,Cm:96,Bk:97,Cf:98,Es:99,Fm:100,Md:101,No:102,Lr:103},this.missing=.2,this.covalentRadii=[this.missing,.31,.28,1.28,.96,.84,.76,.71,.66,.57,.58,1.66,1.41,1.21,1.11,1.07,1.05,1.02,1.06,2.03,1.76,1.7,1.6,1.53,1.39,1.39,1.32,1.26,1.24,1.32,1.22,1.22,1.2,1.19,1.2,1.2,1.16,2.2,1.95,1.9,1.75,1.64,1.54,1.47,1.46,1.42,1.39,1.45,1.44,1.42,1.39,1.39,1.38,1.39,1.4,2.44,2.15,2.07,2.04,2.03,2.01,1.99,1.98,1.98,1.96,1.94,1.92,1.92,1.89,1.9,1.87,1.87,1.75,1.7,1.62,1.51,1.44,1.41,1.36,1.36,1.32,1.45,1.46,1.48,1.4,1.5,1.5,2.6,2.21,2.15,2.06,2,1.96,1.9,1.87,1.8,1.69,this.missing,this.missing,this.missing,this.missing,this.missing,this.missing,this.missing],this.jmolColors=["#ff0000","#ffffff","#d9ffff","#cc80ff","#c2ff00","#ffb5b5","#909090","#3050f8","#ff0d0d","#90e050","#b3e3f5","#ab5cf2","#8aff00","#bfa6a6","#f0c8a0","#ff8000","#ffff30","#1ff01f","#80d1e3","#8f40d4","#3dff00","#e6e6e6","#bfc2c7","#a6a6ab","#8a99c7","#9c7ac7","#e06633","#f090a0","#50d050","#c88033","#7d80b0","#c28f8f","#668f8f","#bd80e3","#ffa100","#a62929","#5cb8d1","#702eb0","#00ff00","#94ffff","#94e0e0","#73c2c9","#54b5b5","#3b9e9e","#248f8f","#0a7d8c","#006985","#c0c0c0","#ffd98f","#a67573","#668080","#9e63b5","#d47a00","#940094","#429eb0","#57178f","#00c900","#70d4ff","#ffffc7","#d9ffc7","#c7ffc7","#a3ffc7","#8fffc7","#61ffc7","#45ffc7","#30ffc7","#1fffc7","#00ff9c","#00e675","#00d452","#00bf38","#00ab24","#4dc2ff","#4da6ff","#2194d6","#267dab","#266696","#175487","#d0d0e0","#ffd123","#b8b8d0","#a6544d","#575961","#9e4fb5","#ab5c00","#754f45","#428296","#420066","#007d00","#70abfa","#00baff","#00a1ff","#008fff","#0080ff","#006bff","#545cf2","#785ce3","#8a4fe3","#a136d4","#b31fd4","#b31fba","#b30da6","#bd0d87","#c70066","#cc0059","#d1004f","#d90045","#e00038","#e6002e","#eb0026"]}setupScenes(){this.scenes=[],this.sceneStructure=new s.Scene,this.scenes.push(this.sceneStructure),this.sceneInfo=new s.Scene,this.scenes.push(this.sceneInfo)}setOptions(t,e=!0,i=!0){var s,o,n,r,a,h,l,c;const u={view:{fitMargin:.5},layout:{periodicity:"none",translation:[0,0,0],viewCenter:"COP",wrapTolerance:.05},outline:{enabled:!0,color:"#000000",size:.025},cell:{enabled:!0,color:"#000000",linewidth:1.5,dashSize:0,gapSize:0},latticeConstants:{enabled:!0,font:"Arial",size:.7,stroke:{width:.06,color:"#000"},a:{enabled:!0,color:"#C52929",label:"a"},b:{enabled:!0,color:"#47A823",label:"b"},c:{enabled:!0,color:"#3B5796",label:"c"},alpha:{enabled:!0,color:"#ffffff",label:""},beta:{enabled:!0,color:"#ffffff",label:""},gamma:{enabled:!0,color:"#ffffff",label:""}},bonds:{enabled:!0,material:{phong:{shininess:30}},color:"#ffffff",radius:.08,threshold:1,smoothness:145},atoms:{material:{phong:{shininess:30}},colors:"Jmol",radii:"covalent",scale:1,smoothness:165}};0===Object.keys(this.options).length?(this.fillOptions(t,u),super.setOptions(u)):(this.fillOptions(t,this.options),super.setOptions(this.options),i&&(this.needFullReload(t)&&void 0!==this.structure?this.load(this.structure):(void 0!==(null===(s=null==t?void 0:t.latticeConstants)||void 0===s?void 0:s.enabled)&&this.toggleLatticeConstants(t.latticeConstants.enabled),void 0!==(null===(o=null==t?void 0:t.cell)||void 0===o?void 0:o.enabled)&&this.toggleCell(t.cell.enabled),void 0!==(null===(n=null==t?void 0:t.bonds)||void 0===n?void 0:n.enabled)&&this.toggleBonds(t.bonds.enabled),void 0!==(null===(a=null===(r=null==t?void 0:t.renderer)||void 0===r?void 0:r.shadows)||void 0===a?void 0:a.enabled)&&this.toggleShadows(t.renderer.shadows.enabled))),void 0!==(null===(h=null==t?void 0:t.renderer)||void 0===h?void 0:h.background)&&this.setBackgroundColor(null===(l=null==t?void 0:t.renderer)||void 0===l?void 0:l.background.color,null===(c=null==t?void 0:t.renderer)||void 0===c?void 0:c.background.opacity),e&&this.render())}needFullReload(t){return function t(e,i){for(var s in e)if(null!==e[s]&&"[object Object]"===Object.prototype.toString.call(e[s])){if(void 0===i[s])return!0;if(t(e[s],i[s]))return!0}else if(void 0===i[s])return!0;return!1}(t,{cell:{enabled:!0},latticeConstants:{enabled:!0},bonds:{enabled:!0},shadows:{enabled:!0}})}getOptions(){return this.options}getElementInfo(){return this.elements}toggleLatticeConstants(t){void 0!==this.latticeConstants&&(this.latticeConstants.visible=t,this.angleArcs.visible=t)}toggleCell(t){void 0!==this.convCell&&(this.convCell.visible=t),void 0!==this.primCell&&(this.primCell.visible=t)}toggleBonds(t){t&&this.createBonds(),void 0!==this.bonds&&(this.bonds.visible=t)}toggleShadows(t){var e,i,s;this.renderer.shadowMap.enabled=t;for(let e=0;e<this.lights.length;++e){this.lights[e].castShadow=t}for(let e=0;e<this.atomFills.length;++e){let i=this.atomFills[e];i.receiveShadow=t,i.castShadow=t,i.material.needsUpdate=!0}for(let o=0;o<this.bondFills.length;++o){let n=this.bondFills[o];n.receiveShadow=t,void 0!==(null===(s=null===(i=null===(e=this.options)||void 0===e?void 0:e.atoms)||void 0===i?void 0:i.material)||void 0===s?void 0:s.toon)?n.castShadow=!1:n.castShadow=t,n.material.needsUpdate=!0}this.render(),this.render()}clear(){super.clear(),this.structure=void 0,this.atoms=void 0,this.convCell=void 0,this.primCell=void 0,this.bonds=void 0,this.atomPos=void 0,this.atomNumbers=void 0,this.latticeConstants=void 0,this.B=void 0,this.Bi=void 0,this.basisVectors=void 0,this.elements=void 0,this.maxRadii=void 0,this.atomicRadii=void 0,this.elementColors=void 0}load(t){var e,i,o,n,r,a;this.clear(),this.setup(),this.structure=t,this.setupScenes(),this.setupLights(),this.setupCamera(),this.setupControls(),"covalent"===this.options.atoms.radii?this.atomicRadii=this.covalentRadii:Array.isArray(this.options.atoms.radii)&&(this.atomicRadii=this.options.atoms.radii),"Jmol"===this.options.atoms.colors?this.elementColors=this.jmolColors:Array.isArray(this.options.atoms.colors)&&(this.elementColors=this.options.atoms.colors);const h=void 0!==t.fractional&&t.fractional,l=t.positions,c=t.species,u=t.cell;let d=t.pbc,p=t.bonds;if(!l)return console.log("No atom positions given to the structure viewer"),!1;if(!c)return console.log("No species  given to the structure viewer."),!1;const f="number"==typeof c[0]?c:c.map(t=>this.elementNumbers[t]);if(this.maxRadii=Math.max(...f.map(t=>this.atomicRadii[t])),p){if(!Array.isArray(p))return console.log("Invalid value for 'bonds'. Provide a list of index pairs."),!1}else p="auto";if(l.length!=f.length)return console.log("The number of positions does not match the number of labels."),!1;null!=d&&null!=d||(d=[!1,!1,!1]),this.root=new s.Object3D,this.container=new s.Object3D,this.infoContainer=new s.Object3D,this.atoms=new s.Object3D,this.bonds=new s.Object3D,this.container.add(this.atoms),this.container.add(this.bonds),this.angleArcs=new s.Object3D,this.root.add(this.container),this.sceneStructure.add(this.root),this.sceneInfo.add(this.infoContainer),this.latticeConstants=new s.Object3D,this.container.add(this.latticeConstants),this.createBasisVectors(u);let v=[],m=[];!0===h?(v=this.toVectors(l),m=this.toCartesian(v,!0)):!1===h&&(m=this.toVectors(l),void 0!==this.B&&(v=this.toScaled(m,!0)));let b=0,g=[],w=d[0],y=d[1],C=d[2];if(w&&y&&C)b=3;else if(w||y||C)for(let t=0;t<3;++t){let e=d[t],i=d[(t+1)%3],s=d[(t+2)%3];if(e&&!i&&!s){b=1,g.push(t);break}if(e&&i&&!s){b=2,g.push(t),g.push((t+1)%3);break}}else b=0;void 0!==this.B?(this.createConventionalCell(d,this.options.cell.enabled),this.createLatticeConstants(this.basisVectors,d,g),this.createAtoms(v,f,d,!0)):this.createAtoms(m,f,d,!1);let x=this.getPositions();this.createBonds(p);let V,A=this.options.layout.viewCenter;return"COP"===A?V=this.calculateCOP(x):"COC"===A?V=(new s.Vector3).add(this.basisVectors[0]).add(this.basisVectors[1]).add(this.basisVectors[2]).multiplyScalar(.5):Array.isArray(A)&&(V=(new s.Vector3).fromArray(A)),this.setViewCenter(V),this.translate(this.options.layout.translation),this.setZoom(this.options.controls.zoomLevel),void 0!==this.B&&this.alignView(null===(o=null===(i=null===(e=this.options)||void 0===e?void 0:e.layout)||void 0===i?void 0:i.viewRotation)||void 0===o?void 0:o.alignments),this.rotateView(null===(a=null===(r=null===(n=this.options)||void 0===n?void 0:n.layout)||void 0===r?void 0:r.viewRotation)||void 0===a?void 0:a.rotations),this.options.view.autoFit&&this.fitToCanvas(),this.toggleShadows(this.options.renderer.shadows.enabled),this.render(),!0}calculateCOP(t){let e=t.length,i=new s.Vector3;for(let s=0;s<e;++s){let e=t[s];i.add(e)}return i.divideScalar(e),i}setViewCenter(t){this.container.position.sub(t),this.infoContainer.position.sub(t),this.render()}translate(t){const e=(new s.Vector3).fromArray(t);this.atoms.position.add(e),this.bonds.position.add(e),this.render()}setPositions(t,e=!1,i=!0){if("none"!==this.options.layout.periodicity&&"wrap"!==this.options.layout.periodicity)throw"Setting new positions is not allowed when options.layout.periodicity != 'none'/'wrap'.";const s=this.toVectors(t);"wrap"===this.options.layout.periodicity&&this.wrap(s,e),e&&this.toCartesian(s,!1);for(let t=0,e=s.length;t<e;++t){const e=s[t];this.getAtom(t).position.copy(e)}this.updateBonds=!0,this.createBonds(),i&&this.render()}getPositions(t=!1){let e=[],i=this.atoms.children,s=i.length;if(t){let t=[];for(let e=0;e<s;++e){let s=i[e].position.clone();t.push(s)}e=this.toScaled(t)}else for(let t=0;t<s;++t){let s=i[t].position.clone();e.push(s)}return e}toVectors(t,e=!0){const i=[];for(let e=0,o=t.length;e<o;++e)i.push((new s.Vector3).fromArray(t[e]));if(e)return i;t=i}toCartesian(t,e=!0){if(e){const e=[];for(let i=0,s=t.length;i<s;++i)e.push(t[i].clone().applyMatrix3(this.B));return e}for(let e=0,i=t.length;e<i;++e)t[e].applyMatrix3(this.B)}toScaled(t,e=!0){if(e){const e=[];for(let i=0,s=t.length;i<s;++i)e.push(t[i].clone().applyMatrix3(this.Bi));return e}for(let e=0,i=t.length;e<i;++e)t[e].applyMatrix3(this.Bi)}getAtom(t){return this.atoms.getObjectByName("atom"+t)}setZoom(t){this.camera.zoom=t,this.render()}setupLights(){var t,e,i,o,n,r;this.lights=[];let a=new s.DirectionalLight(16777215,.45);a.shadow.mapSize.width=2048,a.shadow.mapSize.height=2048,a.shadow.bias=-.001,a.shadow.camera.left=-50,a.shadow.camera.right=50,a.shadow.camera.top=50,a.shadow.camera.bottom=-50,a.position.set(0,0,20),this.sceneStructure.add(a),this.lights.push(a);let h=new s.DirectionalLight(16777215,.3);h.shadow.mapSize.width=2048,h.shadow.mapSize.height=2048,h.shadow.bias=-.001,h.position.set(-20,0,-20),void 0===(null===(i=null===(e=null===(t=this.options)||void 0===t?void 0:t.atoms)||void 0===e?void 0:e.material)||void 0===i?void 0:i.toon)&&(this.sceneStructure.add(h),this.lights.push(h));let l=new s.DirectionalLight(16777215,.25);l.shadow.mapSize.width=2048,l.shadow.mapSize.height=2048,l.shadow.bias=-.001,l.position.set(20,0,-20),void 0===(null===(r=null===(n=null===(o=this.options)||void 0===o?void 0:o.atoms)||void 0===n?void 0:n.material)||void 0===r?void 0:r.toon)&&(this.sceneStructure.add(l),this.lights.push(l));let c=new s.AmbientLight(4210752,1.7);this.sceneStructure.add(c)}createLatticeConstants(t,e,i){var o,n,r,a,h,l,c,u,d,p,f,v,m,b,g,w,y,C,x,V,A,M,_,S;if(!this.options.latticeConstants.enabled)return;this.axisLabels=[],this.infoContainer.add(this.latticeConstants),this.infoContainer.add(this.angleArcs);new s.LineBasicMaterial({color:"#000000",linewidth:1.5});let k=-1,z=[];z.push(this.options.latticeConstants.a.color),z.push(this.options.latticeConstants.b.color),z.push(this.options.latticeConstants.c.color);const E=[];E.push(this.options.latticeConstants.alpha.color),E.push(this.options.latticeConstants.beta.color),E.push(this.options.latticeConstants.gamma.color);const P=[];P.push(void 0===(null===(n=null===(o=this.options.latticeConstants.alpha)||void 0===o?void 0:o.stroke)||void 0===n?void 0:n.color)?this.options.latticeConstants.stroke.color:this.options.latticeConstants.alpha.stroke.color),P.push(void 0===(null===(a=null===(r=this.options.latticeConstants.beta)||void 0===r?void 0:r.stroke)||void 0===a?void 0:a.color)?this.options.latticeConstants.stroke.color:this.options.latticeConstants.beta.stroke.color),P.push(void 0===(null===(l=null===(h=this.options.latticeConstants.gamma)||void 0===h?void 0:h.stroke)||void 0===l?void 0:l.color)?this.options.latticeConstants.stroke.color:this.options.latticeConstants.gamma.stroke.color);const j=[];j.push(void 0===(null===(u=null===(c=this.options.latticeConstants.alpha)||void 0===c?void 0:c.stroke)||void 0===u?void 0:u.width)?this.options.latticeConstants.stroke.width:this.options.latticeConstants.alpha.stroke.width),j.push(void 0===(null===(p=null===(d=this.options.latticeConstants.beta)||void 0===d?void 0:d.stroke)||void 0===p?void 0:p.width)?this.options.latticeConstants.stroke.width:this.options.latticeConstants.beta.stroke.width),j.push(void 0===(null===(v=null===(f=this.options.latticeConstants.gamma)||void 0===f?void 0:f.stroke)||void 0===v?void 0:v.width)?this.options.latticeConstants.stroke.width:this.options.latticeConstants.gamma.stroke.width);let L=[this.options.latticeConstants.gamma.label,this.options.latticeConstants.alpha.label,this.options.latticeConstants.beta.label],O=[this.options.latticeConstants.a.label,this.options.latticeConstants.b.label,this.options.latticeConstants.c.label],F=[this.options.latticeConstants.gamma.enabled,this.options.latticeConstants.alpha.enabled,this.options.latticeConstants.beta.enabled],T=[this.options.latticeConstants.a.enabled,this.options.latticeConstants.b.enabled,this.options.latticeConstants.c.enabled],B=[];B.push(void 0===this.options.latticeConstants.a.font?this.options.latticeConstants.font:this.options.latticeConstants.a.font),B.push(void 0===this.options.latticeConstants.b.font?this.options.latticeConstants.font:this.options.latticeConstants.b.font),B.push(void 0===this.options.latticeConstants.c.font?this.options.latticeConstants.font:this.options.latticeConstants.c.font);const D=[];D.push(void 0===this.options.latticeConstants.a.size?this.options.latticeConstants.size:this.options.latticeConstants.a.size),D.push(void 0===this.options.latticeConstants.b.size?this.options.latticeConstants.size:this.options.latticeConstants.b.size),D.push(void 0===this.options.latticeConstants.c.size?this.options.latticeConstants.size:this.options.latticeConstants.c.size);const R=[];R.push(void 0===(null===(b=null===(m=this.options.latticeConstants.a)||void 0===m?void 0:m.stroke)||void 0===b?void 0:b.color)?this.options.latticeConstants.stroke.color:this.options.latticeConstants.a.stroke.color),R.push(void 0===(null===(w=null===(g=this.options.latticeConstants.b)||void 0===g?void 0:g.stroke)||void 0===w?void 0:w.color)?this.options.latticeConstants.stroke.color:this.options.latticeConstants.b.stroke.color),R.push(void 0===(null===(C=null===(y=this.options.latticeConstants.c)||void 0===y?void 0:y.stroke)||void 0===C?void 0:C.color)?this.options.latticeConstants.stroke.color:this.options.latticeConstants.c.stroke.color);const W=[];W.push(void 0===(null===(V=null===(x=this.options.latticeConstants.a)||void 0===x?void 0:x.stroke)||void 0===V?void 0:V.width)?this.options.latticeConstants.stroke.width:this.options.latticeConstants.a.stroke.width),W.push(void 0===(null===(M=null===(A=this.options.latticeConstants.b)||void 0===A?void 0:A.stroke)||void 0===M?void 0:M.width)?this.options.latticeConstants.stroke.width:this.options.latticeConstants.b.stroke.width),W.push(void 0===(null===(S=null===(_=this.options.latticeConstants.c)||void 0===_?void 0:_.stroke)||void 0===S?void 0:S.width)?this.options.latticeConstants.stroke.width:this.options.latticeConstants.c.stroke.width);const N=[];N.push(void 0===this.options.latticeConstants.alpha.font?this.options.latticeConstants.font:this.options.latticeConstants.alpha.font),N.push(void 0===this.options.latticeConstants.beta.font?this.options.latticeConstants.font:this.options.latticeConstants.beta.font),N.push(void 0===this.options.latticeConstants.gamma.font?this.options.latticeConstants.font:this.options.latticeConstants.gamma.font);const H=[];H.push(void 0===this.options.latticeConstants.alpha.size?this.options.latticeConstants.size:this.options.latticeConstants.alpha.size),H.push(void 0===this.options.latticeConstants.beta.size?this.options.latticeConstants.size:this.options.latticeConstants.beta.size),H.push(void 0===this.options.latticeConstants.gamma.size?this.options.latticeConstants.size:this.options.latticeConstants.gamma.size);for(let e=0;e<3;++e){k+=1;let i=O[k],o=z[k],n=B[k],r=D[k],a=H[k],h=W[k],l=R[k],c=N[k],u=E[k],d=L[k],p=P[k],f=j[k],v=T[k],m=F[k],b=t[e],g=t[(e+1)%3].clone(),w=t[(e+2)%3].clone();if(v){let t,a,c,u=new s.Vector3(0,0,0),d=b.clone(),p=d.clone().multiplyScalar(.5);if(0==g.length())a=(new s.Vector3).crossVectors(b,w),t=(new s.Vector3).crossVectors(b,a);else if(0==w.length())c=(new s.Vector3).crossVectors(b,g),t=(new s.Vector3).crossVectors(b,w);else{let e=(new s.Vector3).crossVectors(b,g),i=(new s.Vector3).crossVectors(b,w);t=(new s.Vector3).sub(e).add(i)}t.normalize(),t.multiplyScalar(.8),p.add(t);let f=this.createLabel(p,i,o,n,r,new s.Vector2(0,0),h,l);this.latticeConstants.add(f),this.axisLabels.push(f);let v=new s.MeshBasicMaterial({color:o,transparent:!0,opacity:.75}),m=b.clone(),y=this.createCylinder(u.clone(),m.clone().add(u),.09,10,v);this.latticeConstants.add(y);let C=new s.MeshBasicMaterial({color:"#000000"}),x=this.basisVectors[e].clone(),V=x.clone().multiplyScalar(1+1.3/x.length()),A=(b.clone(),this.createCylinder(u.clone(),V,.02,10,C));this.latticeConstants.add(A);let M=new s.CylinderGeometry(0,.1,.5,12),_=new s.MeshBasicMaterial({color:0}),S=new s.Mesh(M,_);S.position.copy(d).multiplyScalar(1+1.3/d.length()),S.lookAt(new s.Vector3),S.rotateX(-Math.PI/2),this.latticeConstants.add(S)}if(m){let t=new s.LineDashedMaterial({color:0,linewidth:2,dashSize:.2,gapSize:.1}),e=(new s.Vector3).crossVectors(b,g),i=b.angleTo(g),o=Math.max(Math.min(1/4*b.length(),1/4*g.length()),1),n=new s.EllipseCurve(0,0,o,o,0,i,!1,0).getSpacedPoints(20),r=(new s.Geometry).setFromPoints(n),h=new s.Line(r,t);h.computeLineDistances();new s.Vector3(0,1,0);let l=new s.Vector3(1,0,0),v=(new s.Vector3(0,0,1),(new s.Quaternion).setFromUnitVectors(l,b.clone().normalize()));h.quaternion.copy(v);let m=r.vertices[r.vertices.length-1];h.updateMatrixWorld();let w=h.localToWorld(m.clone()),y=b,C=(new s.Vector3).crossVectors(y,w),x=e.angleTo(C);(new s.Vector3).crossVectors(g,w).dot(y)>0&&(x=-x),h.rotateX(x),h.updateMatrixWorld(),h.updateMatrix();let V=h.localToWorld(r.vertices[9].clone()),A=V.length();V.multiplyScalar(1+.3/A);let M=this.createLabel(V,d.toString(),u,c,a,new s.Vector2(0,0),f,p);this.latticeConstants.add(M),this.axisLabels.push(M),this.angleArcs.add(h)}}}createBasisVectors(t){if(void 0===t)return this.basisVectors=void 0,this.B=void 0,void(this.Bi=void 0);const e=(new s.Vector3).fromArray(t[0]),i=(new s.Vector3).fromArray(t[1]),o=(new s.Vector3).fromArray(t[2]);this.basisVectors=[e,i,o];const n=new s.Matrix3;n.set(e.x,i.x,o.x,e.y,i.y,o.y,e.z,i.z,o.z),this.B=n,this.Bi=(new s.Matrix3).getInverse(n)}getCornerPoints(){this.atoms.updateMatrixWorld();const t=this.atoms.children,e=t.length,i=[];for(let o=0;o<e;++o){const e=t[o],n=new s.Vector3;e.getWorldPosition(n),i.push(n)}return{points:i,margin:this.maxRadii}}createConventionalCell(t,e){const i=this.createCell(new s.Vector3,this.basisVectors,t,this.options.cell.color,this.options.cell.linewidth,this.options.cell.dashSize,this.options.cell.gapSize);i.visible=e,this.convCell=i,this.container.add(this.convCell)}createCell(t,e,i,o,n,r,a){let h,l=new s.Object3D;h=0!==r||0!==a?new s.LineDashedMaterial({color:o,linewidth:n,dashSize:r,gapSize:a}):new s.LineBasicMaterial({color:o,linewidth:n});let c=!0;for(let t=0;t<3;++t){e[t].length()>.001&&!i[t]&&(c=!1)}for(let o=e.length,n=0;n<o;++n){let r=e[n].clone(),a=h.clone();if(!!i[n]||!c){let e=new s.Geometry;e.vertices.push(t.clone(),r.clone().add(t));let i=new s.Line(e,a);l.add(i),i.computeLineDistances()}let u=e[(n+1)%o].clone();if(!(!i[n]||!i[(n+1)%3])||!c){let e=h.clone(),i=new s.Geometry;i.vertices.push(u.clone().add(t),r.clone().add(u).add(t));let o=new s.Line(i,e);l.add(o),o.computeLineDistances()}let d=e[(n+2)%o].clone();if(!(!i[n]||!i[(n+2)%3])||!c){let e=h.clone(),i=new s.Geometry;i.vertices.push(d.clone().add(t),r.clone().add(d).add(t));let o=new s.Line(i,e);l.add(o),o.computeLineDistances()}if(!(!i[n]||!i[(n+2)%3]||!i[(n+1)%3])||!c){let e=h.clone(),i=new s.Geometry;i.vertices.push(u.clone().add(d).add(t),r.clone().add(u).add(d).add(t));let o=new s.Line(i,e);l.add(o),o.computeLineDistances()}}return l}rotateView(t,e=!0){if(void 0!==t){for(const e of t){const t=new s.Vector3(e[0],e[1],e[2]);t.normalize();const i=e[3]/180*Math.PI;this.rotateAroundWorldAxis(this.root,t,i),this.rotateAroundWorldAxis(this.sceneInfo,t,i)}e&&this.render()}}alignView(t,e=!0){const i={a:this.basisVectors[0].clone(),"-a":this.basisVectors[0].clone().negate(),b:this.basisVectors[1].clone(),"-b":this.basisVectors[1].clone().negate(),c:this.basisVectors[2].clone(),"-c":this.basisVectors[2].clone().negate()},s=[this.root,this.sceneInfo];super.alignView(t,i,s,e)}repeat(t,e,i){let o=new s.Vector3(1,0,0),n=new s.Vector3(0,1,0),r=new s.Vector3(0,0,1),a=[],h=[];for(let l=0;l<t[0];++l)for(let c=0;c<t[1];++c)for(let u=0;u<t[2];++u)if(0!=l||0!=c||0!=u){let t=o.clone().multiplyScalar(l),d=n.clone().multiplyScalar(c),p=r.clone().multiplyScalar(u);for(let o=0,n=e.length;o<n;++o){let n=(new s.Vector3).copy(e[o]);n.add(t),n.add(d),n.add(p);let r=i[o];a.push(n),h.push(r)}}for(let t=0;t<a.length;++t)e.push(a[t]),i.push(h[t])}wrap(t,e=!0){e||this.toScaled(t,!1);for(let e=t.length,i=0;i<e;++i){const e=t[i];this.structure.pbc[0]&&(e.x=e.x<0?1+e.x%1:e.x%1),this.structure.pbc[1]&&(e.y=e.y<0?1+e.y%1:e.y%1),this.structure.pbc[2]&&(e.z=e.z<0?1+e.z%1:e.z%1)}e||this.toCartesian(t,!1)}addBoundaryAtoms(t,e){for(let i=t.length,o=0;o<i;++o){let i=t[o],n=e[o],r=i.x,a=i.y,h=i.z,l=this.almostEqual(0,r,this.basisVectors[0],this.options.layout.wrapTolerance),c=this.almostEqual(0,a,this.basisVectors[1],this.options.layout.wrapTolerance),u=this.almostEqual(0,h,this.basisVectors[2],this.options.layout.wrapTolerance);l&&c&&u?(t.push(new s.Vector3(1,0,0).add(i)),e.push(n),t.push(new s.Vector3(0,1,0).add(i)),e.push(n),t.push(new s.Vector3(0,0,1).add(i)),e.push(n),t.push(new s.Vector3(1,1,0).add(i)),e.push(n),t.push(new s.Vector3(0,1,1).add(i)),e.push(n),t.push(new s.Vector3(1,0,1).add(i)),e.push(n),t.push(new s.Vector3(1,1,1).add(i)),e.push(n)):l&&c&&!u?(t.push(new s.Vector3(1,0,0).add(i)),e.push(n),t.push(new s.Vector3(0,1,0).add(i)),e.push(n),t.push(new s.Vector3(1,1,0).add(i)),e.push(n)):!l&&c&&u?(t.push(new s.Vector3(0,1,0).add(i)),e.push(n),t.push(new s.Vector3(0,0,1).add(i)),e.push(n),t.push(new s.Vector3(0,1,1).add(i)),e.push(n)):l&&!c&&u?(t.push(new s.Vector3(1,0,0).add(i)),e.push(n),t.push(new s.Vector3(0,0,1).add(i)),e.push(n),t.push(new s.Vector3(1,0,1).add(i)),e.push(n)):!l||c||u?l||!c||u?l||c||!u||(t.push(new s.Vector3(0,0,1).add(i)),e.push(n)):(t.push(new s.Vector3(0,1,0).add(i)),e.push(n)):(t.push(new s.Vector3(1,0,0).add(i)),e.push(n))}}createAtoms(t,e,i,s=!0){if(this.atoms.remove(...this.atoms.children),this.elements={},this.atomNumbers=[],this.atomFills=[],this.atomOutlines=[],i.some(t=>!0===t)){let i=this.options.layout.periodicity;"wrap"===i?this.wrap(t,s):s&&"boundary"===i?this.addBoundaryAtoms(t,e):s&&Array.isArray(i)&&this.repeat(i,t,e)}let o={};for(let i=t.length,n=0;n<i;++n){let i=t[n],r=e[n];this.addAtom(n,i,r,o,s);let a=this.elementNames[r-1];this.elements[a]=[this.elementColors[r],this.atomicRadii[r]]}}createBonds(t="auto"){var e,i,o,n,r,a,h;if(!this.options.bonds.enabled)return;if(!this.updateBonds)return;this.bondFills=[],this.bonds.remove(...this.bonds.children);let l,c=this.getPositions();if(null===(o=null===(i=null===(e=this.options)||void 0===e?void 0:e.bonds)||void 0===i?void 0:i.material)||void 0===o?void 0:o.toon){const t=null===(h=null===(a=null===(r=null===(n=this.options)||void 0===n?void 0:n.bonds)||void 0===r?void 0:r.material)||void 0===a?void 0:a.toon)||void 0===h?void 0:h.tones,e=new Uint8Array(t);for(let i=0;i<=t;i++)e[i]=i/t*256;let i=new s.DataTexture(e,e.length,1,s.LuminanceFormat);i.minFilter=s.NearestFilter,i.magFilter=s.NearestFilter,i.generateMipmaps=!1,l=new s.MeshToonMaterial({color:this.options.bonds.color,gradientMap:i})}else l=new s.MeshPhongMaterial({color:this.options.bonds.color,shininess:this.options.bonds.material.phong.shininess});if(Array.isArray(t))for(let e of t){let t=e[0],i=e[1],s=c[t],o=c[i];this.addBond(t,i,s,o,l)}else if("auto"===t){let t=c.length;for(let e=0;e<t;++e)for(let i=0;i<t;++i)if(i>e){let t=c[e],s=c[i],o=this.atomNumbers[e],n=this.atomNumbers[i],r=s.clone().sub(t).length(),a=this.options.atoms.scale*this.atomicRadii[o],h=this.options.atoms.scale*this.atomicRadii[n];r<=1.1*this.options.bonds.threshold*(a+h)&&this.addBond(e,i,t,s,l)}}this.updateBonds=!1}almostEqual(t,e,i,s){let o=e-t;return Math.abs(i.clone().multiplyScalar(o).length())<s}addBond(t,e,i,o,n){let r=this.options.bonds.radius,a=this.options.bonds.smoothness,h=Math.ceil(360/(180-a)),l=this.createCylinder(i,o,r,h,n);l.name="fill",this.bondFills.push(l);let c=new s.Group;if(c.name="bond"+t+"-"+e,c.add(l),this.options.outline.enabled){let t=this.options.outline.size/r+1,e=new s.MeshBasicMaterial({color:this.options.outline.color,side:s.BackSide}),n=this.createCylinder(i,o,t*r,10,e);n.name="outline",c.add(n)}this.bonds.add(c)}addAtom(t,e,i,o,n=!0){var r,a,h,l,c,u,d;if(!(i in o)){o[i]={};let t,e=this.options.atoms.scale*this.atomicRadii[i],n=this.options.atoms.smoothness,m=Math.ceil(360/(180-n)),b=this.elementColors[i],g=new s.SphereGeometry(e,m,m);if(void 0!==(null===(h=null===(a=null===(r=this.options)||void 0===r?void 0:r.atoms)||void 0===a?void 0:a.material)||void 0===h?void 0:h.toon)){let e=null===(d=null===(u=null===(c=null===(l=this.options)||void 0===l?void 0:l.atoms)||void 0===c?void 0:c.material)||void 0===u?void 0:u.toon)||void 0===d?void 0:d.tones;for(var p=new Uint8Array(e),f=0;f<=e;f++)p[f]=f/e*256;var v=new s.DataTexture(p,p.length,1,s.LuminanceFormat);v.minFilter=s.NearestFilter,v.magFilter=s.NearestFilter,v.generateMipmaps=!1,t=new s.MeshToonMaterial({color:b,gradientMap:v})}else t=new s.MeshPhongMaterial({color:b,shininess:this.options.atoms.material.phong.shininess});let w=new s.Mesh(g,t);if(o[i].atom=w,this.options.outline.enabled){let t=this.options.outline.size/e+1,n=new s.SphereGeometry(e*t,m,m),r=new s.MeshBasicMaterial({color:this.options.outline.color,side:s.BackSide}),a=new s.Mesh(n,r);o[i].outline=a}}let m=o[i],b=new s.Vector3;n?(b.add(this.basisVectors[0].clone().multiplyScalar(e.x)),b.add(this.basisVectors[1].clone().multiplyScalar(e.y)),b.add(this.basisVectors[2].clone().multiplyScalar(e.z))):b.copy(e);let g=new s.Group;g.name="atom"+t;let w=m.atom.clone();if(w.name="fill",g.add(w),this.options.outline.enabled){let t=m.outline.clone();this.atomOutlines.push(t),t.name="outline",g.add(t)}g.position.copy(b),this.atoms.add(g),this.atomFills.push(w),this.atomNumbers.push(i),this.updateBonds=!0}render(){let t=this.rootElement,e=t.clientWidth,i=t.clientHeight,o=new s.Vector3(1,0,0),n=new s.Vector3(0,0,0),r=[o,n];for(let t=0;t<r.length;++t){let s=r[t];this.camera.localToWorld(s),s.project(this.camera),s.x=Math.round((s.x+1)*e/2),s.y=Math.round((1-s.y)*i/2)}let a=(new s.Vector3).subVectors(n,o).length(),h=8/Math.pow(a,.5);if(void 0!==this.axisLabels)for(let t=0;t<this.axisLabels.length;++t){this.axisLabels[t].scale.set(h,h,1)}super.render()}getRepetitions(t,e){let i=t.length();return Math.max(Math.floor(e/i)-1,1)}setup0D(t,e,i){let s=[!1,!1,!1];this.createConventionalCell(s,this.options.cell.enabled),this.createAtoms(t,i,s),this.createLatticeConstants(this.basisVectors,s,[])}setup1D(t,e,i,s,o){let n=o[0],r=this.basisVectors[n].clone(),a=this.getRepetitions(r,15),h=[1,1,1];h[n]=a,this.options.layout.periodicity=h,this.options.cell.enabled&&this.createConventionalCell(s,this.options.cell.enabled),this.createAtoms(t,i,s),this.createLatticeConstants(this.basisVectors,s,o)}setup2D(t,e,i,s,o){let n=o[0],r=o[1],a=this.basisVectors[n].clone(),h=this.basisVectors[r].clone(),l=0,c=0;this.options.layout.allowRepeat&&(l=this.getRepetitions(a,12),c=this.getRepetitions(h,12));let u=[1,1,1];u[n]=l,u[r]=c,this.options.layout.periodicity=u,this.createConventionalCell(s,this.options.cell.enabled),this.createAtoms(t,i,s),this.createLatticeConstants(this.basisVectors,s,o)}setup3D(t,e,i){let s=[!0,!0,!0];this.createConventionalCell(s,this.options.cell.enabled),this.createAtoms(t,i,s),this.createLatticeConstants(this.basisVectors,s,[0,1,2])}}class m{constructor(t,e){this.vertex=null,this.prev=null,this.next=null,this.twin=null,this.face=null,this.vertex=t,this.face=e}head(){return this.vertex}tail(){return this.prev?this.prev.vertex:null}length(){const t=this.head(),e=this.tail();return null!==e?e.point.distanceTo(t.point):-1}lengthSquared(){const t=this.head(),e=this.tail();return null!==e?e.point.distanceToSquared(t.point):-1}setTwin(t){return this.twin=t,t.twin=this,this}}class b{constructor(t,e,i){this.normal=new s.Vector3,this.midpoint=new s.Vector3,this.area=0,this.constant=0,this.outside=null,this.mark=0,this.edge=null;var o=new m(t,this),n=new m(e,this),r=new m(i,this);o.next=r.prev=n,n.next=o.prev=r,r.next=n.prev=o,this.edge=o,this.compute()}getEdge(t){for(var e=this.edge;t>0;)e=e.next,t--;for(;t<0;)e=e.prev,t++;return e}compute(){var t;void 0===t&&(t=new s.Triangle);var e=this.edge.tail(),i=this.edge.head(),o=this.edge.next.head();return t.set(e.point,i.point,o.point),t.getNormal(this.normal),t.getMidpoint(this.midpoint),this.area=t.getArea(),this.constant=this.normal.dot(this.midpoint),this}distanceToPoint(t){return this.normal.dot(t)-this.constant}}const g=function(){var t,e,i,o=new s.Vector3;function n(){this.tolerance=-1,this.faces=[],this.newFaces=[],this.assigned=new a,this.unassigned=new a,this.vertices=[]}function r(t){this.point=t,this.prev=null,this.next=null,this.face=null}function a(){this.head=null,this.tail=null}return Object.assign(n.prototype,{setFromPoints:function(t){!0!==Array.isArray(t)&&console.error("THREE.ConvexHull: Points parameter is not an array."),t.length<4&&console.error("THREE.ConvexHull: The algorithm needs at least four points."),this.makeEmpty();for(var e=0,i=t.length;e<i;e++)this.vertices.push(new r(t[e]));return this.compute(),this},setFromObject:function(t){var e=[];return t.updateMatrixWorld(!0),t.traverse((function(t){var i,o,n,r=t.geometry;if(void 0!==r)if(r.isGeometry){var a=r.vertices;for(i=0,o=a.length;i<o;i++)(n=a[i].clone()).applyMatrix4(t.matrixWorld),e.push(n)}else if(r.isBufferGeometry){var h=r.attributes.position;if(void 0!==h)for(i=0,o=h.count;i<o;i++)(n=new s.Vector3).fromBufferAttribute(h,i).applyMatrix4(t.matrixWorld),e.push(n)}})),this.setFromPoints(e)},containsPoint:function(t){for(var e=this.faces,i=0,s=e.length;i<s;i++){if(e[i].distanceToPoint(t)>this.tolerance)return!1}return!0},intersectRay:function(t,e){for(var i=this.faces,s=-1/0,o=1/0,n=0,r=i.length;n<r;n++){var a=i[n],h=a.distanceToPoint(t.origin),l=a.normal.dot(t.direction);if(h>0&&l>=0)return null;var c=0!==l?-h/l:0;if(!(c<=0)&&(l>0?o=Math.min(c,o):s=Math.max(c,s),s>o))return null}return s!==-1/0?t.at(s,e):t.at(o,e),e},intersectsRay:function(t){return null!==this.intersectRay(t,o)},makeEmpty:function(){return this.faces=[],this.vertices=[],this},addVertexToFace:function(t,e){return t.face=e,null===e.outside?this.assigned.append(t):this.assigned.insertBefore(e.outside,t),e.outside=t,this},removeVertexFromFace:function(t,e){return t===e.outside&&(null!==t.next&&t.next.face===e?e.outside=t.next:e.outside=null),this.assigned.remove(t),this},removeAllVerticesFromFace:function(t){if(null!==t.outside){for(var e=t.outside,i=t.outside;null!==i.next&&i.next.face===t;)i=i.next;return this.assigned.removeSubList(e,i),e.prev=i.next=null,t.outside=null,e}},deleteFaceVertices:function(t,e){var i=this.removeAllVerticesFromFace(t);if(void 0!==i)if(void 0===e)this.unassigned.appendChain(i);else{var s=i;do{var o=s.next;e.distanceToPoint(s.point)>this.tolerance?this.addVertexToFace(s,e):this.unassigned.append(s),s=o}while(null!==s)}return this},resolveUnassignedPoints:function(t){if(!1===this.unassigned.isEmpty()){var e=this.unassigned.first();do{for(var i=e.next,s=this.tolerance,o=null,n=0;n<t.length;n++){var r=t[n];if(0===r.mark){var a=r.distanceToPoint(e.point);if(a>s&&(s=a,o=r),s>1e3*this.tolerance)break}}null!==o&&this.addVertexToFace(e,o),e=i}while(null!==e)}return this},computeExtremes:function(){var t,e,i,o=new s.Vector3,n=new s.Vector3,r=[],a=[];for(t=0;t<3;t++)r[t]=a[t]=this.vertices[0];for(o.copy(this.vertices[0].point),n.copy(this.vertices[0].point),t=0,e=this.vertices.length;t<e;t++){var h=this.vertices[t],l=h.point;for(i=0;i<3;i++)l.getComponent(i)<o.getComponent(i)&&(o.setComponent(i,l.getComponent(i)),r[i]=h);for(i=0;i<3;i++)l.getComponent(i)>n.getComponent(i)&&(n.setComponent(i,l.getComponent(i)),a[i]=h)}return this.tolerance=3*Number.EPSILON*(Math.max(Math.abs(o.x),Math.abs(n.x))+Math.max(Math.abs(o.y),Math.abs(n.y))+Math.max(Math.abs(o.z),Math.abs(n.z))),{min:r,max:a}},computeInitialHull:function(){void 0===t&&(t=new s.Line3,e=new s.Plane,i=new s.Vector3);var o,n,r,a,h,l,c,u,d,p=this.vertices,f=this.computeExtremes(),v=f.min,m=f.max,g=0,w=0;for(l=0;l<3;l++)(d=m[l].point.getComponent(l)-v[l].point.getComponent(l))>g&&(g=d,w=l);for(n=v[w],r=m[w],g=0,t.set(n.point,r.point),l=0,c=this.vertices.length;l<c;l++)(o=p[l])!==n&&o!==r&&(t.closestPointToPoint(o.point,!0,i),(d=i.distanceToSquared(o.point))>g&&(g=d,a=o));for(g=-1,e.setFromCoplanarPoints(n.point,r.point,a.point),l=0,c=this.vertices.length;l<c;l++)(o=p[l])!==n&&o!==r&&o!==a&&(d=Math.abs(e.distanceToPoint(o.point)))>g&&(g=d,h=o);var y=[];if(e.distanceToPoint(h.point)<0)for(y.push(new b(n,r,a),new b(h,r,n),new b(h,a,r),new b(h,n,a)),l=0;l<3;l++)u=(l+1)%3,y[l+1].getEdge(2).setTwin(y[0].getEdge(u)),y[l+1].getEdge(1).setTwin(y[u+1].getEdge(0));else for(y.push(new b(n,a,r),new b(h,n,r),new b(h,r,a),new b(h,a,n)),l=0;l<3;l++)u=(l+1)%3,y[l+1].getEdge(2).setTwin(y[0].getEdge((3-l)%3)),y[l+1].getEdge(0).setTwin(y[u+1].getEdge(1));for(l=0;l<4;l++)this.faces.push(y[l]);for(l=0,c=p.length;l<c;l++)if((o=p[l])!==n&&o!==r&&o!==a&&o!==h){g=this.tolerance;var C=null;for(u=0;u<4;u++)(d=this.faces[u].distanceToPoint(o.point))>g&&(g=d,C=this.faces[u]);null!==C&&this.addVertexToFace(o,C)}return this},reindexFaces:function(){for(var t=[],e=0;e<this.faces.length;e++){var i=this.faces[e];0===i.mark&&t.push(i)}return this.faces=t,this},nextVertexToAdd:function(){if(!1===this.assigned.isEmpty()){var t,e=0,i=this.assigned.first().face,s=i.outside;do{var o=i.distanceToPoint(s.point);o>e&&(e=o,t=s),s=s.next}while(null!==s&&s.face===i);return t}},computeHorizon:function(t,e,i,s){var o;this.deleteFaceVertices(i),i.mark=1,o=null===e?e=i.getEdge(0):e.next;do{var n=o.twin,r=n.face;0===r.mark&&(r.distanceToPoint(t)>this.tolerance?this.computeHorizon(t,n,r,s):s.push(o)),o=o.next}while(o!==e);return this},addAdjoiningFace:function(t,e){var i=new b(t,e.tail(),e.head());return this.faces.push(i),i.getEdge(-1).setTwin(e.twin),i.getEdge(0)},addNewFaces:function(t,e){this.newFaces=[];for(var i=null,s=null,o=0;o<e.length;o++){var n=e[o],r=this.addAdjoiningFace(t,n);null===i?i=r:r.next.setTwin(s),this.newFaces.push(r.face),s=r}return i.next.setTwin(s),this},addVertexToHull:function(t){var e=[];return this.unassigned.clear(),this.removeVertexFromFace(t,t.face),this.computeHorizon(t.point,null,t.face,e),this.addNewFaces(t,e),this.resolveUnassignedPoints(this.newFaces),this},cleanup:function(){return this.assigned.clear(),this.unassigned.clear(),this.newFaces=[],this},compute:function(){var t;for(this.computeInitialHull();void 0!==(t=this.nextVertexToAdd());)this.addVertexToHull(t);return this.reindexFaces(),this.cleanup(),this}}),Object.assign(a.prototype,{first:function(){return this.head},last:function(){return this.tail},clear:function(){return this.head=this.tail=null,this},insertBefore:function(t,e){return e.prev=t.prev,e.next=t,null===e.prev?this.head=e:e.prev.next=e,t.prev=e,this},insertAfter:function(t,e){return e.prev=t,e.next=t.next,null===e.next?this.tail=e:e.next.prev=e,t.next=e,this},append:function(t){return null===this.head?this.head=t:this.tail.next=t,t.prev=this.tail,t.next=null,this.tail=t,this},appendChain:function(t){for(null===this.head?this.head=t:this.tail.next=t,t.prev=this.tail;null!==t.next;)t=t.next;return this.tail=t,this},remove:function(t){return null===t.prev?this.head=t.next:t.prev.next=t.next,null===t.next?this.tail=t.prev:t.next.prev=t.prev,this},removeSubList:function(t,e){return null===t.prev?this.head=e.next:t.prev.next=e.next,null===e.next?this.tail=t.prev:e.next.prev=t.prev,this},isEmpty:function(){return null===this.head}}),n}(),w=function(t){s.Geometry.call(this);const e=new y(t);this.faceEdges=e.faceEdges,this.fromBufferGeometry(e),this.mergeVertices()};(w.prototype=Object.create(s.Geometry.prototype)).constructor=w;const y=function(t){s.BufferGeometry.call(this);const e=[],i=[],o=(new g).setFromPoints(t).faces;for(let t=0;t<o.length;t++){const s=o[t];let n=s.edge;do{const t=n.head().point;e.push(t.x,t.y,t.z),i.push(s.normal.x,s.normal.y,s.normal.z),n=n.next}while(n!==s.edge)}this.setAttribute("position",new s.Float32BufferAttribute(e,3)),this.setAttribute("normal",new s.Float32BufferAttribute(i,3));const n=[],r=new Set(o);for(let t of r){const e=[],i=t.edge;let s=t.edge;e.push(i.tail().point);do{const i=t.normal,o=s.twin.face,n=o.normal;Math.abs(i.dot(n)-1)<=1e-8?(t=o,s=s.twin.next):(e.push(s.head().point),s=s.next),r.delete(t)}while(s!==i);n.push(e)}this.faceEdges=n};y.prototype=Object.create(s.BufferGeometry.prototype),y.prototype.constructor=y;var C=i(1),x=i(6),V=i.n(x);class A extends f{setupScenes(){this.scenes=[],this.sceneZone=new s.Scene,this.scenes.push(this.sceneZone),this.sceneInfo=new s.Scene,this.scenes.push(this.sceneInfo)}setupLights(){let t=new s.DirectionalLight(16777215,.45);t.position.set(0,0,20),this.sceneZone.add(t);let e=new s.DirectionalLight(16777215,.3);e.position.set(-20,0,-20),this.sceneZone.add(e);let i=new s.DirectionalLight(16777215,.25);i.position.set(20,0,-20),this.sceneZone.add(i);const o=new s.AmbientLight(4210752,3.7);this.sceneZone.add(o)}load(t){var e,i,s,o,n,r;this.data=t,this.clear(),this.setup(),this.setupScenes(),this.setupLights(),this.setupCamera(),this.setupControls();const a=t.basis,h=t.segments,l=t.kpoints;return this.basis=t.basis,a&&h?(this.createBrillouinZone(a,h,l),void 0!==this.B&&this.alignView(null===(s=null===(i=null===(e=this.options)||void 0===e?void 0:e.layout)||void 0===i?void 0:i.viewRotation)||void 0===s?void 0:s.alignments),this.rotateView(null===(r=null===(n=null===(o=this.options)||void 0===o?void 0:o.layout)||void 0===n?void 0:n.viewRotation)||void 0===r?void 0:r.rotations),this.options.view.autoFit&&super.fitToCanvas(),this.render(),!0):(console.log("The data given for the Brillouin zone viewer is incomplete."),!1)}setOptions(t,e=!0,i=!0){var s,o,n;const r={controls:{rotateSpeed:40,enablePan:!1},view:{fitMargin:.075},basis:{offset:.02,font:"Arial",size:.03,stroke:{width:.06,color:"#000"},a:{label:"a"},b:{label:"b"},c:{label:"c"}},segments:{color:"#E56400",linewidth:.0025},kpoints:{point:{enabled:!0,size:.01,color:"#E56400"},label:{enabled:!0,font:"Arial",size:.025,color:"#E56400",offset2D:[0,-.75],stroke:{width:.06,color:"#000"}}},faces:{color:"#ddd",opacity:.7,outline:{width:.002,color:"#999"}}};0===Object.keys(this.options).length?(this.fillOptions(t,r),super.setOptions(r)):(this.fillOptions(t,this.options),super.setOptions(this.options),i&&void 0!==this.data&&this.load(this.data),void 0!==(null===(s=null==t?void 0:t.renderer)||void 0===s?void 0:s.background)&&this.setBackgroundColor(null===(o=null==t?void 0:t.renderer)||void 0===o?void 0:o.background.color,null===(n=null==t?void 0:t.renderer)||void 0===n?void 0:n.background.opacity),e&&this.render())}createBrillouinZone(t,e,i){var o,n,r,a,h,l,c,u,d,p,f,v,m,b,g,y,x,A,M,_,S;const k=new s.Matrix3,z=(new s.Vector3).fromArray(t[0]),E=(new s.Vector3).fromArray(t[1]),P=(new s.Vector3).fromArray(t[2]);k.set(z.x,E.x,P.x,z.y,E.y,P.y,z.z,E.z,P.z),this.basisVectors=[z,E,P],this.B=k;const j=(new s.Matrix3).identity(),L=[];for(let t=-1;t<=1;++t)for(let e=-1;e<=1;++e)for(let i=-1;i<=1;++i){const o=new s.Vector3(t,e,i),n=this.coordinateTransform(this.B,j,o,!1);L.push(n.toArray())}const O=V()(L);let F;for(const t of O.cells){const e=[];let i=!0,o=!0;for(const s of t){if(-1===s){i=!1;break}const t=O.positions[s];for(let e=0;e<3;++e)if(Number.isNaN(t[e])){o=!1;break}e.push(t)}if(!i||!o)continue;const n=new s.Vector3(0,0,0),r=[];for(let t=0;t<e.length;++t){const i=(new s.Vector3).fromArray(e[t]);r.push(i),n.add(i)}if(n.divideScalar(r.length),n.length()<1e-7){const t=new s.Geometry;for(const e of r)t.vertices.push(e);F=new s.Points(t),F.visible=!0;break}}this.zone=new s.Object3D,this.zone.name="zone",this.sceneZone.add(this.zone),this.info=new s.Object3D,this.info.name="info",this.sceneInfo.add(this.info);const T=new w(F.geometry.vertices),B=new s.Group;B.name="group";const D=new s.MeshPhongMaterial({color:this.options.faces.color,opacity:this.options.faces.opacity,transparent:!0}),R=new s.Mesh(T,D);R.name="innermesh",R.material.side=s.BackSide,R.renderOrder=0,B.add(R);const W=new s.Mesh(T,D.clone());W.name="outermesh",W.material.side=s.FrontSide,W.renderOrder=1,B.add(W),this.zone.add(B);const N=this.options.faces.outline.width,H=new C.MeshLineMaterial({color:this.options.faces.outline.color,lineWidth:N,sizeAttenuation:!0});for(const t of T.faceEdges){const e=new s.Geometry;for(const i of t){let t=i.clone();const s=t.length();t=t.multiplyScalar(1+.5*N/s),e.vertices.push(t)}const i=new C.MeshLine;i.setVertices(e.vertices);const o=new s.Mesh(i,H);this.zone.add(o)}const G=[this.options.basis.a.label,this.options.basis.b.label,this.options.basis.c.label],Z=[];Z.push(void 0===(null===(o=this.options.basis.a)||void 0===o?void 0:o.font)?this.options.basis.font:this.options.basis.a.font),Z.push(void 0===(null===(n=this.options.basis.b)||void 0===n?void 0:n.font)?this.options.basis.font:this.options.basis.b.font),Z.push(void 0===(null===(r=this.options.basis.c)||void 0===r?void 0:r.font)?this.options.basis.font:this.options.basis.c.font);const I=[];I.push(void 0===(null===(a=this.options.basis.a)||void 0===a?void 0:a.size)?this.options.basis.size:this.options.basis.a.size),I.push(void 0===(null===(h=this.options.basis.b)||void 0===h?void 0:h.size)?this.options.basis.size:this.options.basis.b.size),I.push(void 0===(null===(l=this.options.basis.c)||void 0===l?void 0:l.size)?this.options.basis.size:this.options.basis.c.size);const U=[];U.push(void 0===(null===(c=this.options.basis.a)||void 0===c?void 0:c.color)?this.options.basis.color:this.options.basis.a.color),U.push(void 0===(null===(u=this.options.basis.b)||void 0===u?void 0:u.color)?this.options.basis.color:this.options.basis.b.color),U.push(void 0===(null===(d=this.options.basis.c)||void 0===d?void 0:d.color)?this.options.basis.color:this.options.basis.c.color);const X=[];X.push(void 0===(null===(f=null===(p=this.options.basis.a)||void 0===p?void 0:p.stroke)||void 0===f?void 0:f.color)?this.options.basis.stroke.color:this.options.basis.a.stroke.color),X.push(void 0===(null===(m=null===(v=this.options.basis.b)||void 0===v?void 0:v.stroke)||void 0===m?void 0:m.color)?this.options.basis.stroke.color:this.options.basis.b.stroke.color),X.push(void 0===(null===(g=null===(b=this.options.basis.c)||void 0===b?void 0:b.stroke)||void 0===g?void 0:g.color)?this.options.basis.stroke.color:this.options.basis.c.stroke.color);const Y=[];Y.push(void 0===(null===(x=null===(y=this.options.basis.a)||void 0===y?void 0:y.stroke)||void 0===x?void 0:x.width)?this.options.basis.stroke.width:this.options.basis.a.stroke.width),Y.push(void 0===(null===(M=null===(A=this.options.basis.b)||void 0===A?void 0:A.stroke)||void 0===M?void 0:M.width)?this.options.basis.stroke.width:this.options.basis.b.stroke.width),Y.push(void 0===(null===(S=null===(_=this.options.basis.c)||void 0===_?void 0:_.stroke)||void 0===S?void 0:S.width)?this.options.basis.stroke.width:this.options.basis.c.stroke.width);for(let e=0;e<3;++e){const i=.7,o=t[e],n=new s.Vector3(0,0,0),r=(new s.Vector3).fromArray(o).multiplyScalar(i),a=new s.Geometry;a.vertices.push(n,r);const h=new C.MeshLineMaterial({color:"#000",lineWidth:75e-5,sizeAttenuation:!0,dashArray:.05,transparent:!0,depthTest:!1}),l=new C.MeshLine;l.setVertices(a.vertices);const c=new s.Mesh(l,h);this.info.add(c);const u=(new s.Vector3).copy(r).multiplyScalar(1+this.options.basis.offset/r.length()),d=G[e],p=U[e],f=Z[e],v=I[e],m=Y[e],b=X[e],g=this.createLabel(u,d,p,f,v,new s.Vector2(0,0),m,b);this.info.add(g);const w=new s.CylinderGeometry(0,.003,.012,12),y=new s.MeshBasicMaterial({color:0}),x=new s.Mesh(w,y);x.position.copy(r),x.lookAt(new s.Vector3),x.rotateX(-Math.PI/2),this.info.add(x)}const q=new C.MeshLineMaterial({color:this.options.segments.color,lineWidth:this.options.segments.linewidth,sizeAttenuation:!0});let Q;const K=[];for(let t=0;t<e.length;++t){Q=new s.Geometry;const i=e[t];for(const t of i){const e=(new s.Vector3).fromArray(t),i=this.coordinateTransform(this.B,j,e,!1);Q.vertices.push(i),Q.vertices.push(i),K.push(i)}const o=new C.MeshLine;o.setVertices(Q.vertices);const n=new s.Mesh(o,q);this.info.add(n)}this.labelPoints=new s.Object3D;for(const t of K){const e=new s.Object3D;e.position.copy(t),this.labelPoints.add(e)}if(this.info.add(this.labelPoints),i)for(const t of i){const e=t[0],i=(new s.Vector3).fromArray(t[1]),o=this.coordinateTransform(this.B,j,i,!1);if(this.options.kpoints.point.enabled){const t=this.createCircle(o,this.options.kpoints.point.size,this.options.kpoints.point.color);this.info.add(t)}if(this.options.kpoints.label.enabled){const t=this.createLabel(o,e,this.options.kpoints.label.color,this.options.kpoints.label.font,this.options.kpoints.label.size,(new s.Vector2).fromArray(this.options.kpoints.label.offset2D),this.options.kpoints.label.stroke.width,this.options.kpoints.label.stroke.width);this.info.add(t)}}}getCornerPoints(){const t=this.zone.getObjectByName("group").getObjectByName("outermesh");t.updateMatrixWorld();const e=t.geometry.vertices,i=e.length,s=[];for(let o=0;o<i;++o){const i=e[o].clone();s.push(t.localToWorld(i))}return{points:s,margin:0}}rotateView(t,e=!0){if(void 0!==t){for(const e of t){const t=new s.Vector3(e[0],e[1],e[2]);t.normalize();const i=e[3]/180*Math.PI;this.rotateAroundWorldAxis(this.zone,t,i),this.rotateAroundWorldAxis(this.info,t,i)}e&&this.render()}}alignView(t,e=!0){const i=new s.Vector3,o=this.labelPoints.children.length;for(let t=0;t<o;++t){const e=this.labelPoints.children[t];i.add(e.getWorldPosition(new s.Vector3))}const n={a:this.basisVectors[0].clone(),"-a":this.basisVectors[0].clone().negate(),b:this.basisVectors[1].clone(),"-b":this.basisVectors[1].clone().negate(),c:this.basisVectors[2].clone(),"-c":this.basisVectors[2].clone().negate(),segments:i},r=[this.zone,this.info];super.alignView(t,n,r,e)}createCircle(t,e,i){const o=document.createElement("canvas");o.width=256,o.height=256;const n=o.getContext("2d");n.beginPath(),n.arc(128,128,128,0,2*Math.PI),n.fillStyle=i,n.fill();const r=new s.Texture(o);r.needsUpdate=!0;const a=new s.SpriteMaterial({map:r}),h=new s.Sprite(a);h.scale.set(e,e,1);const l=new s.Object3D;return l.position.copy(t),l.add(h),l}}}]);